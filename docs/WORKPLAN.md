# üìã GRANULA API - –ü–û–õ–ù–´–ô –ü–õ–ê–ù –†–ê–ë–û–¢

> **–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 29.11.2024  
> **–°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞:** –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ (80% –≥–æ—Ç–æ–≤–æ)  
> **–°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø:** –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è –∏ –ª–æ–∫–∞–ª—å–Ω—ã–π –¥–µ–ø–ª–æ–π

---

## üìä –¢–ï–ö–£–©–ò–ô –°–¢–ê–¢–£–° –°–ò–°–¢–ï–ú–´

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞ (29.11.2024):

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                            –°–¢–ê–¢–£–° –ö–û–ú–ü–ò–õ–Ø–¶–ò–ò                                     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                                  ‚îÇ
‚îÇ  SHARED MODULE                               D1 SERVICES (Core)                  ‚îÇ
‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ                           ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ               ‚îÇ
‚îÇ  [‚úÖ] shared/pkg/*                           [‚úÖ] auth-service                   ‚îÇ
‚îÇ  [‚ö†Ô∏è] shared/gen/* (–ü–£–°–¢–û!)                  [‚ùå] user-service (go.sum)          ‚îÇ
‚îÇ  [‚úÖ] shared/proto/*                         [‚ùå] api-gateway (go.sum)           ‚îÇ
‚îÇ                                              [‚ùå] notification-service (go.sum)  ‚îÇ
‚îÇ                                              [‚ùå] workspace-service (–ù–ï–¢)        ‚îÇ
‚îÇ                                              [‚ùå] request-service (–ù–ï–¢)          ‚îÇ
‚îÇ                                                                                  ‚îÇ
‚îÇ  D2 SERVICES (AI/3D)                         –¢–ï–°–¢–´                               ‚îÇ
‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ                        ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ                         ‚îÇ
‚îÇ  [‚úÖ] compliance-service                     [‚úÖ] compliance-service/engine_test ‚îÇ
‚îÇ  [‚úÖ] ai-service                             [‚úÖ] ai-service/client_test         ‚îÇ
‚îÇ  [‚úÖ] floorplan-service                      [‚úÖ] ai-service/chat_test           ‚îÇ
‚îÇ  [‚úÖ] scene-service                          [‚úÖ] floorplan-service/entity_test  ‚îÇ
‚îÇ  [‚úÖ] branch-service                         [‚úÖ] scene-service/entity_test      ‚îÇ
‚îÇ                                              [‚úÖ] branch-service/entity_test     ‚îÇ
‚îÇ                                                                                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–õ–µ–≥–µ–Ω–¥–∞: [‚úÖ] –ì–æ—Ç–æ–≤–æ/–ö–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è  [‚ö†Ô∏è] –ß–∞—Å—Ç–∏—á–Ω–æ  [‚ùå] –¢—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
```

---

## üéØ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´ (–ò–°–ü–†–ê–í–ò–¢–¨ –ù–ï–ú–ï–î–õ–ï–ù–ù–û)

### 1. Proto —Ñ–∞–π–ª—ã –Ω–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã
```
–ü—Ä–æ–±–ª–µ–º–∞: shared/gen/ –ø—É—Å—Ç–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è
–†–µ—à–µ–Ω–∏–µ: –ó–∞–ø—É—Å—Ç–∏—Ç—å protoc –¥–ª—è –≤—Å–µ—Ö .proto —Ñ–∞–π–ª–æ–≤
–ö–æ–º–∞–Ω–¥–∞: make proto (–∏–ª–∏ –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ protoc)
```

### 2. D1 —Å–µ—Ä–≤–∏—Å—ã –Ω–µ –∫–æ–º–ø–∏–ª–∏—Ä—É—é—Ç—Å—è (missing go.sum)
```
–ü—Ä–æ–±–ª–µ–º–∞: user-service, api-gateway, notification-service –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç go.sum
–†–µ—à–µ–Ω–∏–µ: go mod tidy –≤ –∫–∞–∂–¥–æ–º —Å–µ—Ä–≤–∏—Å–µ
```

### 3. –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ —Å–µ—Ä–≤–∏—Å—ã
```
–ü—Ä–æ–±–ª–µ–º–∞: workspace-service –∏ request-service –Ω–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç
–†–µ—à–µ–Ω–∏–µ: –°–æ–∑–¥–∞—Ç—å —Å –Ω—É–ª—è –ø–æ —à–∞–±–ª–æ–Ω—É –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
```

---

## üìù –î–ï–¢–ê–õ–¨–ù–´–ô –ü–õ–ê–ù –†–ê–ë–û–¢

### –≠–¢–ê–ü 1: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º (2-3 —á–∞—Å–∞)

#### 1.1 –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Proto —Ñ–∞–π–ª–æ–≤
```powershell
# Windows
cd R:\granula\api
mkdir -p shared/gen

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ proto —Ñ–∞–π–ª–∞
$protos = @(
    "common/v1/common.proto",
    "auth/v1/auth.proto",
    "user/v1/user.proto",
    "workspace/v1/workspace.proto",
    "floor_plan/v1/floor_plan.proto",
    "scene/v1/scene.proto",
    "branch/v1/branch.proto",
    "ai/v1/ai.proto",
    "compliance/v1/compliance.proto",
    "request/v1/request.proto",
    "notification/v1/notification.proto"
)

foreach ($p in $protos) {
    protoc --go_out=shared/gen --go_opt=paths=source_relative `
           --go-grpc_out=shared/gen --go-grpc_opt=paths=source_relative `
           -I shared/proto shared/proto/$p
}
```

#### 1.2 –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ go.sum –¥–ª—è D1 —Å–µ—Ä–≤–∏—Å–æ–≤
```powershell
# –î–ª—è –∫–∞–∂–¥–æ–≥–æ D1 —Å–µ—Ä–≤–∏—Å–∞
cd user-service && go mod tidy && cd ..
cd api-gateway && go mod tidy && cd ..
cd notification-service && go mod tidy && cd ..
```

#### 1.3 –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–º–ø–æ—Ä—Ç–æ–≤ –≤ auth-service
```
–§–∞–π–ª: auth-service/internal/service/auth.go
–ü—Ä–æ–±–ª–µ–º–∞: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∏–º–ø–æ—Ä—Ç—ã (github.com/xiiisorate/github.com/xiiisorate/...)
–ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–∞: github.com/xiiisorate/granula_api/shared/pkg/errors
```

---

### –≠–¢–ê–ü 2: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (4-5 —á–∞—Å–æ–≤)

#### 2.1 Workspace Service
```
workspace-service/
‚îú‚îÄ‚îÄ cmd/server/main.go
‚îú‚îÄ‚îÄ go.mod
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ config/config.go
‚îÇ   ‚îú‚îÄ‚îÄ domain/entity/workspace.go
‚îÇ   ‚îú‚îÄ‚îÄ repository/postgres/workspace_repository.go
‚îÇ   ‚îú‚îÄ‚îÄ service/workspace_service.go
‚îÇ   ‚îî‚îÄ‚îÄ grpc/server.go
‚îî‚îÄ‚îÄ migrations/
    ‚îú‚îÄ‚îÄ 000001_create_workspaces.up.sql
    ‚îî‚îÄ‚îÄ 000001_create_workspaces.down.sql
```

**–ú–µ—Ç–æ–¥—ã WorkspaceService:**
- CreateWorkspace(ctx, userID, name, description) ‚Üí Workspace
- GetWorkspace(ctx, id) ‚Üí Workspace
- ListWorkspaces(ctx, userID, pagination) ‚Üí []Workspace
- UpdateWorkspace(ctx, id, name, description) ‚Üí Workspace
- DeleteWorkspace(ctx, id) ‚Üí error
- AddMember(ctx, workspaceID, userID, role) ‚Üí Member
- RemoveMember(ctx, workspaceID, userID) ‚Üí error
- UpdateMemberRole(ctx, workspaceID, userID, role) ‚Üí Member
- ListMembers(ctx, workspaceID) ‚Üí []Member

#### 2.2 Request Service
```
request-service/
‚îú‚îÄ‚îÄ cmd/server/main.go
‚îú‚îÄ‚îÄ go.mod
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ config/config.go
‚îÇ   ‚îú‚îÄ‚îÄ domain/entity/request.go
‚îÇ   ‚îú‚îÄ‚îÄ repository/postgres/request_repository.go
‚îÇ   ‚îú‚îÄ‚îÄ service/request_service.go
‚îÇ   ‚îî‚îÄ‚îÄ grpc/server.go
‚îî‚îÄ‚îÄ migrations/
    ‚îú‚îÄ‚îÄ 000001_create_requests.up.sql
    ‚îî‚îÄ‚îÄ 000001_create_requests.down.sql
```

**–ú–µ—Ç–æ–¥—ã RequestService:**
- CreateRequest(ctx, workspaceID, title, description, category) ‚Üí Request
- GetRequest(ctx, id) ‚Üí Request
- ListRequests(ctx, workspaceID, status, pagination) ‚Üí []Request
- UpdateRequest(ctx, id, title, description) ‚Üí Request
- CancelRequest(ctx, id) ‚Üí error
- AssignExpert(ctx, requestID, expertID) ‚Üí Request
- UpdateStatus(ctx, requestID, status, comment) ‚Üí Request

---

### –≠–¢–ê–ü 3: Dockerfiles –¥–ª—è D2 —Å–µ—Ä–≤–∏—Å–æ–≤ (1-2 —á–∞—Å–∞)

#### –®–∞–±–ª–æ–Ω Dockerfile –¥–ª—è D2 —Å–µ—Ä–≤–∏—Å–æ–≤:
```dockerfile
# =============================================================================
# Build stage
# =============================================================================
FROM golang:1.22-alpine AS builder

RUN apk add --no-cache git ca-certificates tzdata

WORKDIR /app

# Copy shared module
COPY shared/ ./shared/

# Copy service
COPY ${SERVICE_NAME}/ ./${SERVICE_NAME}/

WORKDIR /app/${SERVICE_NAME}

RUN go mod download
RUN CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build \
    -ldflags="-w -s" \
    -o /app/service ./cmd/server

# =============================================================================
# Production stage
# =============================================================================
FROM alpine:3.19

RUN apk --no-cache add ca-certificates tzdata && \
    addgroup -g 1000 granula && \
    adduser -u 1000 -G granula -s /bin/sh -D granula

WORKDIR /app
COPY --from=builder /app/service .
COPY --from=builder /app/${SERVICE_NAME}/migrations ./migrations 2>/dev/null || true

RUN chown -R granula:granula /app
USER granula

EXPOSE 50054

HEALTHCHECK --interval=30s --timeout=5s --start-period=5s --retries=3 \
    CMD wget --no-verbose --tries=1 --spider http://localhost:${PORT}/health || exit 1

ENTRYPOINT ["./service"]
```

**–°–æ–∑–¥–∞—Ç—å –¥–ª—è:**
- [ ] compliance-service/Dockerfile (–ø–æ—Ä—Ç 50058)
- [ ] ai-service/Dockerfile (–ø–æ—Ä—Ç 50057)
- [ ] floorplan-service/Dockerfile (–ø–æ—Ä—Ç 50054)
- [ ] scene-service/Dockerfile (–ø–æ—Ä—Ç 50055)
- [ ] branch-service/Dockerfile (–ø–æ—Ä—Ç 50056)

---

### –≠–¢–ê–ü 4: API Gateway –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (3-4 —á–∞—Å–∞)

#### 4.1 –î–æ–±–∞–≤–∏—Ç—å gRPC –∫–ª–∏–µ–Ω—Ç—ã
```go
// api-gateway/internal/grpc/clients.go
package grpc

type Clients struct {
    Auth         authv1.AuthServiceClient
    User         userv1.UserServiceClient
    Workspace    workspacev1.WorkspaceServiceClient
    FloorPlan    floorplanv1.FloorPlanServiceClient
    Scene        scenev1.SceneServiceClient
    Branch       branchv1.BranchServiceClient
    AI           aiv1.AIServiceClient
    Compliance   compliancev1.ComplianceServiceClient
    Request      requestv1.RequestServiceClient
    Notification notificationv1.NotificationServiceClient
}
```

#### 4.2 –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å HTTP handlers
```
api-gateway/internal/handlers/
‚îú‚îÄ‚îÄ auth.go          ‚Üê –°—É—â–µ—Å—Ç–≤—É–µ—Ç (TODO: gRPC integration)
‚îú‚îÄ‚îÄ user.go          ‚Üê –°—É—â–µ—Å—Ç–≤—É–µ—Ç (TODO: gRPC integration)
‚îú‚îÄ‚îÄ notification.go  ‚Üê –°—É—â–µ—Å—Ç–≤—É–µ—Ç (TODO: gRPC integration)
‚îú‚îÄ‚îÄ workspace.go     ‚Üê –°–û–ó–î–ê–¢–¨
‚îú‚îÄ‚îÄ floorplan.go     ‚Üê –°–û–ó–î–ê–¢–¨
‚îú‚îÄ‚îÄ scene.go         ‚Üê –°–û–ó–î–ê–¢–¨
‚îú‚îÄ‚îÄ branch.go        ‚Üê –°–û–ó–î–ê–¢–¨
‚îú‚îÄ‚îÄ ai.go            ‚Üê –°–û–ó–î–ê–¢–¨ (–≤–∫–ª—é—á–∞—è streaming)
‚îú‚îÄ‚îÄ compliance.go    ‚Üê –°–û–ó–î–ê–¢–¨
‚îî‚îÄ‚îÄ request.go       ‚Üê –°–û–ó–î–ê–¢–¨
```

#### 4.3 –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–æ—É—Ç–∏–Ω–≥
```go
// Routes
api := app.Group("/api/v1")

// Auth (public)
api.Post("/auth/register", handlers.Register)
api.Post("/auth/login", handlers.Login)
api.Post("/auth/refresh", handlers.RefreshToken)
api.Post("/auth/logout", handlers.Logout)

// Protected routes
protected := api.Use(middleware.Auth(cfg))

// Users
protected.Get("/users/me", handlers.GetProfile)
protected.Put("/users/me", handlers.UpdateProfile)
protected.Post("/users/me/avatar", handlers.UploadAvatar)

// Workspaces
protected.Post("/workspaces", handlers.CreateWorkspace)
protected.Get("/workspaces", handlers.ListWorkspaces)
protected.Get("/workspaces/:id", handlers.GetWorkspace)
protected.Put("/workspaces/:id", handlers.UpdateWorkspace)
protected.Delete("/workspaces/:id", handlers.DeleteWorkspace)

// Floor Plans
protected.Post("/workspaces/:id/floor-plans", handlers.UploadFloorPlan)
protected.Get("/workspaces/:id/floor-plans", handlers.ListFloorPlans)
protected.Get("/floor-plans/:id", handlers.GetFloorPlan)
protected.Delete("/floor-plans/:id", handlers.DeleteFloorPlan)
protected.Post("/floor-plans/:id/process", handlers.ProcessFloorPlan)

// Scenes
protected.Get("/workspaces/:id/scenes", handlers.ListScenes)
protected.Post("/scenes", handlers.CreateScene)
protected.Get("/scenes/:id", handlers.GetScene)
protected.Put("/scenes/:id", handlers.UpdateScene)
protected.Delete("/scenes/:id", handlers.DeleteScene)

// Elements
protected.Get("/scenes/:id/elements", handlers.ListElements)
protected.Post("/scenes/:id/elements", handlers.CreateElement)
protected.Put("/elements/:id", handlers.UpdateElement)
protected.Delete("/elements/:id", handlers.DeleteElement)

// Branches
protected.Get("/scenes/:id/branches", handlers.ListBranches)
protected.Post("/branches", handlers.CreateBranch)
protected.Get("/branches/:id", handlers.GetBranch)
protected.Post("/branches/:id/merge", handlers.MergeBranch)

// AI
protected.Post("/ai/chat", handlers.SendChatMessage)
protected.Get("/ai/chat/:scene_id/history", handlers.GetChatHistory)
protected.Post("/ai/recognize", handlers.RecognizeFloorPlan)
protected.Post("/ai/generate-variants", handlers.GenerateVariants)

// Compliance
protected.Post("/compliance/check", handlers.CheckCompliance)
protected.Get("/compliance/rules", handlers.GetRules)

// Requests
protected.Post("/requests", handlers.CreateRequest)
protected.Get("/requests", handlers.ListRequests)
protected.Get("/requests/:id", handlers.GetRequest)
protected.Put("/requests/:id/status", handlers.UpdateRequestStatus)

// Notifications
protected.Get("/notifications", handlers.GetNotifications)
protected.Post("/notifications/:id/read", handlers.MarkAsRead)
protected.Get("/notifications/unread-count", handlers.GetUnreadCount)
```

---

### –≠–¢–ê–ü 5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (2-3 —á–∞—Å–∞)

#### 5.1 Unit —Ç–µ—Å—Ç—ã –¥–ª—è D1 —Å–µ—Ä–≤–∏—Å–æ–≤
```
auth-service/internal/service/auth_test.go
user-service/internal/service/user_test.go
notification-service/internal/service/notification_test.go
workspace-service/internal/service/workspace_test.go
request-service/internal/service/request_test.go
```

#### 5.2 –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
```powershell
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –ø–æ –≤—Å–µ–º —Å–µ—Ä–≤–∏—Å–∞–º
go test ./... -v -cover

# –° coverage report
go test ./... -coverprofile=coverage.out
go tool cover -html=coverage.out -o coverage.html
```

---

### –≠–¢–ê–ü 6: –õ–æ–∫–∞–ª—å–Ω—ã–π –¥–µ–ø–ª–æ–π (1-2 —á–∞—Å–∞)

#### 6.1 –ó–∞–ø—É—Å–∫ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
```powershell
# –ó–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ –ë–î –∏ –∫—ç—à–∞
docker-compose up -d postgres mongodb redis minio

# –ü—Ä–æ–≤–µ—Ä–∫–∞
docker-compose ps
```

#### 6.2 –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–π
```powershell
# Auth DB
migrate -path auth-service/migrations -database "postgres://granula:granula_secret@localhost:5432/auth_db?sslmode=disable" up

# Users DB
migrate -path user-service/migrations -database "postgres://granula:granula_secret@localhost:5432/users_db?sslmode=disable" up

# –ò —Ç–∞–∫ –¥–∞–ª–µ–µ –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤...
```

#### 6.3 –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
```powershell
# –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫
docker-compose up -d --build

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
docker-compose logs -f api-gateway

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
curl http://localhost:8080/health
```

---

## üìã –ß–ï–ö–õ–ò–°–¢ –ó–ê–í–ï–†–®–ï–ù–ò–Ø

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –ø—É—Ç—å (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):
- [ ] Proto –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∫–æ–º–ø–∏–ª–∏—Ä—É—é—Ç—Å—è
- [ ] Docker Compose –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
- [ ] API Gateway —Ä–æ—É—Ç–∏—Ç –∑–∞–ø—Ä–æ—Å—ã
- [ ] –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è/–ª–æ–≥–∏–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] CRUD –≤–æ—Ä–∫—Å–ø–µ–π—Å–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü–æ–ª–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:
- [ ] –ó–∞–≥—Ä—É–∑–∫–∞ –∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–æ–∫
- [ ] –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ü–µ–Ω—ã (—ç–ª–µ–º–µ–Ω—Ç—ã)
- [ ] –í–µ—Ç–≤–ª–µ–Ω–∏–µ –∏ —Å–ª–∏—è–Ω–∏–µ
- [ ] AI —á–∞—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] Compliance –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ó–∞—è–≤–∫–∏ –Ω–∞ —ç–∫—Å–ø–µ—Ä—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è

### –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞:
- [ ] Unit —Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (>70% coverage)
- [ ] –í—Å–µ —Ñ–∞–π–ª—ã —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏ –∏ docstrings
- [ ] –õ–∏–Ω—Ç–µ—Ä –ø—Ä–æ—Ö–æ–¥–∏—Ç –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
- [ ] Error handling –≤–µ–∑–¥–µ

---

## üîß –ü–û–õ–ï–ó–ù–´–ï –ö–û–ú–ê–ù–î–´

```powershell
# –°–±–æ—Ä–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
make build

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
make test

# –õ–∏–Ω—Ç–∏–Ω–≥
make lint

# Docker Compose
make docker-up
make docker-down
make docker-logs

# –ú–∏–≥—Ä–∞—Ü–∏–∏
make migrate-all-up

# Proto –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
make proto
```

---

## üìû –ö–û–ù–¢–ê–ö–¢–´ –ò –†–ï–°–£–†–°–´

- **–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:** https://github.com/xiiisorate/granula_api
- **–í–µ—Ç–∫–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:** dev/shared
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** ./docs/
- **Proto —Ñ–∞–π–ª—ã:** ./shared/proto/
