# =============================================================================
# Granula API - OpenAPI 3.0 Specification
# =============================================================================
# –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è REST API –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–º–æ–Ω—Ç–∞ –∏ –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏.
#
# –í–µ—Ä—Å–∏—è: 1.1.0
# –î–∞—Ç–∞: 2025-11-30
# =============================================================================

openapi: 3.0.3

info:
  title: Granula API
  version: 1.1.0
  description: |
    # Granula API

    API –¥–ª—è –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–º–æ–Ω—Ç–∞ –∏ –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ –∫–≤–∞—Ä—Ç–∏—Ä.

    ## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

    - üè† **–ó–∞–≥—Ä—É–∑–∫–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–æ–∫** - –ó–∞–≥—Ä—É–∂–∞–π—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–ª–∞–Ω–∏—Ä–æ–≤–æ–∫ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
    - ü§ñ **AI —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ** - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç, —Å—Ç–µ–Ω –∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
    - üé® **3D —Ä–µ–¥–∞–∫—Ç–æ—Ä** - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ –≤ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–º 3D —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ
    - ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ—Ä–º** - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –°–ù–∏–ü –∏ –ñ–ö –†–§
    - üí° **AI –≥–µ–Ω–µ—Ä–∞—Ü–∏—è** - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ —Å –ø–æ–º–æ—â—å—é AI
    - üìã **–ó–∞—è–≤–∫–∏ —ç–∫—Å–ø–µ—Ä—Ç–∞–º** - –ü–æ–¥–∞—á–∞ –∑–∞—è–≤–æ–∫ –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤ –ë–¢–ò

    ## –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

    API –∏—Å–ø–æ–ª—å–∑—É–µ—Ç JWT (JSON Web Tokens) –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.

    ### –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤

    1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å —á–µ—Ä–µ–∑ `POST /api/v1/auth/register`
    2. –ò–ª–∏ –≤–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ `POST /api/v1/auth/login`
    3. –ü–æ–ª—É—á–∏—Ç–µ `access_token` –∏ `refresh_token`

    ### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤

    –ü–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ Access Token –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ Authorization:
    ```
    Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
    ```

    ### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤

    Access Token –¥–µ–π—Å—Ç–≤—É–µ—Ç 15 –º–∏–Ω—É—Ç. –î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `POST /api/v1/auth/refresh`

    ## Rate Limiting

    | –¢–∏–ø –∑–∞–ø—Ä–æ—Å–∞ | –õ–∏–º–∏—Ç |
    |-------------|-------|
    | –ê–Ω–æ–Ω–∏–º–Ω—ã–µ | 60 req/min |
    | –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ | 300 req/min |
    | AI endpoints | 30 req/min |

    –ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è HTTP 429.

    ## –ö–æ–¥—ã –æ—à–∏–±–æ–∫

    | –ö–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
    |-----|----------|
    | VALIDATION_ERROR | –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö |
    | UNAUTHORIZED | –¢—Ä–µ–±—É–µ—Ç—Å—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è |
    | FORBIDDEN | –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ |
    | NOT_FOUND | –†–µ—Å—É—Ä—Å –Ω–µ –Ω–∞–π–¥–µ–Ω |
    | CONFLICT | –ö–æ–Ω—Ñ–ª–∏–∫—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ) |
    | RATE_LIMITED | –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ |
    | INTERNAL_ERROR | –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ |

  termsOfService: https://granula.ru/terms
  contact:
    name: Granula API Support
    url: https://granula.ru/support
    email: api@granula.ru
  license:
    name: Proprietary
    url: https://granula.ru/license

servers:
  - url: https://api.granula.raitokyokai.tech/api/v1
    description: Production —Å–µ—Ä–≤–µ—Ä
  - url: http://localhost:3001/api/v1
    description: –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

tags:
  - name: auth
    description: –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏
  - name: users
    description: –ü—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  - name: workspaces
    description: –†–∞–±–æ—á–∏–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–æ–≤
  - name: floor-plans
    description: –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–æ–∫
  - name: scenes
    description: 3D —Å—Ü–µ–Ω—ã –∏ —ç–ª–µ–º–µ–Ω—Ç—ã
  - name: branches
    description: –í–µ—Ç–∫–∏ –¥–∏–∑–∞–π–Ω–∞ (–≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ)
  - name: ai
    description: AI —Å–µ—Ä–≤–∏—Å—ã (—Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è, —á–∞—Ç)
  - name: compliance
    description: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –°–ù–∏–ü –∏ –ñ–ö –†–§
  - name: requests
    description: –ó–∞—è–≤–∫–∏ –Ω–∞ —É—Å–ª—É–≥–∏ —ç–∫—Å–ø–µ—Ä—Ç–æ–≤ –ë–¢–ò
  - name: notifications
    description: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

# =============================================================================
# Security Schemes
# =============================================================================
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT —Ç–æ–∫–µ–Ω. –ü–æ–ª—É—á–∏—Ç–µ —á–µ—Ä–µ–∑ `/auth/login` –∏–ª–∏ `/auth/register`. –§–æ—Ä–º–∞—Ç - `Bearer <token>`

  # ===========================================================================
  # Schemas
  # ===========================================================================
  schemas:
    # -------------------------------------------------------------------------
    # Error Responses
    # -------------------------------------------------------------------------
    Error:
      type: object
      properties:
        error:
          type: string
          description: –û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏
          example: unauthorized
        message:
          type: string
          description: –î–µ—Ç–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
          example: Invalid token
        request_id:
          type: string
          description: ID –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
          example: req-abc123

    ValidationError:
      type: object
      properties:
        error:
          type: string
          example: validation_error
        details:
          type: object
          additionalProperties:
            type: string
          example:
            email: "invalid email format"
            password: "minimum 8 characters"

    # -------------------------------------------------------------------------
    # Success Response
    # -------------------------------------------------------------------------
    SuccessResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: Operation completed successfully
        request_id:
          type: string

    # -------------------------------------------------------------------------
    # Pagination
    # -------------------------------------------------------------------------
    Pagination:
      type: object
      properties:
        total:
          type: integer
          example: 150
        page:
          type: integer
          example: 1
        page_size:
          type: integer
          example: 20
        total_pages:
          type: integer
          example: 8

    # -------------------------------------------------------------------------
    # Auth Schemas
    # -------------------------------------------------------------------------
    RegisterRequest:
      type: object
      required: [email, password, name]
      properties:
        email:
          type: string
          format: email
          example: user@example.com
        password:
          type: string
          format: password
          minLength: 8
          example: SecurePass123!
        name:
          type: string
          minLength: 2
          example: –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤

    LoginRequest:
      type: object
      required: [email, password]
      properties:
        email:
          type: string
          format: email
          example: user@example.com
        password:
          type: string
          format: password
          example: SecurePass123!

    AuthResponse:
      type: object
      properties:
        data:
          type: object
          properties:
            user_id:
              type: string
              format: uuid
            access_token:
              type: string
            refresh_token:
              type: string
            expires_in:
              type: integer
              description: –°–µ–∫—É–Ω–¥—ã –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è access_token
        message:
          type: string
        request_id:
          type: string

    RefreshRequest:
      type: object
      required: [refresh_token]
      properties:
        refresh_token:
          type: string

    LogoutRequest:
      type: object
      required: [refresh_token]
      properties:
        refresh_token:
          type: string

    # -------------------------------------------------------------------------
    # User Schemas
    # -------------------------------------------------------------------------
    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
          format: email
        name:
          type: string
        avatar_url:
          type: string
          format: uri
        phone:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    UpdateUserRequest:
      type: object
      properties:
        name:
          type: string
          minLength: 2
          maxLength: 255
        phone:
          type: string

    ChangePasswordRequest:
      type: object
      required: [current_password, new_password]
      properties:
        current_password:
          type: string
        new_password:
          type: string
          minLength: 8

    # -------------------------------------------------------------------------
    # Notification Schemas
    # -------------------------------------------------------------------------
    Notification:
      type: object
      properties:
        id:
          type: string
          format: uuid
        user_id:
          type: string
          format: uuid
        type:
          type: string
          enum: [info, warning, error, success, system]
        title:
          type: string
        message:
          type: string
        is_read:
          type: boolean
        metadata:
          type: object
        created_at:
          type: string
          format: date-time

    NotificationList:
      type: object
      properties:
        data:
          type: object
          properties:
            notifications:
              type: array
              items:
                $ref: "#/components/schemas/Notification"
            pagination:
              $ref: "#/components/schemas/Pagination"

    UnreadCount:
      type: object
      properties:
        data:
          type: object
          properties:
            count:
              type: integer

    # -------------------------------------------------------------------------
    # Workspace Schemas
    # -------------------------------------------------------------------------
    Workspace:
      type: object
      properties:
        id:
          type: string
          format: uuid
        owner_id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        member_count:
          type: integer
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateWorkspaceRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
          minLength: 2
          maxLength: 100
        description:
          type: string
          maxLength: 1000

    UpdateWorkspaceRequest:
      type: object
      properties:
        name:
          type: string
        description:
          type: string

    Member:
      type: object
      properties:
        id:
          type: string
          format: uuid
        user_id:
          type: string
          format: uuid
        workspace_id:
          type: string
          format: uuid
        role:
          type: string
          enum: [owner, admin, editor, viewer]
        joined_at:
          type: string
          format: date-time

    AddMemberRequest:
      type: object
      required: [user_id, role]
      properties:
        user_id:
          type: string
          format: uuid
        role:
          type: string
          enum: [admin, editor, viewer]

    # -------------------------------------------------------------------------
    # Floor Plan Schemas
    # -------------------------------------------------------------------------
    FloorPlan:
      type: object
      properties:
        id:
          type: string
          format: uuid
        workspace_id:
          type: string
          format: uuid
        user_id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        address:
          type: string
        status:
          type: string
          enum: [uploaded, processing, recognized, failed]
        image_url:
          type: string
          format: uri
        thumbnail_url:
          type: string
          format: uri
        scene_id:
          type: string
          format: uuid
        recognition_result:
          $ref: "#/components/schemas/RecognitionResult"
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    RecognitionResult:
      type: object
      properties:
        rooms_count:
          type: integer
        total_area:
          type: number
          format: float
        living_area:
          type: number
          format: float
        confidence:
          type: number
          format: float
        rooms:
          type: array
          items:
            $ref: "#/components/schemas/RecognizedRoom"

    RecognizedRoom:
      type: object
      properties:
        type:
          type: string
          enum:
            [
              living_room,
              bedroom,
              kitchen,
              bathroom,
              toilet,
              hallway,
              balcony,
              storage,
              other,
            ]
        name:
          type: string
        area:
          type: number
          format: float

    UpdateFloorPlanRequest:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        address:
          type: string

    RecognitionStatus:
      type: object
      properties:
        data:
          type: object
          properties:
            job_id:
              type: string
              format: uuid
            status:
              type: string
              enum: [pending, processing, completed, failed]
            progress:
              type: integer
              description: Progress 0-100
            result:
              $ref: "#/components/schemas/AIRecognitionResult"
            error:
              type: string

    # -------------------------------------------------------------------------
    # Scene Schemas
    # -------------------------------------------------------------------------
    Scene:
      type: object
      properties:
        id:
          type: string
          format: uuid
        workspace_id:
          type: string
          format: uuid
        floor_plan_id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        status:
          type: string
          enum: [draft, active, archived]
        element_count:
          type: integer
        branch_count:
          type: integer
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateSceneRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
        description:
          type: string
        floor_plan_id:
          type: string
          format: uuid

    UpdateSceneRequest:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        status:
          type: string
          enum: [draft, active, archived]

    SceneComplianceResult:
      type: object
      properties:
        data:
          type: object
          properties:
            scene_id:
              type: string
              format: uuid
            status:
              type: string
              enum: [passed, warning, failed]
            violations:
              type: array
              items:
                $ref: "#/components/schemas/Violation"
            checked_at:
              type: string
              format: date-time

    # -------------------------------------------------------------------------
    # Branch Schemas
    # -------------------------------------------------------------------------
    Branch:
      type: object
      properties:
        id:
          type: string
          format: uuid
        scene_id:
          type: string
          format: uuid
        parent_branch_id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        status:
          type: string
          enum: [active, archived, merged]
        is_main:
          type: boolean
        created_by:
          type: string
          format: uuid
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateBranchRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
          minLength: 2
        description:
          type: string
        parent_branch_id:
          type: string
          format: uuid

    UpdateBranchRequest:
      type: object
      properties:
        name:
          type: string
        description:
          type: string

    BranchComparison:
      type: object
      properties:
        data:
          type: object
          properties:
            source_branch:
              $ref: "#/components/schemas/Branch"
            target_branch:
              $ref: "#/components/schemas/Branch"
            differences:
              type: array
              items:
                type: object
                properties:
                  element_id:
                    type: string
                  change_type:
                    type: string
                    enum: [added, removed, modified]
                  description:
                    type: string

    MergeBranchRequest:
      type: object
      required: [target_branch_id]
      properties:
        target_branch_id:
          type: string
          format: uuid
        strategy:
          type: string
          enum: [overwrite, merge]
          default: merge

    # -------------------------------------------------------------------------
    # Compliance Schemas
    # -------------------------------------------------------------------------
    ComplianceCheckRequest:
      type: object
      required: [scene_id]
      properties:
        scene_id:
          type: string
          format: uuid
        branch_id:
          type: string
          format: uuid
        categories:
          type: array
          items:
            type: string

    ComplianceCheckResponse:
      type: object
      properties:
        data:
          type: object
          properties:
            check_id:
              type: string
              format: uuid
            scene_id:
              type: string
              format: uuid
            status:
              type: string
              enum: [passed, warning, failed]
            score:
              type: integer
              description: 0-100
            violation_count:
              type: integer
            warning_count:
              type: integer
            violations:
              type: array
              items:
                $ref: "#/components/schemas/Violation"
            checked_at:
              type: string
              format: date-time

    CheckOperationRequest:
      type: object
      required: [scene_id, operation]
      properties:
        scene_id:
          type: string
          format: uuid
        branch_id:
          type: string
          format: uuid
        operation:
          type: object
          properties:
            type:
              type: string
              enum:
                [
                  add_wall,
                  remove_wall,
                  move_wall,
                  add_room,
                  remove_room,
                  merge_rooms,
                ]
            element_id:
              type: string
              format: uuid
            parameters:
              type: object

    Violation:
      type: object
      properties:
        id:
          type: string
          format: uuid
        rule_id:
          type: string
        rule_name:
          type: string
        category:
          type: string
        severity:
          type: string
          enum: [error, warning, info]
        description:
          type: string
        recommendations:
          type: array
          items:
            type: string
        legal_reference:
          type: string

    ComplianceRule:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        category:
          type: string
        description:
          type: string
        severity:
          type: string
          enum: [error, warning, info]
        legal_reference:
          type: string
        is_active:
          type: boolean

    GenerateReportRequest:
      type: object
      required: [scene_id]
      properties:
        scene_id:
          type: string
          format: uuid
        branch_id:
          type: string
          format: uuid
        format:
          type: string
          enum: [pdf, html, json]
          default: pdf
        include_recommendations:
          type: boolean
          default: true

    # -------------------------------------------------------------------------
    # Request (Expert) Schemas
    # -------------------------------------------------------------------------
    ExpertRequest:
      type: object
      properties:
        id:
          type: string
          format: uuid
        workspace_id:
          type: string
          format: uuid
        user_id:
          type: string
          format: uuid
        title:
          type: string
        description:
          type: string
        category:
          type: string
          enum: [consultation, documentation, expert_visit, full_package]
        priority:
          type: string
          enum: [low, normal, high, urgent]
        status:
          type: string
          enum:
            [
              draft,
              pending,
              in_review,
              approved,
              rejected,
              assigned,
              in_progress,
              completed,
              cancelled,
            ]
        expert_id:
          type: string
          format: uuid
        estimated_cost:
          type: integer
        final_cost:
          type: integer
        contact_phone:
          type: string
        contact_email:
          type: string
          format: email
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateExpertRequestRequest:
      type: object
      required: [workspace_id, title, description, category]
      properties:
        workspace_id:
          type: string
          format: uuid
        title:
          type: string
          minLength: 5
          maxLength: 200
        description:
          type: string
          minLength: 10
        category:
          type: string
          enum: [consultation, documentation, expert_visit, full_package]
        priority:
          type: string
          enum: [low, normal, high, urgent]
          default: normal
        contact_phone:
          type: string
        contact_email:
          type: string
          format: email

    UpdateExpertRequestRequest:
      type: object
      properties:
        title:
          type: string
        description:
          type: string
        priority:
          type: string
          enum: [low, normal, high, urgent]
        contact_phone:
          type: string
        contact_email:
          type: string
          format: email

    RequestDocument:
      type: object
      properties:
        id:
          type: string
          format: uuid
        request_id:
          type: string
          format: uuid
        name:
          type: string
        type:
          type: string
        url:
          type: string
          format: uri
        uploaded_at:
          type: string
          format: date-time

    # -------------------------------------------------------------------------
    # AI Schemas
    # -------------------------------------------------------------------------
    RecognizeRequest:
      type: object
      required: [floor_plan_id]
      properties:
        floor_plan_id:
          type: string
          format: uuid
          description: ID –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
        image_base64:
          type: string
          description: Base64-encoded –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ floor_plan_id)
        options:
          type: object
          properties:
            detect_load_bearing:
              type: boolean
              default: true
              description: –û–ø—Ä–µ–¥–µ–ª—è—Ç—å –Ω–µ—Å—É—â–∏–µ —Å—Ç–µ–Ω—ã
            detect_wet_zones:
              type: boolean
              default: true
              description: –û–ø—Ä–µ–¥–µ–ª—è—Ç—å –º–æ–∫—Ä—ã–µ –∑–æ–Ω—ã
            detect_furniture:
              type: boolean
              default: true
              description: –û–ø—Ä–µ–¥–µ–ª—è—Ç—å –º–µ–±–µ–ª—å –∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ
            detail_level:
              type: integer
              minimum: 1
              maximum: 3
              default: 2
              description: –£—Ä–æ–≤–µ–Ω—å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ (1-3)

    RecognizeResponse:
      type: object
      properties:
        data:
          type: object
          properties:
            job_id:
              type: string
              format: uuid
            status:
              type: string
              enum: [pending, processing, completed, failed]
            success:
              type: boolean

    AIRecognitionResult:
      type: object
      description: –ü–æ–ª–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –¥–ª—è 3D –º–æ–¥–µ–ª–∏
      properties:
        bounds:
          type: object
          description: –ì–∞–±–∞—Ä–∏—Ç—ã –∫–≤–∞—Ä—Ç–∏—Ä—ã –≤ –º–µ—Ç—Ä–∞—Ö
          properties:
            width:
              type: number
              description: –®–∏—Ä–∏–Ω–∞ –ø–æ X
            height:
              type: number
              description: –í—ã—Å–æ—Ç–∞ –ø–æ—Ç–æ–ª–∫–æ–≤
            depth:
              type: number
              description: –ì–ª—É–±–∏–Ω–∞ –ø–æ Z
        total_area:
          type: number
          description: –û–±—â–∞—è –ø–ª–æ—â–∞–¥—å –≤ –º¬≤
        stats:
          type: object
          properties:
            totalArea:
              type: number
            roomsCount:
              type: integer
            wallsCount:
              type: integer
            furnitureCount:
              type: integer
        walls:
          type: array
          items:
            $ref: "#/components/schemas/RecognizedWall3D"
        rooms:
          type: array
          items:
            $ref: "#/components/schemas/RecognizedRoom3D"
        openings:
          type: array
          items:
            $ref: "#/components/schemas/RecognizedOpening"
        recognition:
          type: object
          properties:
            sourceType:
              type: string
              enum: [BTI, technical_passport, architect_plan, sketch, photo]
            quality:
              type: string
              enum: [high, medium, low]
            scale:
              type: string
            buildingType:
              type: string
              enum: [panel, brick, monolith, block, frame, unknown]

    RecognizedWall3D:
      type: object
      properties:
        temp_id:
          type: string
        start:
          type: object
          properties:
            x:
              type: number
            y:
              type: number
        end:
          type: object
          properties:
            x:
              type: number
            y:
              type: number
        thickness:
          type: number
          description: –¢–æ–ª—â–∏–Ω–∞ –≤ –º–µ—Ç—Ä–∞—Ö (0.08-0.50)
        is_load_bearing:
          type: boolean
          description: –ù–µ—Å—É—â–∞—è —Å—Ç–µ–Ω–∞
        material:
          type: string
          enum: [brick, concrete, drywall, block, panel, foam_block, gas_block]
        can_demolish:
          type: boolean
        confidence:
          type: number
          minimum: 0
          maximum: 1

    RecognizedRoom3D:
      type: object
      properties:
        temp_id:
          type: string
        type:
          type: string
          enum: [living, bedroom, kitchen, bathroom, toilet, combined_bathroom, hallway, corridor, storage, balcony, loggia, children, office, dining]
        name:
          type: string
        polygon:
          type: array
          items:
            type: object
            properties:
              x:
                type: number
              y:
                type: number
        area:
          type: number
        perimeter:
          type: number
        is_wet_zone:
          type: boolean
        has_window:
          type: boolean
        wall_ids:
          type: array
          items:
            type: string
        confidence:
          type: number

    RecognizedOpening:
      type: object
      properties:
        temp_id:
          type: string
        type:
          type: string
          enum: [door, window, passage, arch]
        subtype:
          type: string
          enum: [single_swing, double_swing, sliding, entrance, balcony, panoramic]
        wall_id:
          type: string
        position:
          type: number
          description: –ü–æ–∑–∏—Ü–∏—è –æ—Ç –Ω–∞—á–∞–ª–∞ —Å—Ç–µ–Ω—ã –≤ –º–µ—Ç—Ä–∞—Ö
        width:
          type: number
        height:
          type: number
        elevation:
          type: number
          description: –í—ã—Å–æ—Ç–∞ –æ—Ç –ø–æ–ª–∞ (0 –¥–ª—è –¥–≤–µ—Ä–µ–π, 0.85 –¥–ª—è –æ–∫–æ–Ω)
        confidence:
          type: number

    GenerateVariantsRequest:
      type: object
      required: [scene_id, count]
      properties:
        scene_id:
          type: string
          format: uuid
        branch_id:
          type: string
          format: uuid
        count:
          type: integer
          minimum: 1
          maximum: 5
        style:
          type: string
          enum: [modern, classic, minimalist, scandinavian, loft]
        priorities:
          type: array
          items:
            type: string
        constraints:
          type: object

    GenerateResponse:
      type: object
      properties:
        data:
          type: object
          properties:
            job_id:
              type: string
              format: uuid
            status:
              type: string
              enum: [queued, processing]

    GenerationStatus:
      type: object
      properties:
        data:
          type: object
          properties:
            job_id:
              type: string
              format: uuid
            status:
              type: string
              enum: [queued, processing, completed, failed]
            progress:
              type: integer
            variants:
              type: array
              items:
                $ref: "#/components/schemas/GeneratedVariant"
            error:
              type: string

    GeneratedVariant:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        branch_id:
          type: string
          format: uuid
        quality_score:
          type: integer
        preview_url:
          type: string
          format: uri

    ChatMessageRequest:
      type: object
      required: [message]
      properties:
        session_id:
          type: string
          format: uuid
        message:
          type: string
          minLength: 1
          maxLength: 4000
        scene_id:
          type: string
          format: uuid

    ChatMessageResponse:
      type: object
      properties:
        data:
          type: object
          properties:
            session_id:
              type: string
              format: uuid
            message_id:
              type: string
              format: uuid
            response:
              type: string
            suggestions:
              type: array
              items:
                type: object
                properties:
                  type:
                    type: string
                  title:
                    type: string
                  description:
                    type: string

    ChatHistory:
      type: object
      properties:
        data:
          type: object
          properties:
            session_id:
              type: string
              format: uuid
            messages:
              type: array
              items:
                type: object
                properties:
                  id:
                    type: string
                    format: uuid
                  role:
                    type: string
                    enum: [user, assistant]
                  content:
                    type: string
                  created_at:
                    type: string
                    format: date-time

# =============================================================================
# Paths
# =============================================================================
paths:
  # ---------------------------------------------------------------------------
  # Auth Endpoints
  # ---------------------------------------------------------------------------
  /auth/register:
    post:
      tags: [auth]
      summary: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      description: –°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é —É—á–µ—Ç–Ω—É—é –∑–∞–ø–∏—Å—å –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–∫–µ–Ω—ã
      operationId: register
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RegisterRequest"
      responses:
        "201":
          description: –£—Å–ø–µ—à–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthResponse"
        "400":
          description: –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ValidationError"
        "409":
          description: Email —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω

  /auth/login:
    post:
      tags: [auth]
      summary: –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
      operationId: login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginRequest"
      responses:
        "200":
          description: –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthResponse"
        "401":
          description: –ù–µ–≤–µ—Ä–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

  /auth/refresh:
    post:
      tags: [auth]
      summary: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
      operationId: refreshTokens
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RefreshRequest"
      responses:
        "200":
          description: –¢–æ–∫–µ–Ω—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthResponse"
        "401":
          description: –ù–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π refresh token

  /auth/logout:
    post:
      tags: [auth]
      summary: –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
      operationId: logout
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LogoutRequest"
      responses:
        "200":
          description: –£—Å–ø–µ—à–Ω—ã–π –≤—ã—Ö–æ–¥
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"

  /auth/logout-all:
    post:
      tags: [auth]
      summary: –í—ã—Ö–æ–¥ —Å–æ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
      description: –ò–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –≤—Å–µ refresh —Ç–æ–∫–µ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      operationId: logoutAll
      security:
        - BearerAuth: []
      responses:
        "200":
          description: –í—ã—Ö–æ–¥ —Å–æ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"

  # ---------------------------------------------------------------------------
  # User Endpoints
  # ---------------------------------------------------------------------------
  /users/me:
    get:
      tags: [users]
      summary: –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
      operationId: getProfile
      security:
        - BearerAuth: []
      responses:
        "200":
          description: –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/User"
        "401":
          description: –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω

    patch:
      tags: [users]
      summary: –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
      operationId: updateProfile
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateUserRequest"
      responses:
        "200":
          description: –ü—Ä–æ—Ñ–∏–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/User"

    delete:
      tags: [users]
      summary: –£–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç
      description: –ü–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª—è–µ—Ç —É—á–µ—Ç–Ω—É—é –∑–∞–ø–∏—Å—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      operationId: deleteAccount
      security:
        - BearerAuth: []
      responses:
        "200":
          description: –ê–∫–∫–∞—É–Ω—Ç —É–¥–∞–ª–µ–Ω
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"

  /users/me/password:
    put:
      tags: [users]
      summary: –°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å
      operationId: changePassword
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ChangePasswordRequest"
      responses:
        "200":
          description: –ü–∞—Ä–æ–ª—å –∏–∑–º–µ–Ω–µ–Ω
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
        "400":
          description: –ù–µ–≤–µ—Ä–Ω—ã–π —Ç–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å

  # ---------------------------------------------------------------------------
  # Notification Endpoints
  # ---------------------------------------------------------------------------
  /notifications:
    get:
      tags: [notifications]
      summary: –°–ø–∏—Å–æ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
      operationId: getNotifications
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: page_size
          in: query
          schema:
            type: integer
            default: 20
        - name: is_read
          in: query
          description: –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É –ø—Ä–æ—á—Ç–µ–Ω–∏—è
          schema:
            type: boolean
      responses:
        "200":
          description: –°–ø–∏—Å–æ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NotificationList"

    delete:
      tags: [notifications]
      summary: –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
      operationId: deleteAllReadNotifications
      security:
        - BearerAuth: []
      responses:
        "200":
          description: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω—ã
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"

  /notifications/count:
    get:
      tags: [notifications]
      summary: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö
      operationId: getUnreadCount
      security:
        - BearerAuth: []
      responses:
        "200":
          description: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UnreadCount"

  /notifications/{id}/read:
    post:
      tags: [notifications]
      summary: –û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ
      operationId: markAsRead
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –û—Ç–º–µ—á–µ–Ω–æ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"

  /notifications/read-all:
    post:
      tags: [notifications]
      summary: –û—Ç–º–µ—Ç–∏—Ç—å –≤—Å–µ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ
      operationId: markAllAsRead
      security:
        - BearerAuth: []
      responses:
        "200":
          description: –í—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–º–µ—á–µ–Ω—ã –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"

  /notifications/{id}:
    delete:
      tags: [notifications]
      summary: –£–¥–∞–ª–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
      operationId: deleteNotification
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"

  # ---------------------------------------------------------------------------
  # Workspace Endpoints
  # ---------------------------------------------------------------------------
  /workspaces:
    get:
      tags: [workspaces]
      summary: –°–ø–∏—Å–æ–∫ –≤–æ—Ä–∫—Å–ø–µ–π—Å–æ–≤
      operationId: listWorkspaces
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: page_size
          in: query
          schema:
            type: integer
            default: 20
        - name: name
          in: query
          description: –§–∏–ª—å—Ç—Ä –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
          schema:
            type: string
      responses:
        "200":
          description: –°–ø–∏—Å–æ–∫ –≤–æ—Ä–∫—Å–ø–µ–π—Å–æ–≤
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      workspaces:
                        type: array
                        items:
                          $ref: "#/components/schemas/Workspace"
                      pagination:
                        $ref: "#/components/schemas/Pagination"

    post:
      tags: [workspaces]
      summary: –°–æ–∑–¥–∞—Ç—å –≤–æ—Ä–∫—Å–ø–µ–π—Å
      operationId: createWorkspace
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateWorkspaceRequest"
      responses:
        "201":
          description: –í–æ—Ä–∫—Å–ø–µ–π—Å —Å–æ–∑–¥–∞–Ω
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Workspace"

  /workspaces/{id}:
    get:
      tags: [workspaces]
      summary: –ü–æ–ª—É—á–∏—Ç—å –≤–æ—Ä–∫—Å–ø–µ–π—Å
      operationId: getWorkspace
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –î–∞–Ω–Ω—ã–µ –≤–æ—Ä–∫—Å–ø–µ–π—Å–∞
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Workspace"
        "404":
          description: –ù–µ –Ω–∞–π–¥–µ–Ω

    patch:
      tags: [workspaces]
      summary: –û–±–Ω–æ–≤–∏—Ç—å –≤–æ—Ä–∫—Å–ø–µ–π—Å
      operationId: updateWorkspace
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateWorkspaceRequest"
      responses:
        "200":
          description: –í–æ—Ä–∫—Å–ø–µ–π—Å –æ–±–Ω–æ–≤–ª–µ–Ω
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Workspace"

    delete:
      tags: [workspaces]
      summary: –£–¥–∞–ª–∏—Ç—å –≤–æ—Ä–∫—Å–ø–µ–π—Å
      operationId: deleteWorkspace
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –í–æ—Ä–∫—Å–ø–µ–π—Å —É–¥–∞–ª–µ–Ω
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"

  /workspaces/{id}/members:
    get:
      tags: [workspaces]
      summary: –°–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≤–æ—Ä–∫—Å–ø–µ–π—Å–∞
      operationId: getWorkspaceMembers
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –°–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      members:
                        type: array
                        items:
                          $ref: "#/components/schemas/Member"

    post:
      tags: [workspaces]
      summary: –î–æ–±–∞–≤–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞
      operationId: addWorkspaceMember
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AddMemberRequest"
      responses:
        "201":
          description: –£—á–∞—Å—Ç–Ω–∏–∫ –¥–æ–±–∞–≤–ª–µ–Ω
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Member"

  /workspaces/{id}/members/{memberId}:
    delete:
      tags: [workspaces]
      summary: –£–¥–∞–ª–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞
      operationId: removeWorkspaceMember
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: memberId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –£—á–∞—Å—Ç–Ω–∏–∫ —É–¥–∞–ª–µ–Ω
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"

  /workspaces/{workspace_id}/scenes:
    get:
      tags: [workspaces, scenes]
      summary: –°–ø–∏—Å–æ–∫ —Å—Ü–µ–Ω –≤–æ—Ä–∫—Å–ø–µ–π—Å–∞
      operationId: listWorkspaceScenes
      security:
        - BearerAuth: []
      parameters:
        - name: workspace_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: page_size
          in: query
          schema:
            type: integer
            default: 20
      responses:
        "200":
          description: –°–ø–∏—Å–æ–∫ —Å—Ü–µ–Ω
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      scenes:
                        type: array
                        items:
                          $ref: "#/components/schemas/Scene"
                      pagination:
                        $ref: "#/components/schemas/Pagination"

    post:
      tags: [workspaces, scenes]
      summary: –°–æ–∑–¥–∞—Ç—å —Å—Ü–µ–Ω—É –≤ –≤–æ—Ä–∫—Å–ø–µ–π—Å–µ
      operationId: createWorkspaceScene
      security:
        - BearerAuth: []
      parameters:
        - name: workspace_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateSceneRequest"
      responses:
        "201":
          description: –°—Ü–µ–Ω–∞ —Å–æ–∑–¥–∞–Ω–∞
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Scene"

  # ---------------------------------------------------------------------------
  # Scene Endpoints
  # ---------------------------------------------------------------------------
  /scenes/{id}:
    get:
      tags: [scenes]
      summary: –ü–æ–ª—É—á–∏—Ç—å —Å—Ü–µ–Ω—É
      operationId: getScene
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –î–∞–Ω–Ω—ã–µ —Å—Ü–µ–Ω—ã
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Scene"

    patch:
      tags: [scenes]
      summary: –û–±–Ω–æ–≤–∏—Ç—å —Å—Ü–µ–Ω—É
      operationId: updateScene
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateSceneRequest"
      responses:
        "200":
          description: –°—Ü–µ–Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Scene"

    delete:
      tags: [scenes]
      summary: –£–¥–∞–ª–∏—Ç—å —Å—Ü–µ–Ω—É
      operationId: deleteScene
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –°—Ü–µ–Ω–∞ —É–¥–∞–ª–µ–Ω–∞
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"

  /scenes/{id}/compliance:
    get:
      tags: [scenes, compliance]
      summary: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ü–µ–Ω—É –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –Ω–æ—Ä–º–∞–º
      operationId: checkSceneCompliance
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SceneComplianceResult"

  # ---------------------------------------------------------------------------
  # Floor Plan Endpoints
  # ---------------------------------------------------------------------------
  /floor-plans:
    get:
      tags: [floor-plans]
      summary: –°–ø–∏—Å–æ–∫ –ø–ª–∞–Ω–∏—Ä–æ–≤–æ–∫
      operationId: listFloorPlans
      security:
        - BearerAuth: []
      parameters:
        - name: workspace_id
          in: query
          schema:
            type: string
            format: uuid
        - name: status
          in: query
          schema:
            type: string
            enum: [uploaded, processing, recognized, failed]
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: page_size
          in: query
          schema:
            type: integer
            default: 20
      responses:
        "200":
          description: –°–ø–∏—Å–æ–∫ –ø–ª–∞–Ω–∏—Ä–æ–≤–æ–∫
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      floor_plans:
                        type: array
                        items:
                          $ref: "#/components/schemas/FloorPlan"
                      pagination:
                        $ref: "#/components/schemas/Pagination"

    post:
      tags: [floor-plans]
      summary: –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤–∫—É
      operationId: uploadFloorPlan
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [workspace_id, name, file]
              properties:
                workspace_id:
                  type: string
                  format: uuid
                name:
                  type: string
                description:
                  type: string
                address:
                  type: string
                file:
                  type: string
                  format: binary
      responses:
        "201":
          description: –ü–ª–∞–Ω–∏—Ä–æ–≤–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/FloorPlan"

  /floor-plans/{id}:
    get:
      tags: [floor-plans]
      summary: –ü–æ–ª—É—á–∏—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤–∫—É
      operationId: getFloorPlan
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –î–∞–Ω–Ω—ã–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/FloorPlan"

    patch:
      tags: [floor-plans]
      summary: –û–±–Ω–æ–≤–∏—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤–∫—É
      operationId: updateFloorPlan
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateFloorPlanRequest"
      responses:
        "200":
          description: –ü–ª–∞–Ω–∏—Ä–æ–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/FloorPlan"

    delete:
      tags: [floor-plans]
      summary: –£–¥–∞–ª–∏—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤–∫—É
      operationId: deleteFloorPlan
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –ü–ª–∞–Ω–∏—Ä–æ–≤–∫–∞ —É–¥–∞–ª–µ–Ω–∞
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"

  /floor-plans/{id}/recognize:
    post:
      tags: [floor-plans, ai]
      summary: –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏
      operationId: startFloorPlanRecognition
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                create_scene:
                  type: boolean
                  default: true
                detect_furniture:
                  type: boolean
                  default: false
      responses:
        "202":
          description: –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      job_id:
                        type: string
                        format: uuid
                      status:
                        type: string
                        example: processing

  /floor-plans/{id}/recognition-status:
    get:
      tags: [floor-plans, ai]
      summary: –°—Ç–∞—Ç—É—Å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏
      operationId: getFloorPlanRecognitionStatus
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –°—Ç–∞—Ç—É—Å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RecognitionStatus"

  /floor-plans/{id}/download-url:
    get:
      tags: [floor-plans]
      summary: –ü–æ–ª—É—á–∏—Ç—å URL –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
      operationId: getFloorPlanDownloadURL
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: URL –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      url:
                        type: string
                        format: uri
                      expires_at:
                        type: string
                        format: date-time

  # ---------------------------------------------------------------------------
  # Branch Endpoints
  # ---------------------------------------------------------------------------
  /scenes/{scene_id}/branches:
    get:
      tags: [branches]
      summary: –°–ø–∏—Å–æ–∫ –≤–µ—Ç–æ–∫ —Å—Ü–µ–Ω—ã
      operationId: listBranches
      security:
        - BearerAuth: []
      parameters:
        - name: scene_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: status
          in: query
          schema:
            type: string
            enum: [active, archived, merged]
      responses:
        "200":
          description: –°–ø–∏—Å–æ–∫ –≤–µ—Ç–æ–∫
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      branches:
                        type: array
                        items:
                          $ref: "#/components/schemas/Branch"

    post:
      tags: [branches]
      summary: –°–æ–∑–¥–∞—Ç—å –≤–µ—Ç–∫—É
      operationId: createBranch
      security:
        - BearerAuth: []
      parameters:
        - name: scene_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateBranchRequest"
      responses:
        "201":
          description: –í–µ—Ç–∫–∞ —Å–æ–∑–¥–∞–Ω–∞
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Branch"

  /scenes/{scene_id}/branches/{id}:
    get:
      tags: [branches]
      summary: –ü–æ–ª—É—á–∏—Ç—å –≤–µ—Ç–∫—É
      operationId: getBranch
      security:
        - BearerAuth: []
      parameters:
        - name: scene_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –î–∞–Ω–Ω—ã–µ –≤–µ—Ç–∫–∏
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Branch"

    patch:
      tags: [branches]
      summary: –û–±–Ω–æ–≤–∏—Ç—å –≤–µ—Ç–∫—É
      operationId: updateBranch
      security:
        - BearerAuth: []
      parameters:
        - name: scene_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateBranchRequest"
      responses:
        "200":
          description: –í–µ—Ç–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Branch"

    delete:
      tags: [branches]
      summary: –£–¥–∞–ª–∏—Ç—å –≤–µ—Ç–∫—É
      operationId: deleteBranch
      security:
        - BearerAuth: []
      parameters:
        - name: scene_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –í–µ—Ç–∫–∞ —É–¥–∞–ª–µ–Ω–∞
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"

  /scenes/{scene_id}/branches/{id}/activate:
    post:
      tags: [branches]
      summary: –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Ç–∫—É
      description: –î–µ–ª–∞–µ—Ç –≤–µ—Ç–∫—É –∞–∫—Ç–∏–≤–Ω–æ–π (—Ç–µ–∫—É—â–µ–π –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
      operationId: activateBranch
      security:
        - BearerAuth: []
      parameters:
        - name: scene_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –í–µ—Ç–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Branch"

  /scenes/{scene_id}/branches/{id}/duplicate:
    post:
      tags: [branches]
      summary: –î—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Ç–∫—É
      operationId: duplicateBranch
      security:
        - BearerAuth: []
      parameters:
        - name: scene_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  description: –ù–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–π –≤–µ—Ç–∫–∏
      responses:
        "201":
          description: –í–µ—Ç–∫–∞ –ø—Ä–æ–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∞
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Branch"

  /scenes/{scene_id}/branches/{id}/compare/{target_id}:
    get:
      tags: [branches]
      summary: –°—Ä–∞–≤–Ω–∏—Ç—å –¥–≤–µ –≤–µ—Ç–∫–∏
      operationId: compareBranches
      security:
        - BearerAuth: []
      parameters:
        - name: scene_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: id
          in: path
          required: true
          description: ID –∏—Å—Ö–æ–¥–Ω–æ–π –≤–µ—Ç–∫–∏
          schema:
            type: string
            format: uuid
        - name: target_id
          in: path
          required: true
          description: ID —Ü–µ–ª–µ–≤–æ–π –≤–µ—Ç–∫–∏ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –†–µ–∑—É–ª—å—Ç–∞—Ç —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BranchComparison"

  /scenes/{scene_id}/branches/{id}/merge:
    post:
      tags: [branches]
      summary: –°–ª–∏—Ç—å –≤–µ—Ç–∫–∏
      operationId: mergeBranches
      security:
        - BearerAuth: []
      parameters:
        - name: scene_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: id
          in: path
          required: true
          description: ID –∏—Å—Ö–æ–¥–Ω–æ–π –≤–µ—Ç–∫–∏ (–∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç —Å–ª–∏—Ç–∞)
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/MergeBranchRequest"
      responses:
        "200":
          description: –í–µ—Ç–∫–∏ —Å–ª–∏—Ç—ã
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Branch"

  # ---------------------------------------------------------------------------
  # AI Endpoints
  # ---------------------------------------------------------------------------
  /ai/recognize:
    post:
      tags: [ai]
      summary: –†–∞—Å–ø–æ–∑–Ω–∞—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤–∫—É
      operationId: recognizeFloorPlan
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RecognizeRequest"
      responses:
        "202":
          description: –ó–∞–¥–∞—á–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Å–æ–∑–¥–∞–Ω–∞
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RecognizeResponse"

  /ai/recognize/{job_id}/status:
    get:
      tags: [ai]
      summary: –°—Ç–∞—Ç—É—Å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
      operationId: getRecognitionStatus
      security:
        - BearerAuth: []
      parameters:
        - name: job_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –°—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RecognitionStatus"

  /ai/generate:
    post:
      tags: [ai]
      summary: –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç—ã –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏
      operationId: generateVariants
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/GenerateVariantsRequest"
      responses:
        "202":
          description: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–ø—É—â–µ–Ω–∞
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GenerateResponse"

  /ai/generate/{job_id}/status:
    get:
      tags: [ai]
      summary: –°—Ç–∞—Ç—É—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
      operationId: getGenerationStatus
      security:
        - BearerAuth: []
      parameters:
        - name: job_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –°—Ç–∞—Ç—É—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GenerationStatus"

  /ai/chat:
    post:
      tags: [ai]
      summary: –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç—É
      operationId: sendChatMessage
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ChatMessageRequest"
      responses:
        "200":
          description: –û—Ç–≤–µ—Ç AI
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ChatMessageResponse"
        "429":
          description: –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤

  /ai/chat/history:
    get:
      tags: [ai]
      summary: –ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞
      operationId: getChatHistory
      security:
        - BearerAuth: []
      parameters:
        - name: session_id
          in: query
          schema:
            type: string
            format: uuid
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
      responses:
        "200":
          description: –ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ChatHistory"

    delete:
      tags: [ai]
      summary: –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–∞
      operationId: clearChatHistory
      security:
        - BearerAuth: []
      parameters:
        - name: session_id
          in: query
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –ò—Å—Ç–æ—Ä–∏—è –æ—á–∏—â–µ–Ω–∞
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"

  /ai/context:
    get:
      tags: [ai]
      summary: –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç AI
      description: –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç AI –¥–ª—è —Å—Ü–µ–Ω—ã (–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–µ)
      operationId: getAIContext
      security:
        - BearerAuth: []
      parameters:
        - name: scene_id
          in: query
          required: true
          schema:
            type: string
            format: uuid
        - name: branch_id
          in: query
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –ö–æ–Ω—Ç–µ–∫—Å—Ç AI
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      context_id:
                        type: string
                      scene_summary:
                        type: string
                        description: –û–ø–∏—Å–∞–Ω–∏–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ –¥–ª—è AI
                      context_size:
                        type: integer
                        description: –†–∞–∑–º–µ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤ —Ç–æ–∫–µ–Ω–∞—Ö
                      updated_at:
                        type: string
                        format: date-time
    post:
      tags: [ai]
      summary: –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç AI
      description: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç AI –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Å—Ü–µ–Ω–µ
      operationId: updateAIContext
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - scene_id
              properties:
                scene_id:
                  type: string
                  format: uuid
                branch_id:
                  type: string
                  format: uuid
                force:
                  type: boolean
                  default: false
                  description: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
      responses:
        "200":
          description: –ö–æ–Ω—Ç–µ–∫—Å—Ç –æ–±–Ω–æ–≤–ª—ë–Ω
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      context_id:
                        type: string
                      updated:
                        type: boolean
                      context_size:
                        type: integer

  /scenes/{scene_id}/chat/messages/{message_id}/select:
    post:
      tags: [ai, scenes]
      summary: –í—ã–±—Ä–∞—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç –∏–∑ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã—Ö AI
      description: –í—ã–±–æ—Ä –≤–∞—Ä–∏–∞–Ω—Ç–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ –∏–∑ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã—Ö AI. –ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –≤–µ—Ç–∫—É.
      operationId: selectSuggestion
      security:
        - BearerAuth: []
      parameters:
        - name: scene_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: message_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: ID —Å–æ–æ–±—â–µ–Ω–∏—è —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - suggestion_index
              properties:
                suggestion_index:
                  type: integer
                  minimum: 0
                  maximum: 4
                  description: –ò–Ω–¥–µ–∫—Å –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞ (0-4)
      responses:
        "200":
          description: –í–∞—Ä–∏–∞–Ω—Ç –≤—ã–±—Ä–∞–Ω –∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      selected_branch_id:
                        type: string
                        format: uuid
                        description: ID –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≤–µ—Ç–∫–∏
                      branch_activated:
                        type: boolean
                        description: –ë—ã–ª–∞ –ª–∏ –≤–µ—Ç–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞
                      confirmation_message:
                        type: string
                        description: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç AI
        "400":
          description: –ù–µ–≤–µ—Ä–Ω—ã–π –∏–Ω–¥–µ–∫—Å –≤–∞—Ä–∏–∞–Ω—Ç–∞
        "404":
          description: –°–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ

  # ---------------------------------------------------------------------------
  # Compliance Endpoints
  # ---------------------------------------------------------------------------
  /compliance/check:
    post:
      tags: [compliance]
      summary: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –Ω–æ—Ä–º–∞–º
      operationId: checkCompliance
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ComplianceCheckRequest"
      responses:
        "200":
          description: –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ComplianceCheckResponse"

  /compliance/check-operation:
    post:
      tags: [compliance]
      summary: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ
      description: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –æ–ø–µ—Ä–∞—Ü–∏—é (—Å–Ω–æ—Å —Å—Ç–µ–Ω—ã, –ø–µ—Ä–µ–Ω–æ—Å –∏ —Ç.–¥.) –¥–æ –µ—ë –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
      operationId: checkOperation
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CheckOperationRequest"
      responses:
        "200":
          description: –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ComplianceCheckResponse"

  /compliance/rules:
    get:
      tags: [compliance]
      summary: –°–ø–∏—Å–æ–∫ –ø—Ä–∞–≤–∏–ª
      operationId: listComplianceRules
      security:
        - BearerAuth: []
      parameters:
        - name: category
          in: query
          schema:
            type: string
        - name: is_active
          in: query
          schema:
            type: boolean
      responses:
        "200":
          description: –°–ø–∏—Å–æ–∫ –ø—Ä–∞–≤–∏–ª
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      rules:
                        type: array
                        items:
                          $ref: "#/components/schemas/ComplianceRule"

  /compliance/rules/{id}:
    get:
      tags: [compliance]
      summary: –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–∞–≤–∏–ª–æ
      operationId: getComplianceRule
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: –î–∞–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/ComplianceRule"

  /compliance/report:
    post:
      tags: [compliance]
      summary: –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á–µ—Ç
      description: –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç PDF/HTML –æ—Ç—á–µ—Ç –æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ –Ω–æ—Ä–º–∞–º
      operationId: generateComplianceReport
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/GenerateReportRequest"
      responses:
        "200":
          description: –û—Ç—á–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      report_id:
                        type: string
                        format: uuid
                      download_url:
                        type: string
                        format: uri
                      expires_at:
                        type: string
                        format: date-time

  # ---------------------------------------------------------------------------
  # Request (Expert) Endpoints
  # ---------------------------------------------------------------------------
  /requests:
    get:
      tags: [requests]
      summary: –°–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫
      operationId: listRequests
      security:
        - BearerAuth: []
      parameters:
        - name: workspace_id
          in: query
          schema:
            type: string
            format: uuid
        - name: status
          in: query
          schema:
            type: string
            enum:
              [
                draft,
                pending,
                in_review,
                approved,
                rejected,
                assigned,
                in_progress,
                completed,
                cancelled,
              ]
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: page_size
          in: query
          schema:
            type: integer
            default: 20
      responses:
        "200":
          description: –°–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      requests:
                        type: array
                        items:
                          $ref: "#/components/schemas/ExpertRequest"
                      pagination:
                        $ref: "#/components/schemas/Pagination"

    post:
      tags: [requests]
      summary: –°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É
      operationId: createRequest
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateExpertRequestRequest"
      responses:
        "201":
          description: –ó–∞—è–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/ExpertRequest"

  /requests/{id}:
    get:
      tags: [requests]
      summary: –ü–æ–ª—É—á–∏—Ç—å –∑–∞—è–≤–∫—É
      operationId: getRequest
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –î–∞–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/ExpertRequest"

    patch:
      tags: [requests]
      summary: –û–±–Ω–æ–≤–∏—Ç—å –∑–∞—è–≤–∫—É
      operationId: updateRequest
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateExpertRequestRequest"
      responses:
        "200":
          description: –ó–∞—è–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/ExpertRequest"

    delete:
      tags: [requests]
      summary: –£–¥–∞–ª–∏—Ç—å –∑–∞—è–≤–∫—É
      description: –£–¥–∞–ª—è–µ—Ç –∑–∞—è–≤–∫—É (—Ç–æ–ª—å–∫–æ –≤ —Å—Ç–∞—Ç—É—Å–µ draft)
      operationId: deleteRequest
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –ó–∞—è–≤–∫–∞ —É–¥–∞–ª–µ–Ω–∞
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"

  /requests/{id}/submit:
    post:
      tags: [requests]
      summary: –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É
      description: –ü–µ—Ä–µ–≤–æ–¥–∏—Ç –∑–∞—è–≤–∫—É –∏–∑ draft –≤ pending
      operationId: submitRequest
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/ExpertRequest"

  /requests/{id}/cancel:
    post:
      tags: [requests]
      summary: –û—Ç–º–µ–Ω–∏—Ç—å –∑–∞—è–≤–∫—É
      operationId: cancelRequest
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                reason:
                  type: string
                  description: –ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–º–µ–Ω—ã
      responses:
        "200":
          description: –ó–∞—è–≤–∫–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/ExpertRequest"

  /requests/{id}/documents:
    get:
      tags: [requests]
      summary: –°–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∑–∞—è–≤–∫–∏
      operationId: getRequestDocuments
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –°–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      documents:
                        type: array
                        items:
                          $ref: "#/components/schemas/RequestDocument"

    post:
      tags: [requests]
      summary: –î–æ–±–∞–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç –∫ –∑–∞—è–≤–∫–µ
      operationId: addRequestDocument
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [file]
              properties:
                file:
                  type: string
                  format: binary
                name:
                  type: string
                type:
                  type: string
                  enum: [floor_plan, passport, contract, other]
      responses:
        "201":
          description: –î–æ–∫—É–º–µ–Ω—Ç –¥–æ–±–∞–≤–ª–µ–Ω
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/RequestDocument"
