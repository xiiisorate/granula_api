# =============================================================================
# Granula API - OpenAPI 3.0 Specification
# =============================================================================
# –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è REST API –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–º–æ–Ω—Ç–∞ –∏ –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏.
#
# –í–µ—Ä—Å–∏—è: 1.1.0
# –î–∞—Ç–∞: 2025-11-30
# =============================================================================

openapi: 3.0.3

info:
  title: Granula API
  version: 1.1.0
  description: |
    # Granula API

    API –¥–ª—è –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–º–æ–Ω—Ç–∞ –∏ –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ –∫–≤–∞—Ä—Ç–∏—Ä.

    ## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

    - üè† **–ó–∞–≥—Ä—É–∑–∫–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–æ–∫** - –ó–∞–≥—Ä—É–∂–∞–π—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–ª–∞–Ω–∏—Ä–æ–≤–æ–∫ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
    - ü§ñ **AI —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ** - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç, —Å—Ç–µ–Ω –∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
    - üé® **3D —Ä–µ–¥–∞–∫—Ç–æ—Ä** - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ –≤ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–º 3D —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ
    - ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ—Ä–º** - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –°–ù–∏–ü –∏ –ñ–ö –†–§
    - üí° **AI –≥–µ–Ω–µ—Ä–∞—Ü–∏—è** - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ —Å –ø–æ–º–æ—â—å—é AI
    - üìã **–ó–∞—è–≤–∫–∏ —ç–∫—Å–ø–µ—Ä—Ç–∞–º** - –ü–æ–¥–∞—á–∞ –∑–∞—è–≤–æ–∫ –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤ –ë–¢–ò

    ## –¢–∏–ø–∏—á–Ω—ã–π Flow —Ä–∞–±–æ—Ç—ã

    ### –®–∞–≥ 1: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
    ```
    POST /auth/register
    Body: { "email": "user@test.ru", "password": "Pass123!", "name": "–ò–≤–∞–Ω" }
    ```
    **–û—Ç–≤–µ—Ç:** `{ "data": { "access_token": "eyJ...", "user_id": "..." } }`
    
    üëâ –°–æ—Ö—Ä–∞–Ω—è–µ–º `access_token` –¥–ª—è –≤—Å–µ—Ö –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

    ### –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ –≤–æ—Ä–∫—Å–ø–µ–π—Å–∞
    ```
    POST /workspaces
    Headers: Authorization: Bearer {access_token}
    Body: { "name": "–ú–æ—è –∫–≤–∞—Ä—Ç–∏—Ä–∞" }
    ```
    **–û—Ç–≤–µ—Ç:** `{ "data": { "id": "abc-123-...", ... } }`
    
    üëâ –°–æ—Ö—Ä–∞–Ω—è–µ–º `data.id` ‚Äî —ç—Ç–æ **workspace_id**

    ### –®–∞–≥ 3: –ó–∞–≥—Ä—É–∑–∫–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏
    ```
    POST /floor-plans (multipart/form-data)
    Headers: Authorization: Bearer {access_token}
    Form: workspace_id={workspace_id}, name="–ü–ª–∞–Ω –ë–¢–ò", file=<–∫–∞—Ä—Ç–∏–Ω–∫–∞.jpg>
    ```
    **–û—Ç–≤–µ—Ç:** 
    ```json
    { 
      "data": { 
        "id": "d6ffeb60-a90b-487c-85b7-7d046dac496e",  // ‚Üê –≠–¢–û floor_plan_id!
        "status": "uploaded",
        ... 
      } 
    }
    ```
    
    üëâ –°–æ—Ö—Ä–∞–Ω—è–µ–º `data.id` ‚Äî —ç—Ç–æ **floor_plan_id**

    ### –®–∞–≥ 4: –ó–∞–ø—É—Å–∫ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
    ```
    POST /ai/recognize
    Headers: Authorization: Bearer {access_token}
    Body: { "floor_plan_id": "{floor_plan_id}" }
    ```
    **–û—Ç–≤–µ—Ç:** `{ "data": { "job_id": "job-456-...", "status": "processing" } }`
    
    üëâ –°–æ—Ö—Ä–∞–Ω—è–µ–º `data.job_id` ‚Äî —ç—Ç–æ **job_id** (–ù–ï floor_plan_id!)

    ### –®–∞–≥ 5: Polling —Å—Ç–∞—Ç—É—Å–∞ (–ø–æ job_id!)
    ```
    GET /ai/recognize/{job_id}/status
    ```
    **–û—Ç–≤–µ—Ç:** `{ "data": { "status": "processing", "progress": 45 } }`
    
    –ü–æ–≤—Ç–æ—Ä—è–µ–º –∫–∞–∂–¥—ã–µ 2-3 —Å–µ–∫—É–Ω–¥—ã –ø–æ–∫–∞ `status` != `"completed"`

    ### –®–∞–≥ 6: –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (–ø–æ floor_plan_id!)
    ```
    GET /floor-plans/{floor_plan_id}
    ```
    **–û—Ç–≤–µ—Ç:** 
    ```json
    { 
      "data": { 
        "id": "d6ffeb60-a90b-...",
        "status": "recognized",
        "model": { "walls": [...], "rooms": [...], ... }  // ‚Üê 3D –º–æ–¥–µ–ª—å!
      } 
    }
    ```

    ## ‚ö†Ô∏è –í–∞–∂–Ω–æ: –†–∞–∑–ª–∏—á–∏–µ ID

    | –ß—Ç–æ | –ù–∞–∑–≤–∞–Ω–∏–µ | –û—Ç–∫—É–¥–∞ –±–µ—Ä—ë—Ç—Å—è | –ü—Ä–∏–º–µ—Ä |
    |-----|----------|----------------|--------|
    | –ü–ª–∞–Ω–∏—Ä–æ–≤–∫–∞ | `floor_plan_id` | POST /floor-plans ‚Üí `response.data.id` | `d6ffeb60-a90b-487c-...` |
    | –ó–∞–¥–∞—á–∞ AI | `job_id` | POST /ai/recognize ‚Üí `response.data.job_id` | `job-456-def-...` |
    | –í–æ—Ä–∫—Å–ø–µ–π—Å | `workspace_id` | POST /workspaces ‚Üí `response.data.id` | `abc-123-...` |
    | –°—Ü–µ–Ω–∞ | `scene_id` | POST /workspaces/{id}/scenes ‚Üí `response.data.id` | `scene-789-...` |

    üö® **–ß–ê–°–¢–ê–Ø –û–®–ò–ë–ö–ê:** –ü—É—Ç–∞—é—Ç `floor_plan_id` –∏ `job_id`!
    - `floor_plan_id` ‚Äî ID –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–π –∫–∞—Ä—Ç–∏–Ω–∫–∏ –≤ –±–∞–∑–µ
    - `job_id` ‚Äî ID –∑–∞–¥–∞—á–∏ AI-—Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
    
    –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `floor_plan_id`, –ù–ï `job_id`!

    ## –ü–æ—Ç–µ—Ä—è–ª–∏ ID? –ö–∞–∫ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å

    | –ß—Ç–æ –ø–æ—Ç–µ—Ä—è–ª–∏ | –ö–∞–∫ –Ω–∞–π—Ç–∏ |
    |--------------|-----------|
    | `floor_plan_id` | `GET /floor-plans?workspace_id={workspace_id}` ‚Üí —Å–ø–∏—Å–æ–∫ –ø–ª–∞–Ω–∏—Ä–æ–≤–æ–∫, –±–µ—Ä—ë–º `data.floor_plans[].id` |
    | `workspace_id` | `GET /workspaces` ‚Üí —Å–ø–∏—Å–æ–∫ –≤–æ—Ä–∫—Å–ø–µ–π—Å–æ–≤, –±–µ—Ä—ë–º `data.workspaces[].id` |
    | `scene_id` | `GET /workspaces/{workspace_id}/scenes` ‚Üí —Å–ø–∏—Å–æ–∫ —Å—Ü–µ–Ω, –±–µ—Ä—ë–º `data.scenes[].id` |
    | `job_id` | ‚ùå –ù–µ–ª—å–∑—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å! –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –∑–∞–Ω–æ–≤–æ: `POST /ai/recognize` |

    ---

    # üìö –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö Flow

    ---

    ## üîê Flow: –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

    ### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    ```
    POST /auth/register
    Content-Type: application/json
    
    {
      "email": "user@example.com",
      "password": "SecurePass123!",   // –º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤
      "name": "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤"
    }
    ```
    **–£—Å–ø–µ—Ö (201):**
    ```json
    {
      "data": {
        "user_id": "550e8400-e29b-41d4-a716-446655440000",
        "access_token": "eyJhbGciOiJIUzI1NiIs...",
        "refresh_token": "eyJhbGciOiJIUzI1NiIs...",
        "expires_in": 900
      }
    }
    ```
    **–û—à–∏–±–∫–∏:**
    - `400` ‚Äî –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π email –∏–ª–∏ —Å–ª–∞–±—ã–π –ø–∞—Ä–æ–ª—å
    - `409` ‚Äî email —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω

    ### –í—Ö–æ–¥ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    ```
    POST /auth/login
    Content-Type: application/json
    
    {
      "email": "user@example.com",
      "password": "SecurePass123!"
    }
    ```
    **–£—Å–ø–µ—Ö (200):** —Ç–∞–∫–æ–π –∂–µ –æ—Ç–≤–µ—Ç –∫–∞–∫ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
    
    **–û—à–∏–±–∫–∏:**
    - `401` ‚Äî –Ω–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å

    ### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ (–∫–æ–≥–¥–∞ access_token –∏—Å—Ç—ë–∫)
    ```
    POST /auth/refresh
    Content-Type: application/json
    
    {
      "refresh_token": "eyJhbGciOiJIUzI1NiIs..."
    }
    ```
    **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:** access_token –∂–∏–≤—ë—Ç 15 –º–∏–Ω—É—Ç. –ö–æ–≥–¥–∞ –ø–æ–ª—É—á–∞–µ—Ç–µ `401 Unauthorized` ‚Äî 
    –≤—ã–∑—ã–≤–∞–π—Ç–µ refresh –∏ –ø–æ–ª—É—á–∞–π—Ç–µ –Ω–æ–≤—É—é –ø–∞—Ä—É —Ç–æ–∫–µ–Ω–æ–≤.
    
    **–û—à–∏–±–∫–∏:**
    - `401` ‚Äî refresh_token –∏—Å—Ç—ë–∫ –∏–ª–∏ –Ω–µ–≤–∞–ª–∏–¥–µ–Ω ‚Üí –Ω—É–∂–µ–Ω –ø–æ–≤—Ç–æ—Ä–Ω—ã–π login

    ### –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
    ```
    POST /auth/logout
    Authorization: Bearer {access_token}
    Content-Type: application/json
    
    {
      "refresh_token": "eyJhbGciOiJIUzI1NiIs..."
    }
    ```
    –ò–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç refresh_token. Access_token –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è (15 –º–∏–Ω).

    ### –í—ã—Ö–æ–¥ —Å–æ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
    ```
    POST /auth/logout-all
    Authorization: Bearer {access_token}
    ```
    –ò–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –í–°–ï refresh_token'—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ü–æ–ª–µ–∑–Ω–æ –µ—Å–ª–∏ —É–∫—Ä–∞–ª–∏ —Ç–æ–∫–µ–Ω.

    ---

    ## üè† Flow: –í–æ—Ä–∫—Å–ø–µ–π—Å—ã (–ø—Ä–æ–µ–∫—Ç—ã)

    **–ß—Ç–æ —ç—Ç–æ:** –í–æ—Ä–∫—Å–ø–µ–π—Å = –ø—Ä–æ–µ–∫—Ç –∫–≤–∞—Ä—Ç–∏—Ä—ã. –°–æ–¥–µ—Ä–∂–∏—Ç –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏, —Å—Ü–µ–Ω—ã, –∑–∞—è–≤–∫–∏.

    ### –°–æ–∑–¥–∞–Ω–∏–µ –≤–æ—Ä–∫—Å–ø–µ–π—Å–∞
    ```
    POST /workspaces
    Authorization: Bearer {access_token}
    Content-Type: application/json
    
    {
      "name": "–ö–≤–∞—Ä—Ç–∏—Ä–∞ –Ω–∞ –õ–µ–Ω–∏–Ω–∞",
      "description": "–î–≤—É—à–∫–∞ 54 –∫–≤.–º, –ø–∞–Ω–µ–ª—å–Ω—ã–π –¥–æ–º"
    }
    ```
    **–û—Ç–≤–µ—Ç (201):**
    ```json
    {
      "data": {
        "id": "ws-123-456-789",           // ‚Üê workspace_id
        "owner_id": "user-id-...",
        "name": "–ö–≤–∞—Ä—Ç–∏—Ä–∞ –Ω–∞ –õ–µ–Ω–∏–Ω–∞",
        "description": "–î–≤—É—à–∫–∞ 54 –∫–≤.–º...",
        "member_count": 1,
        "created_at": "2025-11-30T12:00:00Z"
      }
    }
    ```

    ### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤–æ—Ä–∫—Å–ø–µ–π—Å–æ–≤
    ```
    GET /workspaces?page=1&page_size=20
    Authorization: Bearer {access_token}
    ```
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ –≤–æ—Ä–∫—Å–ø–µ–π—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–≥–¥–µ –æ–Ω owner –∏–ª–∏ member).

    ### –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –≤–æ—Ä–∫—Å–ø–µ–π—Å–∞
    ```
    GET /workspaces/{workspace_id}
    Authorization: Bearer {access_token}
    ```

    ### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–æ—Ä–∫—Å–ø–µ–π—Å–∞
    ```
    PATCH /workspaces/{workspace_id}
    Authorization: Bearer {access_token}
    Content-Type: application/json
    
    {
      "name": "–ù–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ",
      "description": "–ù–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ"
    }
    ```

    ### –£–¥–∞–ª–µ–Ω–∏–µ –≤–æ—Ä–∫—Å–ø–µ–π—Å–∞
    ```
    DELETE /workspaces/{workspace_id}
    Authorization: Bearer {access_token}
    ```
    ‚ö†Ô∏è –£–¥–∞–ª—è–µ—Ç –≤–æ—Ä–∫—Å–ø–µ–π—Å —Å–æ –í–°–ï–ú–ò –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∞–º–∏ –∏ —Å—Ü–µ–Ω–∞–º–∏ –≤–Ω—É—Ç—Ä–∏!

    ### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞ –≤ –≤–æ—Ä–∫—Å–ø–µ–π—Å
    ```
    POST /workspaces/{workspace_id}/members
    Authorization: Bearer {access_token}
    Content-Type: application/json
    
    {
      "user_id": "–¥—Ä—É–≥–æ–π-user-id",
      "role": "editor"    // owner | admin | editor | viewer
    }
    ```

    ---

    ## üñºÔ∏è Flow: –ü–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ (Floor Plans)

    **–ß—Ç–æ —ç—Ç–æ:** –ó–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–ª–∞–Ω–∞ –∫–≤–∞—Ä—Ç–∏—Ä—ã (–ë–¢–ò, —Ç–µ—Ö–ø–∞—Å–ø–æ—Ä—Ç, —Å–∫–∞–Ω).

    ### –ó–∞–≥—Ä—É–∑–∫–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏
    ```
    POST /floor-plans
    Authorization: Bearer {access_token}
    Content-Type: multipart/form-data
    
    workspace_id: {workspace_id}
    name: "–ü–ª–∞–Ω –ë–¢–ò"
    description: "–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –∏–∑ –ë–¢–ò"
    address: "–≥. –ú–æ—Å–∫–≤–∞, —É–ª. –õ–µ–Ω–∏–Ω–∞, –¥. 1, –∫–≤. 5"
    file: <–∫–∞—Ä—Ç–∏–Ω–∫–∞.jpg>
    ```
    **–§–æ—Ä–º–∞—Ç—ã —Ñ–∞–π–ª–æ–≤:** JPEG, PNG, WebP  
    **–ú–∞–∫—Å. —Ä–∞–∑–º–µ—Ä:** 10 MB
    
    **–û—Ç–≤–µ—Ç (201):**
    ```json
    {
      "data": {
        "id": "fp-123-456",              // ‚Üê floor_plan_id (–°–û–•–†–ê–ù–ò–¢–ï!)
        "workspace_id": "ws-...",
        "name": "–ü–ª–∞–Ω –ë–¢–ò",
        "status": "uploaded",            // uploaded ‚Üí processing ‚Üí recognized/failed
        "image_url": "https://...",
        "thumbnail_url": "https://...",
        "created_at": "..."
      }
    }
    ```

    ### –°—Ç–∞—Ç—É—Å—ã –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏
    | –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
    |--------|----------|
    | `uploaded` | –§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω, —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –ù–ï –∑–∞–ø—É—â–µ–Ω–æ |
    | `processing` | –ò–¥—ë—Ç AI —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ |
    | `recognized` | –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ, –ø–æ–ª–µ `model` –∑–∞–ø–æ–ª–Ω–µ–Ω–æ |
    | `failed` | –û—à–∏–±–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è |

    ### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–æ–∫
    ```
    GET /floor-plans?workspace_id={workspace_id}&status=recognized&page=1
    Authorization: Bearer {access_token}
    ```

    ### –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ —Å –º–æ–¥–µ–ª—å—é
    ```
    GET /floor-plans/{floor_plan_id}
    Authorization: Bearer {access_token}
    ```
    **–û—Ç–≤–µ—Ç (–µ—Å–ª–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–∞):**
    ```json
    {
      "data": {
        "id": "fp-123-456",
        "status": "recognized",
        "model": {
          "bounds": { "width": 12.5, "height": 2.7, "depth": 8.3 },
          "total_area": 54.2,
          "elements": {
            "walls": [ ... ],
            "rooms": [ ... ],
            "furniture": [ ... ]
          }
        }
      }
    }
    ```

    ### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏
    ```
    PATCH /floor-plans/{floor_plan_id}
    Authorization: Bearer {access_token}
    Content-Type: application/json
    
    {
      "name": "–ù–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ",
      "description": "–ù–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ",
      "address": "–ù–æ–≤—ã–π –∞–¥—Ä–µ—Å"
    }
    ```

    ### –£–¥–∞–ª–µ–Ω–∏–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏
    ```
    DELETE /floor-plans/{floor_plan_id}
    Authorization: Bearer {access_token}
    ```

    ### –ü–æ–ª—É—á–µ–Ω–∏–µ URL –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –æ—Ä–∏–≥–∏–Ω–∞–ª–∞
    ```
    GET /floor-plans/{floor_plan_id}/download-url
    Authorization: Bearer {access_token}
    ```
    **–û—Ç–≤–µ—Ç:**
    ```json
    {
      "data": {
        "url": "https://storage.../signed-url...",
        "expires_at": "2025-11-30T13:00:00Z"
      }
    }
    ```

    ---

    ## ü§ñ Flow: AI –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ

    **–ß—Ç–æ —ç—Ç–æ:** AI –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∫–∞—Ä—Ç–∏–Ω–∫—É –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ –∏ —Å–æ–∑–¥–∞—ë—Ç 3D –º–æ–¥–µ–ª—å —Å –∫–æ–º–Ω–∞—Ç–∞–º–∏, —Å—Ç–µ–Ω–∞–º–∏, –º–µ–±–µ–ª—å—é.

    ### –ó–∞–ø—É—Å–∫ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
    
    **–í–∞—Ä–∏–∞–Ω—Ç 1: –ü–æ ID —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–π –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏**
    ```
    POST /ai/recognize
    Authorization: Bearer {access_token}
    Content-Type: application/json
    
    {
      "floor_plan_id": "{floor_plan_id}",
      "options": {
        "detect_load_bearing": true,    // –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –Ω–µ—Å—É—â–∏–µ —Å—Ç–µ–Ω—ã
        "detect_wet_zones": true,       // –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –º–æ–∫—Ä—ã–µ –∑–æ–Ω—ã
        "detect_furniture": true,       // –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –º–µ–±–µ–ª—å
        "detail_level": 2               // 1-3, –≥–¥–µ 3 = –º–∞–∫—Å–∏–º—É–º –¥–µ—Ç–∞–ª–µ–π
      }
    }
    ```
    
    **–í–∞—Ä–∏–∞–Ω—Ç 2: –ù–∞–ø—Ä—è–º—É—é —Å –∫–∞—Ä—Ç–∏–Ω–∫–æ–π –≤ base64**
    ```
    POST /ai/recognize
    Authorization: Bearer {access_token}
    Content-Type: application/json
    
    {
      "floor_plan_id": "temp-id",       // –ª—é–±–æ–π –≤—Ä–µ–º–µ–Ω–Ω—ã–π ID
      "image_base64": "data:image/jpeg;base64,/9j/4AAQ...",
      "image_type": "image/jpeg",
      "options": { ... }
    }
    ```
    
    **–û—Ç–≤–µ—Ç (202):**
    ```json
    {
      "data": {
        "job_id": "job-789-abc-def",    // ‚Üê –°–û–•–†–ê–ù–ò–¢–ï –¥–ª—è polling!
        "status": "processing"
      }
    }
    ```

    ### Polling —Å—Ç–∞—Ç—É—Å–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
    ```
    GET /ai/recognize/{job_id}/status
    Authorization: Bearer {access_token}
    ```
    
    **–ü–æ–∫–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è:**
    ```json
    {
      "data": {
        "job_id": "job-789-...",
        "status": "processing",
        "progress": 65              // –ø—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
      }
    }
    ```
    
    **–ö–æ–≥–¥–∞ –≥–æ—Ç–æ–≤–æ:**
    ```json
    {
      "data": {
        "job_id": "job-789-...",
        "status": "completed",
        "progress": 100,
        "model": {
          "bounds": { ... },
          "elements": { "walls": [...], "rooms": [...] }
        }
      }
    }
    ```
    
    **–ï—Å–ª–∏ –æ—à–∏–±–∫–∞:**
    ```json
    {
      "data": {
        "job_id": "job-789-...",
        "status": "failed",
        "error": "Could not detect walls in image"
      }
    }
    ```

    ### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª polling
    - –ü–µ—Ä–≤—ã–µ 10 —Å–µ–∫—É–Ω–¥: –∫–∞–∂–¥—ã–µ 1-2 —Å–µ–∫
    - –ü–æ—Ç–æ–º: –∫–∞–∂–¥—ã–µ 3-5 —Å–µ–∫
    - –¢–∞–π–º–∞—É—Ç: 5 –º–∏–Ω—É—Ç (–µ—Å–ª–∏ –¥–æ–ª—å—à–µ ‚Äî —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫)

    ### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–±: —á–µ—Ä–µ–∑ floor-plans
    ```
    GET /floor-plans/{floor_plan_id}/recognition-status
    Authorization: Bearer {access_token}
    ```
    –≠—Ç–æ—Ç endpoint –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `floor_plan_id` (–ù–ï job_id!) –∏ —Å–∞–º –Ω–∞—Ö–æ–¥–∏—Ç —Å–≤—è–∑–∞–Ω–Ω—É—é –∑–∞–¥–∞—á—É.

    ---

    ## üé® Flow: 3D –°—Ü–µ–Ω—ã

    **–ß—Ç–æ —ç—Ç–æ:** –°—Ü–µ–Ω–∞ = —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–∞—è 3D –º–æ–¥–µ–ª—å –∫–≤–∞—Ä—Ç–∏—Ä—ã. –°–æ–∑–¥–∞—ë—Ç—Å—è –∏–∑ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω–æ–π –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏.

    ### –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ü–µ–Ω—ã –∏–∑ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏
    ```
    POST /workspaces/{workspace_id}/scenes
    Authorization: Bearer {access_token}
    Content-Type: application/json
    
    {
      "name": "–û—Å–Ω–æ–≤–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç",
      "description": "–¢–µ–∫—É—â–∞—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∞",
      "floor_plan_id": "{floor_plan_id}"    // ID –†–ê–°–ü–û–ó–ù–ê–ù–ù–û–ô –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏!
    }
    ```
    
    ‚ö†Ô∏è –ü–ª–∞–Ω–∏—Ä–æ–≤–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤ —Å—Ç–∞—Ç—É—Å–µ `recognized`!
    
    **–û—Ç–≤–µ—Ç (201):**
    ```json
    {
      "data": {
        "id": "scene-123-456",          // ‚Üê scene_id
        "workspace_id": "ws-...",
        "floor_plan_id": "fp-...",
        "name": "–û—Å–Ω–æ–≤–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç",
        "status": "active",
        "element_count": 45,
        "branch_count": 1
      }
    }
    ```

    ### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ü–µ–Ω—ã
    ```
    GET /scenes/{scene_id}
    Authorization: Bearer {access_token}
    ```
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å—Ü–µ–Ω—ã –¥–ª—è 3D —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞.

    ### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ü–µ–Ω—ã
    ```
    PATCH /scenes/{scene_id}
    Authorization: Bearer {access_token}
    Content-Type: application/json
    
    {
      "name": "–ù–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ",
      "status": "archived"    // draft | active | archived
    }
    ```

    ### –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ü–µ–Ω—ã
    ```
    DELETE /scenes/{scene_id}
    Authorization: Bearer {access_token}
    ```

    ### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ü–µ–Ω—ã –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –Ω–æ—Ä–º–∞–º
    ```
    GET /scenes/{scene_id}/compliance
    Authorization: Bearer {access_token}
    ```
    –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å—Ü–µ–Ω—ã.

    ---

    ## üåø Flow: –í–µ—Ç–∫–∏ (Branches)

    **–ß—Ç–æ —ç—Ç–æ:** –í–µ—Ç–∫–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ –æ–¥–Ω–æ–π —Å—Ü–µ–Ω—ã 
    –∏ —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å –∏—Ö –º–µ–∂–¥—É —Å–æ–±–æ–π. –ö–∞–∫ git –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤–æ–∫.

    ### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤–µ—Ç–æ–∫
    ```
    GET /scenes/{scene_id}/branches?status=active
    Authorization: Bearer {access_token}
    ```
    **–û—Ç–≤–µ—Ç:**
    ```json
    {
      "data": {
        "branches": [
          {
            "id": "branch-main",
            "name": "main",
            "is_main": true,
            "status": "active"
          },
          {
            "id": "branch-variant1",
            "name": "–í–∞—Ä–∏–∞–Ω—Ç —Å–æ —Å–Ω–æ—Å–æ–º —Å—Ç–µ–Ω—ã",
            "is_main": false,
            "status": "active"
          }
        ]
      }
    }
    ```

    ### –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –≤–µ—Ç–∫–∏
    ```
    POST /scenes/{scene_id}/branches
    Authorization: Bearer {access_token}
    Content-Type: application/json
    
    {
      "name": "–í–∞—Ä–∏–∞–Ω—Ç 2: –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –∫–æ–º–Ω–∞—Ç",
      "description": "–°–Ω–æ—Å –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ –º–µ–∂–¥—É –∫—É—Ö–Ω–µ–π –∏ –≥–æ—Å—Ç–∏–Ω–æ–π",
      "parent_branch_id": "branch-main"     // –æ—Ç –∫–∞–∫–æ–π –≤–µ—Ç–∫–∏ –æ—Ç–≤–µ—Ç–≤–ª—è–µ–º—Å—è
    }
    ```
    –°–æ–∑–¥–∞—ë—Ç –∫–æ–ø–∏—é —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π –≤–µ—Ç–∫–∏ –¥–ª—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤.

    ### –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–µ—Ç–∫–∏
    ```
    POST /scenes/{scene_id}/branches/{branch_id}/duplicate
    Authorization: Bearer {access_token}
    Content-Type: application/json
    
    {
      "name": "–ö–æ–ø–∏—è –≤–∞—Ä–∏–∞–Ω—Ç–∞ 2"
    }
    ```

    ### –ê–∫—Ç–∏–≤–∞—Ü–∏—è –≤–µ—Ç–∫–∏ (–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ)
    ```
    POST /scenes/{scene_id}/branches/{branch_id}/activate
    Authorization: Bearer {access_token}
    ```
    –î–µ–ª–∞–µ—Ç –≤–µ—Ç–∫—É —Ç–µ–∫—É—â–µ–π –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

    ### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–≤—É—Ö –≤–µ—Ç–æ–∫
    ```
    GET /scenes/{scene_id}/branches/{branch_id}/compare/{target_branch_id}
    Authorization: Bearer {access_token}
    ```
    **–û—Ç–≤–µ—Ç:**
    ```json
    {
      "data": {
        "source_branch": { ... },
        "target_branch": { ... },
        "differences": [
          {
            "element_id": "wall-5",
            "change_type": "removed",
            "description": "–°—Ç–µ–Ω–∞ –º–µ–∂–¥—É –∫—É—Ö–Ω–µ–π –∏ –≥–æ—Å—Ç–∏–Ω–æ–π"
          },
          {
            "element_id": "room-3",
            "change_type": "modified",
            "description": "–ü–ª–æ—â–∞–¥—å –∏–∑–º–µ–Ω–µ–Ω–∞: 12–º¬≤ ‚Üí 24–º¬≤"
          }
        ]
      }
    }
    ```

    ### –°–ª–∏—è–Ω–∏–µ –≤–µ—Ç–æ–∫
    ```
    POST /scenes/{scene_id}/branches/{branch_id}/merge
    Authorization: Bearer {access_token}
    Content-Type: application/json
    
    {
      "target_branch_id": "branch-main",
      "strategy": "overwrite"    // overwrite | merge
    }
    ```
    –ü—Ä–∏–º–µ–Ω—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ —Ç–µ–∫—É—â–µ–π –≤–µ—Ç–∫–∏ –≤ —Ü–µ–ª–µ–≤—É—é.

    ---

    ## üí¨ Flow: AI –ß–∞—Ç

    **–ß—Ç–æ —ç—Ç–æ:** –î–∏–∞–ª–æ–≥ —Å AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º –ø–æ –≤–æ–ø—Ä–æ—Å–∞–º –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏.

    ### –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
    ```
    POST /ai/chat
    Authorization: Bearer {access_token}
    Content-Type: application/json
    
    {
      "message": "–ú–æ–∂–Ω–æ –ª–∏ —Å–Ω–µ—Å—Ç–∏ —Å—Ç–µ–Ω—É –º–µ–∂–¥—É –∫—É—Ö–Ω–µ–π –∏ –≥–æ—Å—Ç–∏–Ω–æ–π?",
      "scene_id": "{scene_id}",           // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
      "session_id": "{session_id}"        // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞
    }
    ```
    
    **–û—Ç–≤–µ—Ç:**
    ```json
    {
      "data": {
        "session_id": "chat-session-123",
        "message_id": "msg-456",
        "response": "–ù–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ –≤–∞—à–µ–π –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏, —Å—Ç–µ–Ω–∞ –º–µ–∂–¥—É –∫—É—Ö–Ω–µ–π –∏ –≥–æ—Å—Ç–∏–Ω–æ–π —è–≤–ª—è–µ—Ç—Å—è –Ω–µ—Å—É—â–µ–π (—Ç–æ–ª—â–∏–Ω–∞ 20—Å–º, –±–µ—Ç–æ–Ω). –ï—ë —Å–Ω–æ—Å –ó–ê–ü–†–ï–©–Å–ù –±–µ–∑ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è —Å –∞–≤—Ç–æ—Ä–æ–º –ø—Ä–æ–µ–∫—Ç–∞ –¥–æ–º–∞...",
        "suggestions": [
          {
            "type": "action",
            "title": "–°–¥–µ–ª–∞—Ç—å –ø—Ä–æ—ë–º",
            "description": "–ú–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ø—Ä–æ—ë–º –¥–æ 90—Å–º —Å —É—Å–∏–ª–µ–Ω–∏–µ–º"
          }
        ]
      }
    }
    ```

    ### –ü—Ä–∏–º–µ—Ä—ã –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è AI
    - "–ú–æ–∂–Ω–æ –ª–∏ —Å–Ω–µ—Å—Ç–∏ —ç—Ç—É —Å—Ç–µ–Ω—É?"
    - "–ö–∞–∫ —É–≤–µ–ª–∏—á–∏—Ç—å –ø–ª–æ—â–∞–¥—å –≤–∞–Ω–Ω–æ–π?"
    - "–ü—Ä–µ–¥–ª–æ–∂–∏ –≤–∞—Ä–∏–∞–Ω—Ç—ã –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ –¥–ª—è —Å–µ–º—å–∏ —Å —Ä–µ–±—ë–Ω–∫–æ–º"
    - "–ö–∞–∫–∏–µ –Ω–æ—Ä–º—ã –Ω–∞—Ä—É—à–∞–µ—Ç —Ç–µ–∫—É—â–∞—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∞?"
    - "–°–∫–æ–ª—å–∫–æ –±—É–¥–µ—Ç —Å—Ç–æ–∏—Ç—å —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ?"

    ### –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —á–∞—Ç–∞
    ```
    GET /ai/chat/history?session_id={session_id}&limit=50
    Authorization: Bearer {access_token}
    ```

    ### –û—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏
    ```
    DELETE /ai/chat/history?session_id={session_id}
    Authorization: Bearer {access_token}
    ```

    ---

    ## üí° Flow: AI –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤

    **–ß—Ç–æ —ç—Ç–æ:** AI –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–∞—à–µ–π —Å—Ü–µ–Ω—ã.

    ### –ó–∞–ø—É—Å–∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
    ```
    POST /ai/generate
    Authorization: Bearer {access_token}
    Content-Type: application/json
    
    {
      "scene_id": "{scene_id}",
      "count": 3,                           // —Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ (1-5)
      "style": "modern",                    // modern | classic | minimalist | scandinavian | loft
      "priorities": ["more_space", "natural_light"],
      "constraints": {
        "keep_wet_zones": true,             // –Ω–µ —Ç—Ä–æ–≥–∞—Ç—å –º–æ–∫—Ä—ã–µ –∑–æ–Ω—ã
        "budget": "medium"                  // low | medium | high
      }
    }
    ```
    
    **–û—Ç–≤–µ—Ç (202):**
    ```json
    {
      "data": {
        "job_id": "gen-job-123",
        "status": "queued"
      }
    }
    ```

    ### Polling —Å—Ç–∞—Ç—É—Å–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
    ```
    GET /ai/generate/{job_id}/status
    Authorization: Bearer {access_token}
    ```
    
    **–ö–æ–≥–¥–∞ –≥–æ—Ç–æ–≤–æ:**
    ```json
    {
      "data": {
        "job_id": "gen-job-123",
        "status": "completed",
        "variants": [
          {
            "id": "variant-1",
            "name": "–û—Ç–∫—Ä—ã—Ç–∞—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∞",
            "description": "–û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –∫—É—Ö–Ω–∏ –∏ –≥–æ—Å—Ç–∏–Ω–æ–π",
            "branch_id": "branch-gen-1",
            "quality_score": 85,
            "preview_url": "https://..."
          },
          {
            "id": "variant-2",
            "name": "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Å–ø–∞–ª—å–Ω—è",
            "description": "–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –≥–æ—Å—Ç–∏–Ω–æ–π",
            "branch_id": "branch-gen-2",
            "quality_score": 78
          }
        ]
      }
    }
    ```
    
    –ö–∞–∂–¥—ã–π –≤–∞—Ä–∏–∞–Ω—Ç —Å–æ–∑–¥–∞—ë—Ç—Å—è –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω–∞—è –≤–µ—Ç–∫–∞ (`branch_id`).

    ---

    ## ‚úÖ Flow: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –Ω–æ—Ä–º–∞–º (Compliance)

    **–ß—Ç–æ —ç—Ç–æ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –°–ù–∏–ü, –ñ–ö –†–§ –∏ –¥—Ä—É–≥–∏–º –Ω–æ—Ä–º–∞–º.

    ### –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ü–µ–Ω—ã
    ```
    POST /compliance/check
    Authorization: Bearer {access_token}
    Content-Type: application/json
    
    {
      "scene_id": "{scene_id}",
      "branch_id": "{branch_id}",           // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
      "categories": ["wet_zones", "load_bearing", "areas"]  // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
    }
    ```
    
    **–û—Ç–≤–µ—Ç:**
    ```json
    {
      "data": {
        "check_id": "check-123",
        "scene_id": "scene-...",
        "status": "warning",                // passed | warning | failed
        "score": 72,                        // 0-100
        "violation_count": 0,
        "warning_count": 3,
        "violations": [
          {
            "id": "v-1",
            "rule_id": "SNIP-2.08.01",
            "rule_name": "–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ø–ª–æ—â–∞–¥—å –∫—É—Ö–Ω–∏",
            "category": "areas",
            "severity": "warning",
            "description": "–ü–ª–æ—â–∞–¥—å –∫—É—Ö–Ω–∏ 5.8 –º¬≤ –º–µ–Ω—å—à–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã—Ö 6 –º¬≤",
            "recommendations": [
              "–£–≤–µ–ª–∏—á–∏—Ç—å –ø–ª–æ—â–∞–¥—å –∫—É—Ö–Ω–∏ –∑–∞ —Å—á—ë—Ç –∫–æ—Ä–∏–¥–æ—Ä–∞",
              "–û–±—ä–µ–¥–∏–Ω–∏—Ç—å —Å –≥–æ—Å—Ç–∏–Ω–æ–π (–ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ)"
            ],
            "legal_reference": "–°–ù–∏–ü 2.08.01-89 –ø.2.7"
          }
        ]
      }
    }
    ```

    ### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ (–¥–æ –µ—ë –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è)
    ```
    POST /compliance/check-operation
    Authorization: Bearer {access_token}
    Content-Type: application/json
    
    {
      "scene_id": "{scene_id}",
      "operation": {
        "type": "remove_wall",
        "element_id": "wall-5"
      }
    }
    ```
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –º–æ–∂–Ω–æ –ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é (—Å–Ω–æ—Å —Å—Ç–µ–Ω—ã, –ø–µ—Ä–µ–Ω–æ—Å –∏ —Ç.–¥.) –î–û –µ—ë –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

    ### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø—Ä–∞–≤–∏–ª
    ```
    GET /compliance/rules?category=wet_zones&is_active=true
    Authorization: Bearer {access_token}
    ```

    ### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF –æ—Ç—á—ë—Ç–∞
    ```
    POST /compliance/report
    Authorization: Bearer {access_token}
    Content-Type: application/json
    
    {
      "scene_id": "{scene_id}",
      "format": "pdf",                      // pdf | html | json
      "include_recommendations": true
    }
    ```
    **–û—Ç–≤–µ—Ç:**
    ```json
    {
      "data": {
        "report_id": "report-123",
        "download_url": "https://storage.../report.pdf",
        "expires_at": "2025-11-30T14:00:00Z"
      }
    }
    ```

    ---

    ## üìã Flow: –ó–∞—è–≤–∫–∏ —ç–∫—Å–ø–µ—Ä—Ç–∞–º (Requests)

    **–ß—Ç–æ —ç—Ç–æ:** –ü–æ–¥–∞—á–∞ –∑–∞—è–≤–æ–∫ –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤ –ë–¢–ò, —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏.

    ### –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏
    ```
    POST /requests
    Authorization: Bearer {access_token}
    Content-Type: application/json
    
    {
      "workspace_id": "{workspace_id}",
      "title": "–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ –¥–≤—É—à–∫–∏",
      "description": "–•–æ—á—É –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –∫—É—Ö–Ω—é —Å –≥–æ—Å—Ç–∏–Ω–æ–π, –Ω—É–∂–Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –ø–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏",
      "category": "consultation",           // consultation | documentation | expert_visit | full_package
      "priority": "normal",                 // low | normal | high | urgent
      "contact_phone": "+7 999 123-45-67",
      "contact_email": "user@example.com"
    }
    ```
    
    **–û—Ç–≤–µ—Ç (201):**
    ```json
    {
      "data": {
        "id": "req-123-456",               // ‚Üê request_id
        "status": "draft",
        "estimated_cost": null,
        "created_at": "..."
      }
    }
    ```

    ### –°—Ç–∞—Ç—É—Å—ã –∑–∞—è–≤–∫–∏
    | –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
    |--------|----------|
    | `draft` | –ß–µ—Ä–Ω–æ–≤–∏–∫, –º–æ–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å |
    | `pending` | –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞, –æ–∂–∏–¥–∞–µ—Ç —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏—è |
    | `in_review` | –ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏ —É —ç–∫—Å–ø–µ—Ä—Ç–∞ |
    | `approved` | –û–¥–æ–±—Ä–µ–Ω–∞ |
    | `rejected` | –û—Ç–∫–ª–æ–Ω–µ–Ω–∞ |
    | `assigned` | –ù–∞–∑–Ω–∞—á–µ–Ω —ç–∫—Å–ø–µ—Ä—Ç |
    | `in_progress` | –í —Ä–∞–±–æ—Ç–µ |
    | `completed` | –ó–∞–≤–µ—Ä—à–µ–Ω–∞ |
    | `cancelled` | –û—Ç–º–µ–Ω–µ–Ω–∞ |

    ### –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞—è–≤–∫–∏ –Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ
    ```
    POST /requests/{request_id}/submit
    Authorization: Bearer {access_token}
    ```
    –ü–µ—Ä–µ–≤–æ–¥–∏—Ç –∏–∑ `draft` –≤ `pending`. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ.

    ### –ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
    ```
    POST /requests/{request_id}/documents
    Authorization: Bearer {access_token}
    Content-Type: multipart/form-data
    
    file: <document.pdf>
    name: "–ü–ª–∞–Ω –ë–¢–ò"
    type: "floor_plan"                      // floor_plan | passport | contract | other
    ```

    ### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
    ```
    GET /requests/{request_id}/documents
    Authorization: Bearer {access_token}
    ```

    ### –û—Ç–º–µ–Ω–∞ –∑–∞—è–≤–∫–∏
    ```
    POST /requests/{request_id}/cancel
    Authorization: Bearer {access_token}
    Content-Type: application/json
    
    {
      "reason": "–ü–µ—Ä–µ–¥—É–º–∞–ª –¥–µ–ª–∞—Ç—å –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫—É"
    }
    ```

    ---

    ## üîî Flow: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

    **–ß—Ç–æ —ç—Ç–æ:** –°–∏—Å—Ç–µ–º–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–æ–±—ã—Ç–∏—è—Ö (–∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è, —Å—Ç–∞—Ç—É—Å –∑–∞—è–≤–∫–∏ –∏ —Ç.–¥.)

    ### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
    ```
    GET /notifications?is_read=false&page=1&page_size=20
    Authorization: Bearer {access_token}
    ```

    ### –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö
    ```
    GET /notifications/count
    Authorization: Bearer {access_token}
    ```
    **–û—Ç–≤–µ—Ç:** `{ "data": { "count": 5 } }`

    ### –û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ
    ```
    POST /notifications/{notification_id}/read
    Authorization: Bearer {access_token}
    ```

    ### –û—Ç–º–µ—Ç–∏—Ç—å –≤—Å–µ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ
    ```
    POST /notifications/read-all
    Authorization: Bearer {access_token}
    ```

    ### –£–¥–∞–ª–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    ```
    DELETE /notifications/{notification_id}
    Authorization: Bearer {access_token}
    ```

    ### –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ
    ```
    DELETE /notifications
    Authorization: Bearer {access_token}
    ```

    ---

    ## üë§ Flow: –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

    ### –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
    ```
    GET /users/me
    Authorization: Bearer {access_token}
    ```

    ### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
    ```
    PATCH /users/me
    Authorization: Bearer {access_token}
    Content-Type: application/json
    
    {
      "name": "–ù–æ–≤–æ–µ –∏–º—è",
      "phone": "+7 999 000-00-00"
    }
    ```

    ### –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è
    ```
    PUT /users/me/password
    Authorization: Bearer {access_token}
    Content-Type: application/json
    
    {
      "current_password": "OldPass123!",
      "new_password": "NewPass456!"
    }
    ```

    ### –£–¥–∞–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞
    ```
    DELETE /users/me
    Authorization: Bearer {access_token}
    ```
    ‚ö†Ô∏è –£–¥–∞–ª—è–µ—Ç –∞–∫–∫–∞—É–Ω—Ç —Å–æ –í–°–ï–ú–ò –¥–∞–Ω–Ω—ã–º–∏ –±–µ–∑–≤–æ–∑–≤—Ä–∞—Ç–Ω–æ!

    ---

    ## –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

    API –∏—Å–ø–æ–ª—å–∑—É–µ—Ç JWT (JSON Web Tokens) –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.

    ### –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤

    1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å —á–µ—Ä–µ–∑ `POST /api/v1/auth/register`
    2. –ò–ª–∏ –≤–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ `POST /api/v1/auth/login`
    3. –ü–æ–ª—É—á–∏—Ç–µ `access_token` –∏ `refresh_token`

    ### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤

    –ü–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ Access Token –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ Authorization:
    ```
    Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
    ```

    ### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤

    Access Token –¥–µ–π—Å—Ç–≤—É–µ—Ç 15 –º–∏–Ω—É—Ç. –î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `POST /api/v1/auth/refresh`

    ## Rate Limiting

    | –¢–∏–ø –∑–∞–ø—Ä–æ—Å–∞ | –õ–∏–º–∏—Ç |
    |-------------|-------|
    | –ê–Ω–æ–Ω–∏–º–Ω—ã–µ | 60 req/min |
    | –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ | 300 req/min |
    | AI endpoints | 30 req/min |

    –ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è HTTP 429.

    ## –ö–æ–¥—ã –æ—à–∏–±–æ–∫

    | –ö–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
    |-----|----------|
    | VALIDATION_ERROR | –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö |
    | UNAUTHORIZED | –¢—Ä–µ–±—É–µ—Ç—Å—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è |
    | FORBIDDEN | –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ |
    | NOT_FOUND | –†–µ—Å—É—Ä—Å –Ω–µ –Ω–∞–π–¥–µ–Ω |
    | CONFLICT | –ö–æ–Ω—Ñ–ª–∏–∫—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ) |
    | RATE_LIMITED | –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ |
    | INTERNAL_ERROR | –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ |

  termsOfService: https://granula.ru/terms
  contact:
    name: Granula API Support
    url: https://granula.ru/support
    email: api@granula.ru
  license:
    name: Proprietary
    url: https://granula.ru/license

servers:
  - url: https://api.granula.raitokyokai.tech/api/v1
    description: Production —Å–µ—Ä–≤–µ—Ä
  - url: http://localhost:3001/api/v1
    description: –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

tags:
  - name: auth
    description: –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏
  - name: users
    description: –ü—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  - name: workspaces
    description: –†–∞–±–æ—á–∏–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–æ–≤
  - name: floor-plans
    description: –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–æ–∫
  - name: scenes
    description: 3D —Å—Ü–µ–Ω—ã –∏ —ç–ª–µ–º–µ–Ω—Ç—ã
  - name: branches
    description: –í–µ—Ç–∫–∏ –¥–∏–∑–∞–π–Ω–∞ (–≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ)
  - name: ai
    description: AI —Å–µ—Ä–≤–∏—Å—ã (—Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è, —á–∞—Ç)
  - name: compliance
    description: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –°–ù–∏–ü –∏ –ñ–ö –†–§
  - name: requests
    description: –ó–∞—è–≤–∫–∏ –Ω–∞ —É—Å–ª—É–≥–∏ —ç–∫—Å–ø–µ—Ä—Ç–æ–≤ –ë–¢–ò
  - name: notifications
    description: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

# =============================================================================
# Security Schemes
# =============================================================================
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT —Ç–æ–∫–µ–Ω. –ü–æ–ª—É—á–∏—Ç–µ —á–µ—Ä–µ–∑ `/auth/login` –∏–ª–∏ `/auth/register`. –§–æ—Ä–º–∞—Ç - `Bearer <token>`

  # ===========================================================================
  # Schemas
  # ===========================================================================
  schemas:
    # -------------------------------------------------------------------------
    # Error Responses
    # -------------------------------------------------------------------------
    Error:
      type: object
      properties:
        error:
          type: string
          description: –û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏
          example: unauthorized
        message:
          type: string
          description: –î–µ—Ç–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
          example: Invalid token
        request_id:
          type: string
          description: ID –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
          example: req-abc123

    ValidationError:
      type: object
      properties:
        error:
          type: string
          example: validation_error
        details:
          type: object
          additionalProperties:
            type: string
          example:
            email: "invalid email format"
            password: "minimum 8 characters"

    # -------------------------------------------------------------------------
    # Success Response
    # -------------------------------------------------------------------------
    SuccessResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: Operation completed successfully
        request_id:
          type: string

    # -------------------------------------------------------------------------
    # Pagination
    # -------------------------------------------------------------------------
    Pagination:
      type: object
      properties:
        total:
          type: integer
          example: 150
        page:
          type: integer
          example: 1
        page_size:
          type: integer
          example: 20
        total_pages:
          type: integer
          example: 8

    # -------------------------------------------------------------------------
    # Auth Schemas
    # -------------------------------------------------------------------------
    RegisterRequest:
      type: object
      required: [email, password, name]
      properties:
        email:
          type: string
          format: email
          example: user@example.com
        password:
          type: string
          format: password
          minLength: 8
          example: SecurePass123!
        name:
          type: string
          minLength: 2
          example: –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤

    LoginRequest:
      type: object
      required: [email, password]
      properties:
        email:
          type: string
          format: email
          example: user@example.com
        password:
          type: string
          format: password
          example: SecurePass123!

    AuthResponse:
      type: object
      properties:
        data:
          type: object
          properties:
            user_id:
              type: string
              format: uuid
            access_token:
              type: string
            refresh_token:
              type: string
            expires_in:
              type: integer
              description: –°–µ–∫—É–Ω–¥—ã –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è access_token
        message:
          type: string
        request_id:
          type: string

    RefreshRequest:
      type: object
      required: [refresh_token]
      properties:
        refresh_token:
          type: string

    LogoutRequest:
      type: object
      required: [refresh_token]
      properties:
        refresh_token:
          type: string

    # -------------------------------------------------------------------------
    # User Schemas
    # -------------------------------------------------------------------------
    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
          format: email
        name:
          type: string
        avatar_url:
          type: string
          format: uri
        phone:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    UpdateUserRequest:
      type: object
      properties:
        name:
          type: string
          minLength: 2
          maxLength: 255
        phone:
          type: string

    ChangePasswordRequest:
      type: object
      required: [current_password, new_password]
      properties:
        current_password:
          type: string
        new_password:
          type: string
          minLength: 8

    # -------------------------------------------------------------------------
    # Notification Schemas
    # -------------------------------------------------------------------------
    Notification:
      type: object
      properties:
        id:
          type: string
          format: uuid
        user_id:
          type: string
          format: uuid
        type:
          type: string
          enum: [info, warning, error, success, system]
        title:
          type: string
        message:
          type: string
        is_read:
          type: boolean
        metadata:
          type: object
        created_at:
          type: string
          format: date-time

    NotificationList:
      type: object
      properties:
        data:
          type: object
          properties:
            notifications:
              type: array
              items:
                $ref: "#/components/schemas/Notification"
            pagination:
              $ref: "#/components/schemas/Pagination"

    UnreadCount:
      type: object
      properties:
        data:
          type: object
          properties:
            count:
              type: integer

    # -------------------------------------------------------------------------
    # Workspace Schemas
    # -------------------------------------------------------------------------
    Workspace:
      type: object
      properties:
        id:
          type: string
          format: uuid
        owner_id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        member_count:
          type: integer
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateWorkspaceRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
          minLength: 2
          maxLength: 100
        description:
          type: string
          maxLength: 1000

    UpdateWorkspaceRequest:
      type: object
      properties:
        name:
          type: string
        description:
          type: string

    Member:
      type: object
      properties:
        id:
          type: string
          format: uuid
        user_id:
          type: string
          format: uuid
        workspace_id:
          type: string
          format: uuid
        role:
          type: string
          enum: [owner, admin, editor, viewer]
        joined_at:
          type: string
          format: date-time

    AddMemberRequest:
      type: object
      required: [user_id, role]
      properties:
        user_id:
          type: string
          format: uuid
        role:
          type: string
          enum: [admin, editor, viewer]

    # -------------------------------------------------------------------------
    # Floor Plan Schemas
    # -------------------------------------------------------------------------
    FloorPlan:
      type: object
      description: |
        –ü–ª–∞–Ω–∏—Ä–æ–≤–∫–∞ –∫–≤–∞—Ä—Ç–∏—Ä—ã.
        
        **–°—Ç–∞—Ç—É—Å—ã:**
        - `uploaded` - —Ñ–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω, —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –Ω–µ –∑–∞–ø—É—â–µ–Ω–æ
        - `processing` - –∏–¥—ë—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ
        - `recognized` - —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ, –ø–æ–ª–µ `model` –∑–∞–ø–æ–ª–Ω–µ–Ω–æ
        - `failed` - –æ—à–∏–±–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
      properties:
        id:
          type: string
          format: uuid
          description: |
            ID –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ (floor_plan_id).
            –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–æ–π.
        workspace_id:
          type: string
          format: uuid
          description: ID –≤–æ—Ä–∫—Å–ø–µ–π—Å–∞, –∫ –∫–æ—Ç–æ—Ä–æ–º—É –ø—Ä–∏–≤—è–∑–∞–Ω–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∞
        user_id:
          type: string
          format: uuid
          description: ID –≤–ª–∞–¥–µ–ª—å—Ü–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏
        name:
          type: string
        description:
          type: string
        address:
          type: string
        status:
          type: string
          enum: [uploaded, processing, recognized, failed]
          description: –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏
        image_url:
          type: string
          format: uri
          description: URL –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        thumbnail_url:
          type: string
          format: uri
          description: URL –ø—Ä–µ–≤—å—é
        scene_id:
          type: string
          format: uuid
          description: ID —Å–æ–∑–¥–∞–Ω–Ω–æ–π 3D —Å—Ü–µ–Ω—ã (–µ—Å–ª–∏ —Å–æ–∑–¥–∞–Ω–∞)
        recognition_result:
          $ref: "#/components/schemas/RecognitionResult"
          description: –ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
        model:
          $ref: "#/components/schemas/RecognitionModel"
          description: |
            –ü–æ–ª–Ω–∞—è 3D –º–æ–¥–µ–ª—å –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏.
            ‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –¢–û–õ–¨–ö–û –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è (status="recognized")
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    RecognitionResult:
      type: object
      properties:
        rooms_count:
          type: integer
        total_area:
          type: number
          format: float
        living_area:
          type: number
          format: float
        confidence:
          type: number
          format: float
        rooms:
          type: array
          items:
            $ref: "#/components/schemas/RecognizedRoom"

    RecognizedRoom:
      type: object
      properties:
        type:
          type: string
          enum:
            [
              living_room,
              bedroom,
              kitchen,
              bathroom,
              toilet,
              hallway,
              balcony,
              storage,
              other,
            ]
        name:
          type: string
        area:
          type: number
          format: float

    UpdateFloorPlanRequest:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        address:
          type: string

    RecognitionStatus:
      type: object
      description: |
        –°—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è.
        
        **–°—Ç–∞—Ç—É—Å—ã:**
        - `pending` - –≤ –æ—á–µ—Ä–µ–¥–∏
        - `processing` - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è (—Å–º–æ—Ç—Ä–∏—Ç–µ progress)
        - `completed` - –≥–æ—Ç–æ–≤–æ, –ø–æ–ª–µ `model` —Å–æ–¥–µ—Ä–∂–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        - `failed` - –æ—à–∏–±–∫–∞, —Å–º–æ—Ç—Ä–∏—Ç–µ –ø–æ–ª–µ `error`
      properties:
        data:
          type: object
          properties:
            job_id:
              type: string
              format: uuid
              description: ID –∑–∞–¥–∞—á–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
            status:
              type: string
              enum: [pending, processing, completed, failed]
              description: |
                –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å.
                –î–µ–ª–∞–π—Ç–µ polling –ø–æ–∫–∞ status != "completed" –∏ status != "failed"
            progress:
              type: integer
              description: –ü—Ä–æ–≥—Ä–µ—Å—Å 0-100%. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç % –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–∏ status="processing"
            model:
              $ref: "#/components/schemas/RecognitionModel"
              description: |
                –ü–æ–ª–Ω–∞—è 3D –º–æ–¥–µ–ª—å –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏.
                ‚ö†Ô∏è –î–æ—Å—Ç—É–ø–Ω–∞ –¢–û–õ–¨–ö–û –ø—Ä–∏ status="completed"
            error:
              type: string
              description: –û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏ (–ø—Ä–∏ status="failed")
    
    RecognitionModel:
      type: object
      description: –ü–æ–ª–Ω–∞—è 3D –º–æ–¥–µ–ª—å –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ –ø–æ—Å–ª–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
      properties:
        bounds:
          type: object
          description: –ì–∞–±–∞—Ä–∏—Ç—ã –∫–≤–∞—Ä—Ç–∏—Ä—ã –≤ –º–µ—Ç—Ä–∞—Ö
          properties:
            width:
              type: number
              description: –®–∏—Ä–∏–Ω–∞ –ø–æ X
            height:
              type: number
              description: –í—ã—Å–æ—Ç–∞ –ø–æ—Ç–æ–ª–∫–æ–≤
            depth:
              type: number
              description: –ì–ª—É–±–∏–Ω–∞ –ø–æ Z
        total_area:
          type: number
          description: –û–±—â–∞—è –ø–ª–æ—â–∞–¥—å –≤ –º¬≤
        confidence:
          type: number
          minimum: 0
          maximum: 1
          description: –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è (0-1)
        processing_time_ms:
          type: integer
          description: –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ –º—Å
        warnings:
          type: array
          items:
            type: string
          description: –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –ø—Ä–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–∏
        recognition:
          type: object
          description: –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
          properties:
            source_type:
              type: string
              enum: [BTI, technical_passport, architect_plan, sketch, photo]
            quality:
              type: string
              enum: [high, medium, low]
            scale:
              type: string
            orientation:
              type: integer
            has_dimensions:
              type: boolean
            has_annotations:
              type: boolean
            building_type:
              type: string
              enum: [panel, brick, monolith, block, frame, unknown]
        elements:
          $ref: "#/components/schemas/SceneElements"
    
    SceneElements:
      type: object
      description: –≠–ª–µ–º–µ–Ω—Ç—ã 3D —Å—Ü–µ–Ω—ã –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏
      properties:
        walls:
          type: array
          items:
            $ref: "#/components/schemas/Wall3D"
        rooms:
          type: array
          items:
            $ref: "#/components/schemas/Room3DModel"
        furniture:
          type: array
          items:
            $ref: "#/components/schemas/FurnitureModel"
        utilities:
          type: array
          items:
            $ref: "#/components/schemas/UtilityModel"
    
    Wall3D:
      type: object
      description: 3D —Å—Ç–µ–Ω–∞
      properties:
        id:
          type: string
        type:
          type: string
          example: wall
        name:
          type: string
        start:
          $ref: "#/components/schemas/Point3D"
        end:
          $ref: "#/components/schemas/Point3D"
        height:
          type: number
          description: –í—ã—Å–æ—Ç–∞ —Å—Ç–µ–Ω—ã –≤ –º–µ—Ç—Ä–∞—Ö
        thickness:
          type: number
          description: –¢–æ–ª—â–∏–Ω–∞ —Å—Ç–µ–Ω—ã –≤ –º–µ—Ç—Ä–∞—Ö (0.08-0.50)
        properties:
          type: object
          properties:
            is_load_bearing:
              type: boolean
              description: –Ø–≤–ª—è–µ—Ç—Å—è –ª–∏ –Ω–µ—Å—É—â–µ–π
            material:
              type: string
              enum: [brick, concrete, drywall, block, panel, foam_block, gas_block]
            can_demolish:
              type: boolean
            structural_type:
              type: string
              enum: [external, internal_bearing, partition]
        openings:
          type: array
          items:
            $ref: "#/components/schemas/Opening3D"
        metadata:
          $ref: "#/components/schemas/ElementMetadata"
    
    Point3D:
      type: object
      properties:
        x:
          type: number
        y:
          type: number
        z:
          type: number
    
    Point2DModel:
      type: object
      properties:
        x:
          type: number
        y:
          type: number
    
    Opening3D:
      type: object
      description: –ü—Ä–æ—ë–º (–¥–≤–µ—Ä—å/–æ–∫–Ω–æ) –≤ —Å—Ç–µ–Ω–µ
      properties:
        id:
          type: string
        type:
          type: string
          enum: [door, window, passage, arch]
        subtype:
          type: string
          enum: [single_swing, double_swing, sliding, entrance, balcony, panoramic]
        position:
          type: number
          description: –ü–æ–∑–∏—Ü–∏—è –æ—Ç –Ω–∞—á–∞–ª–∞ —Å—Ç–µ–Ω—ã –≤ –º–µ—Ç—Ä–∞—Ö
        width:
          type: number
        height:
          type: number
        elevation:
          type: number
          description: –í—ã—Å–æ—Ç–∞ –æ—Ç –ø–æ–ª–∞ (0 –¥–ª—è –¥–≤–µ—Ä–µ–π, 0.85 –¥–ª—è –æ–∫–æ–Ω)
        opens_to:
          type: string
          enum: [left, right, inward, outward]
        has_door:
          type: boolean
        connects_rooms:
          type: array
          items:
            type: string
          description: ID –∫–æ–º–Ω–∞—Ç, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–µ–¥–∏–Ω—è–µ—Ç –ø—Ä–æ—ë–º
    
    Room3DModel:
      type: object
      description: 3D –∫–æ–º–Ω–∞—Ç–∞
      properties:
        id:
          type: string
        type:
          type: string
          example: room
        name:
          type: string
          example: –ö—É—Ö–Ω—è
        room_type:
          type: string
          enum: [living, bedroom, kitchen, bathroom, toilet, combined_bathroom, hallway, corridor, storage, balcony, loggia, children, office, dining]
        polygon:
          type: array
          description: –ö–æ–Ω—Ç—É—Ä –∫–æ–º–Ω–∞—Ç—ã (–∑–∞–º–∫–Ω—É—Ç—ã–π –ø–æ–ª–∏–≥–æ–Ω)
          items:
            $ref: "#/components/schemas/Point2DModel"
        area:
          type: number
          description: –ü–ª–æ—â–∞–¥—å –≤ –º¬≤
        perimeter:
          type: number
          description: –ü–µ—Ä–∏–º–µ—Ç—Ä –≤ –º–µ—Ç—Ä–∞—Ö
        properties:
          type: object
          properties:
            has_wet_zone:
              type: boolean
            has_ventilation:
              type: boolean
            has_window:
              type: boolean
            min_allowed_area:
              type: number
              description: –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ø–ª–æ—â–∞–¥—å –ø–æ –°–ù–∏–ü
            ceiling_height:
              type: number
        wall_ids:
          type: array
          items:
            type: string
          description: ID —Å—Ç–µ–Ω, –æ–±—Ä–∞–∑—É—é—â–∏—Ö –∫–æ–º–Ω–∞—Ç—É
        metadata:
          type: object
          properties:
            confidence:
              type: number
            label_on_plan:
              type: string
              description: –ù–∞–¥–ø–∏—Å—å –Ω–∞ –ø–ª–∞–Ω–µ
            area_on_plan:
              type: number
              description: –ü–ª–æ—â–∞–¥—å —É–∫–∞–∑–∞–Ω–Ω–∞—è –Ω–∞ –ø–ª–∞–Ω–µ
    
    FurnitureModel:
      type: object
      description: –ú–µ–±–µ–ª—å –∏–ª–∏ —Å–∞–Ω—Ç–µ—Ö–Ω–∏–∫–∞
      properties:
        id:
          type: string
        type:
          type: string
          example: furniture
        name:
          type: string
        furniture_type:
          type: string
          enum: [sink, toilet, bathtub, shower, gas_stove, electric_stove, refrigerator, washing_machine, dishwasher, bed, sofa, table, wardrobe, desk]
        position:
          $ref: "#/components/schemas/Point3D"
        rotation:
          $ref: "#/components/schemas/Point3D"
        dimensions:
          type: object
          properties:
            width:
              type: number
            height:
              type: number
            depth:
              type: number
        room_id:
          type: string
        properties:
          type: object
          properties:
            can_relocate:
              type: boolean
            category:
              type: string
              enum: [bathroom, kitchen, living, bedroom]
            requires_water:
              type: boolean
            requires_gas:
              type: boolean
            requires_drain:
              type: boolean
    
    UtilityModel:
      type: object
      description: –ò–Ω–∂–µ–Ω–µ—Ä–Ω—ã–µ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ (—Å—Ç–æ—è–∫–∏, –≤–µ–Ω—Ç–∏–ª—è—Ü–∏—è)
      properties:
        id:
          type: string
        type:
          type: string
          example: utility
        name:
          type: string
        utility_type:
          type: string
          enum: [water_riser, sewer_riser, gas_riser, ventilation, electrical_panel]
        position:
          $ref: "#/components/schemas/Point3D"
        dimensions:
          type: object
          properties:
            diameter:
              type: number
              description: –î–∏–∞–º–µ—Ç—Ä (–¥–ª—è –∫—Ä—É–≥–ª—ã—Ö)
            width:
              type: number
            depth:
              type: number
        room_id:
          type: string
        properties:
          type: object
          properties:
            can_relocate:
              type: boolean
            protection_zone:
              type: number
              description: –ó–∞—â–∏—Ç–Ω–∞—è –∑–æ–Ω–∞ –≤ –º–µ—Ç—Ä–∞—Ö
            shared_with_neighbors:
              type: boolean
    
    ElementMetadata:
      type: object
      properties:
        confidence:
          type: number
          minimum: 0
          maximum: 1
        source:
          type: string
          enum: [recognition, manual, generated]
        locked:
          type: boolean
        visible:
          type: boolean

    # -------------------------------------------------------------------------
    # Scene Schemas
    # -------------------------------------------------------------------------
    Scene:
      type: object
      properties:
        id:
          type: string
          format: uuid
        workspace_id:
          type: string
          format: uuid
        floor_plan_id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        status:
          type: string
          enum: [draft, active, archived]
        element_count:
          type: integer
        branch_count:
          type: integer
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateSceneRequest:
      type: object
      description: |
        –°–æ–∑–¥–∞–Ω–∏–µ 3D —Å—Ü–µ–Ω—ã.
        
        **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è** –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å `floor_plan_id` —Å —É–∂–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω–æ–π –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–æ–π - 
        —Ç–æ–≥–¥–∞ —Å—Ü–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—Å—è –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ model.
      required: [name]
      properties:
        name:
          type: string
          description: –ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ü–µ–Ω—ã
        description:
          type: string
        floor_plan_id:
          type: string
          format: uuid
          description: |
            ID —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω–æ–π –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏.
            –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω - —Å—Ü–µ–Ω–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è —Å –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏.

    UpdateSceneRequest:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        status:
          type: string
          enum: [draft, active, archived]

    SceneComplianceResult:
      type: object
      properties:
        data:
          type: object
          properties:
            scene_id:
              type: string
              format: uuid
            status:
              type: string
              enum: [passed, warning, failed]
            violations:
              type: array
              items:
                $ref: "#/components/schemas/Violation"
            checked_at:
              type: string
              format: date-time

    # -------------------------------------------------------------------------
    # Branch Schemas
    # -------------------------------------------------------------------------
    Branch:
      type: object
      properties:
        id:
          type: string
          format: uuid
        scene_id:
          type: string
          format: uuid
        parent_branch_id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        status:
          type: string
          enum: [active, archived, merged]
        is_main:
          type: boolean
        created_by:
          type: string
          format: uuid
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateBranchRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
          minLength: 2
        description:
          type: string
        parent_branch_id:
          type: string
          format: uuid

    UpdateBranchRequest:
      type: object
      properties:
        name:
          type: string
        description:
          type: string

    BranchComparison:
      type: object
      properties:
        data:
          type: object
          properties:
            source_branch:
              $ref: "#/components/schemas/Branch"
            target_branch:
              $ref: "#/components/schemas/Branch"
            differences:
              type: array
              items:
                type: object
                properties:
                  element_id:
                    type: string
                  change_type:
                    type: string
                    enum: [added, removed, modified]
                  description:
                    type: string

    MergeBranchRequest:
      type: object
      required: [target_branch_id]
      properties:
        target_branch_id:
          type: string
          format: uuid
        strategy:
          type: string
          enum: [overwrite, merge]
          default: merge

    # -------------------------------------------------------------------------
    # Compliance Schemas
    # -------------------------------------------------------------------------
    ComplianceCheckRequest:
      type: object
      required: [scene_id]
      properties:
        scene_id:
          type: string
          format: uuid
        branch_id:
          type: string
          format: uuid
        categories:
          type: array
          items:
            type: string

    ComplianceCheckResponse:
      type: object
      properties:
        data:
          type: object
          properties:
            check_id:
              type: string
              format: uuid
            scene_id:
              type: string
              format: uuid
            status:
              type: string
              enum: [passed, warning, failed]
            score:
              type: integer
              description: 0-100
            violation_count:
              type: integer
            warning_count:
              type: integer
            violations:
              type: array
              items:
                $ref: "#/components/schemas/Violation"
            checked_at:
              type: string
              format: date-time

    CheckOperationRequest:
      type: object
      required: [scene_id, operation]
      properties:
        scene_id:
          type: string
          format: uuid
        branch_id:
          type: string
          format: uuid
        operation:
          type: object
          properties:
            type:
              type: string
              enum:
                [
                  add_wall,
                  remove_wall,
                  move_wall,
                  add_room,
                  remove_room,
                  merge_rooms,
                ]
            element_id:
              type: string
              format: uuid
            parameters:
              type: object

    Violation:
      type: object
      properties:
        id:
          type: string
          format: uuid
        rule_id:
          type: string
        rule_name:
          type: string
        category:
          type: string
        severity:
          type: string
          enum: [error, warning, info]
        description:
          type: string
        recommendations:
          type: array
          items:
            type: string
        legal_reference:
          type: string

    ComplianceRule:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        category:
          type: string
        description:
          type: string
        severity:
          type: string
          enum: [error, warning, info]
        legal_reference:
          type: string
        is_active:
          type: boolean

    GenerateReportRequest:
      type: object
      required: [scene_id]
      properties:
        scene_id:
          type: string
          format: uuid
        branch_id:
          type: string
          format: uuid
        format:
          type: string
          enum: [pdf, html, json]
          default: pdf
        include_recommendations:
          type: boolean
          default: true

    # -------------------------------------------------------------------------
    # Request (Expert) Schemas
    # -------------------------------------------------------------------------
    ExpertRequest:
      type: object
      properties:
        id:
          type: string
          format: uuid
        workspace_id:
          type: string
          format: uuid
        user_id:
          type: string
          format: uuid
        title:
          type: string
        description:
          type: string
        category:
          type: string
          enum: [consultation, documentation, expert_visit, full_package]
        priority:
          type: string
          enum: [low, normal, high, urgent]
        status:
          type: string
          enum:
            [
              draft,
              pending,
              in_review,
              approved,
              rejected,
              assigned,
              in_progress,
              completed,
              cancelled,
            ]
        expert_id:
          type: string
          format: uuid
        estimated_cost:
          type: integer
        final_cost:
          type: integer
        contact_phone:
          type: string
        contact_email:
          type: string
          format: email
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateExpertRequestRequest:
      type: object
      required: [workspace_id, title, description, category]
      properties:
        workspace_id:
          type: string
          format: uuid
        title:
          type: string
          minLength: 5
          maxLength: 200
        description:
          type: string
          minLength: 10
        category:
          type: string
          enum: [consultation, documentation, expert_visit, full_package]
        priority:
          type: string
          enum: [low, normal, high, urgent]
          default: normal
        contact_phone:
          type: string
        contact_email:
          type: string
          format: email

    UpdateExpertRequestRequest:
      type: object
      properties:
        title:
          type: string
        description:
          type: string
        priority:
          type: string
          enum: [low, normal, high, urgent]
        contact_phone:
          type: string
        contact_email:
          type: string
          format: email

    RequestDocument:
      type: object
      properties:
        id:
          type: string
          format: uuid
        request_id:
          type: string
          format: uuid
        name:
          type: string
        type:
          type: string
        url:
          type: string
          format: uri
        uploaded_at:
          type: string
          format: date-time

    # -------------------------------------------------------------------------
    # AI Schemas
    # -------------------------------------------------------------------------
    RecognizeRequest:
      type: object
      required: [floor_plan_id]
      properties:
        floor_plan_id:
          type: string
          format: uuid
          description: |
            ID –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è.
            –ü–æ–ª—É—á–∞–µ—Ç–µ –∏–∑ POST /floor-plans ‚Üí response.data.id
        image_base64:
          type: string
          description: |
            Base64-encoded –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ floor_plan_id).
            –§–æ—Ä–º–∞—Ç: data:image/jpeg;base64,/9j/4AAQ...
        image_type:
          type: string
          description: MIME-—Ç–∏–ø –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (image/jpeg, image/png)
          example: image/jpeg
        options:
          type: object
          properties:
            detect_load_bearing:
              type: boolean
              default: true
              description: –û–ø—Ä–µ–¥–µ–ª—è—Ç—å –Ω–µ—Å—É—â–∏–µ —Å—Ç–µ–Ω—ã
            detect_wet_zones:
              type: boolean
              default: true
              description: –û–ø—Ä–µ–¥–µ–ª—è—Ç—å –º–æ–∫—Ä—ã–µ –∑–æ–Ω—ã
            detect_furniture:
              type: boolean
              default: true
              description: –û–ø—Ä–µ–¥–µ–ª—è—Ç—å –º–µ–±–µ–ª—å –∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ
            detail_level:
              type: integer
              minimum: 1
              maximum: 3
              default: 2
              description: –£—Ä–æ–≤–µ–Ω—å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ (1-3)

    RecognizeResponse:
      type: object
      description: |
        –û—Ç–≤–µ—Ç –Ω–∞ –∑–∞–ø—É—Å–∫ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è.
        
        ‚ö†Ô∏è **–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ job_id** - –æ–Ω –Ω—É–∂–µ–Ω –¥–ª—è polling —Å—Ç–∞—Ç—É—Å–∞!
      properties:
        data:
          type: object
          properties:
            job_id:
              type: string
              format: uuid
              description: |
                ID –∑–∞–¥–∞—á–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è.
                –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è GET /ai/recognize/{job_id}/status
            status:
              type: string
              enum: [pending, processing, completed, failed]
              description: –ù–∞—á–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å (–æ–±—ã—á–Ω–æ "pending" –∏–ª–∏ "processing")
            success:
              type: boolean

    AIRecognitionResult:
      type: object
      description: –ü–æ–ª–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –¥–ª—è 3D –º–æ–¥–µ–ª–∏
      properties:
        bounds:
          type: object
          description: –ì–∞–±–∞—Ä–∏—Ç—ã –∫–≤–∞—Ä—Ç–∏—Ä—ã –≤ –º–µ—Ç—Ä–∞—Ö
          properties:
            width:
              type: number
              description: –®–∏—Ä–∏–Ω–∞ –ø–æ X
            height:
              type: number
              description: –í—ã—Å–æ—Ç–∞ –ø–æ—Ç–æ–ª–∫–æ–≤
            depth:
              type: number
              description: –ì–ª—É–±–∏–Ω–∞ –ø–æ Z
        total_area:
          type: number
          description: –û–±—â–∞—è –ø–ª–æ—â–∞–¥—å –≤ –º¬≤
        stats:
          type: object
          properties:
            totalArea:
              type: number
            roomsCount:
              type: integer
            wallsCount:
              type: integer
            furnitureCount:
              type: integer
        walls:
          type: array
          items:
            $ref: "#/components/schemas/RecognizedWall3D"
        rooms:
          type: array
          items:
            $ref: "#/components/schemas/RecognizedRoom3D"
        openings:
          type: array
          items:
            $ref: "#/components/schemas/RecognizedOpening"
        recognition:
          type: object
          properties:
            sourceType:
              type: string
              enum: [BTI, technical_passport, architect_plan, sketch, photo]
            quality:
              type: string
              enum: [high, medium, low]
            scale:
              type: string
            buildingType:
              type: string
              enum: [panel, brick, monolith, block, frame, unknown]

    RecognizedWall3D:
      type: object
      properties:
        temp_id:
          type: string
        start:
          type: object
          properties:
            x:
              type: number
            y:
              type: number
        end:
          type: object
          properties:
            x:
              type: number
            y:
              type: number
        thickness:
          type: number
          description: –¢–æ–ª—â–∏–Ω–∞ –≤ –º–µ—Ç—Ä–∞—Ö (0.08-0.50)
        is_load_bearing:
          type: boolean
          description: –ù–µ—Å—É—â–∞—è —Å—Ç–µ–Ω–∞
        material:
          type: string
          enum: [brick, concrete, drywall, block, panel, foam_block, gas_block]
        can_demolish:
          type: boolean
        confidence:
          type: number
          minimum: 0
          maximum: 1

    RecognizedRoom3D:
      type: object
      properties:
        temp_id:
          type: string
        type:
          type: string
          enum: [living, bedroom, kitchen, bathroom, toilet, combined_bathroom, hallway, corridor, storage, balcony, loggia, children, office, dining]
        name:
          type: string
        polygon:
          type: array
          items:
            type: object
            properties:
              x:
                type: number
              y:
                type: number
        area:
          type: number
        perimeter:
          type: number
        is_wet_zone:
          type: boolean
        has_window:
          type: boolean
        wall_ids:
          type: array
          items:
            type: string
        confidence:
          type: number

    RecognizedOpening:
      type: object
      properties:
        temp_id:
          type: string
        type:
          type: string
          enum: [door, window, passage, arch]
        subtype:
          type: string
          enum: [single_swing, double_swing, sliding, entrance, balcony, panoramic]
        wall_id:
          type: string
        position:
          type: number
          description: –ü–æ–∑–∏—Ü–∏—è –æ—Ç –Ω–∞—á–∞–ª–∞ —Å—Ç–µ–Ω—ã –≤ –º–µ—Ç—Ä–∞—Ö
        width:
          type: number
        height:
          type: number
        elevation:
          type: number
          description: –í—ã—Å–æ—Ç–∞ –æ—Ç –ø–æ–ª–∞ (0 –¥–ª—è –¥–≤–µ—Ä–µ–π, 0.85 –¥–ª—è –æ–∫–æ–Ω)
        confidence:
          type: number

    GenerateVariantsRequest:
      type: object
      required: [scene_id, count]
      properties:
        scene_id:
          type: string
          format: uuid
        branch_id:
          type: string
          format: uuid
        count:
          type: integer
          minimum: 1
          maximum: 5
        style:
          type: string
          enum: [modern, classic, minimalist, scandinavian, loft]
        priorities:
          type: array
          items:
            type: string
        constraints:
          type: object

    GenerateResponse:
      type: object
      properties:
        data:
          type: object
          properties:
            job_id:
              type: string
              format: uuid
            status:
              type: string
              enum: [queued, processing]

    GenerationStatus:
      type: object
      properties:
        data:
          type: object
          properties:
            job_id:
              type: string
              format: uuid
            status:
              type: string
              enum: [queued, processing, completed, failed]
            progress:
              type: integer
            variants:
              type: array
              items:
                $ref: "#/components/schemas/GeneratedVariant"
            error:
              type: string

    GeneratedVariant:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        branch_id:
          type: string
          format: uuid
        quality_score:
          type: integer
        preview_url:
          type: string
          format: uri

    ChatMessageRequest:
      type: object
      required: [message]
      properties:
        session_id:
          type: string
          format: uuid
        message:
          type: string
          minLength: 1
          maxLength: 4000
        scene_id:
          type: string
          format: uuid

    ChatMessageResponse:
      type: object
      properties:
        data:
          type: object
          properties:
            session_id:
              type: string
              format: uuid
            message_id:
              type: string
              format: uuid
            response:
              type: string
            suggestions:
              type: array
              items:
                type: object
                properties:
                  type:
                    type: string
                  title:
                    type: string
                  description:
                    type: string

    ChatHistory:
      type: object
      properties:
        data:
          type: object
          properties:
            session_id:
              type: string
              format: uuid
            messages:
              type: array
              items:
                type: object
                properties:
                  id:
                    type: string
                    format: uuid
                  role:
                    type: string
                    enum: [user, assistant]
                  content:
                    type: string
                  created_at:
                    type: string
                    format: date-time

# =============================================================================
# Paths
# =============================================================================
paths:
  # ---------------------------------------------------------------------------
  # Auth Endpoints
  # ---------------------------------------------------------------------------
  /auth/register:
    post:
      tags: [auth]
      summary: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      description: –°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é —É—á–µ—Ç–Ω—É—é –∑–∞–ø–∏—Å—å –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–∫–µ–Ω—ã
      operationId: register
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RegisterRequest"
      responses:
        "201":
          description: –£—Å–ø–µ—à–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthResponse"
        "400":
          description: –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ValidationError"
        "409":
          description: Email —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω

  /auth/login:
    post:
      tags: [auth]
      summary: –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
      operationId: login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginRequest"
      responses:
        "200":
          description: –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthResponse"
        "401":
          description: –ù–µ–≤–µ—Ä–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

  /auth/refresh:
    post:
      tags: [auth]
      summary: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
      operationId: refreshTokens
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RefreshRequest"
      responses:
        "200":
          description: –¢–æ–∫–µ–Ω—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthResponse"
        "401":
          description: –ù–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π refresh token

  /auth/logout:
    post:
      tags: [auth]
      summary: –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
      operationId: logout
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LogoutRequest"
      responses:
        "200":
          description: –£—Å–ø–µ—à–Ω—ã–π –≤—ã—Ö–æ–¥
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"

  /auth/logout-all:
    post:
      tags: [auth]
      summary: –í—ã—Ö–æ–¥ —Å–æ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
      description: –ò–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –≤—Å–µ refresh —Ç–æ–∫–µ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      operationId: logoutAll
      security:
        - BearerAuth: []
      responses:
        "200":
          description: –í—ã—Ö–æ–¥ —Å–æ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"

  # ---------------------------------------------------------------------------
  # User Endpoints
  # ---------------------------------------------------------------------------
  /users/me:
    get:
      tags: [users]
      summary: –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
      operationId: getProfile
      security:
        - BearerAuth: []
      responses:
        "200":
          description: –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/User"
        "401":
          description: –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω

    patch:
      tags: [users]
      summary: –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
      operationId: updateProfile
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateUserRequest"
      responses:
        "200":
          description: –ü—Ä–æ—Ñ–∏–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/User"

    delete:
      tags: [users]
      summary: –£–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç
      description: –ü–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª—è–µ—Ç —É—á–µ—Ç–Ω—É—é –∑–∞–ø–∏—Å—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      operationId: deleteAccount
      security:
        - BearerAuth: []
      responses:
        "200":
          description: –ê–∫–∫–∞—É–Ω—Ç —É–¥–∞–ª–µ–Ω
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"

  /users/me/password:
    put:
      tags: [users]
      summary: –°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å
      operationId: changePassword
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ChangePasswordRequest"
      responses:
        "200":
          description: –ü–∞—Ä–æ–ª—å –∏–∑–º–µ–Ω–µ–Ω
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
        "400":
          description: –ù–µ–≤–µ—Ä–Ω—ã–π —Ç–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å

  # ---------------------------------------------------------------------------
  # Notification Endpoints
  # ---------------------------------------------------------------------------
  /notifications:
    get:
      tags: [notifications]
      summary: –°–ø–∏—Å–æ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
      operationId: getNotifications
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: page_size
          in: query
          schema:
            type: integer
            default: 20
        - name: is_read
          in: query
          description: –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É –ø—Ä–æ—á—Ç–µ–Ω–∏—è
          schema:
            type: boolean
      responses:
        "200":
          description: –°–ø–∏—Å–æ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NotificationList"

    delete:
      tags: [notifications]
      summary: –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
      operationId: deleteAllReadNotifications
      security:
        - BearerAuth: []
      responses:
        "200":
          description: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω—ã
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"

  /notifications/count:
    get:
      tags: [notifications]
      summary: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö
      operationId: getUnreadCount
      security:
        - BearerAuth: []
      responses:
        "200":
          description: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UnreadCount"

  /notifications/{id}/read:
    post:
      tags: [notifications]
      summary: –û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ
      operationId: markAsRead
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: ID —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (notification_id)
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –û—Ç–º–µ—á–µ–Ω–æ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"

  /notifications/read-all:
    post:
      tags: [notifications]
      summary: –û—Ç–º–µ—Ç–∏—Ç—å –≤—Å–µ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ
      operationId: markAllAsRead
      security:
        - BearerAuth: []
      responses:
        "200":
          description: –í—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–º–µ—á–µ–Ω—ã –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"

  /notifications/{id}:
    delete:
      tags: [notifications]
      summary: –£–¥–∞–ª–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
      operationId: deleteNotification
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"

  # ---------------------------------------------------------------------------
  # Workspace Endpoints
  # ---------------------------------------------------------------------------
  /workspaces:
    get:
      tags: [workspaces]
      summary: –°–ø–∏—Å–æ–∫ –≤–æ—Ä–∫—Å–ø–µ–π—Å–æ–≤
      operationId: listWorkspaces
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: page_size
          in: query
          schema:
            type: integer
            default: 20
        - name: name
          in: query
          description: –§–∏–ª—å—Ç—Ä –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
          schema:
            type: string
      responses:
        "200":
          description: –°–ø–∏—Å–æ–∫ –≤–æ—Ä–∫—Å–ø–µ–π—Å–æ–≤
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      workspaces:
                        type: array
                        items:
                          $ref: "#/components/schemas/Workspace"
                      pagination:
                        $ref: "#/components/schemas/Pagination"

    post:
      tags: [workspaces]
      summary: –°–æ–∑–¥–∞—Ç—å –≤–æ—Ä–∫—Å–ø–µ–π—Å
      operationId: createWorkspace
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateWorkspaceRequest"
      responses:
        "201":
          description: –í–æ—Ä–∫—Å–ø–µ–π—Å —Å–æ–∑–¥–∞–Ω
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Workspace"

  /workspaces/{id}:
    get:
      tags: [workspaces]
      summary: –ü–æ–ª—É—á–∏—Ç—å –≤–æ—Ä–∫—Å–ø–µ–π—Å
      operationId: getWorkspace
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: ID –≤–æ—Ä–∫—Å–ø–µ–π—Å–∞ (workspace_id). –ü–æ–ª—É—á–∞–µ—Ç–µ –∏–∑ POST /workspaces –∏–ª–∏ GET /workspaces
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –î–∞–Ω–Ω—ã–µ –≤–æ—Ä–∫—Å–ø–µ–π—Å–∞
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Workspace"
        "404":
          description: –ù–µ –Ω–∞–π–¥–µ–Ω

    patch:
      tags: [workspaces]
      summary: –û–±–Ω–æ–≤–∏—Ç—å –≤–æ—Ä–∫—Å–ø–µ–π—Å
      operationId: updateWorkspace
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateWorkspaceRequest"
      responses:
        "200":
          description: –í–æ—Ä–∫—Å–ø–µ–π—Å –æ–±–Ω–æ–≤–ª–µ–Ω
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Workspace"

    delete:
      tags: [workspaces]
      summary: –£–¥–∞–ª–∏—Ç—å –≤–æ—Ä–∫—Å–ø–µ–π—Å
      operationId: deleteWorkspace
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –í–æ—Ä–∫—Å–ø–µ–π—Å —É–¥–∞–ª–µ–Ω
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"

  /workspaces/{id}/members:
    get:
      tags: [workspaces]
      summary: –°–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≤–æ—Ä–∫—Å–ø–µ–π—Å–∞
      operationId: getWorkspaceMembers
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –°–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      members:
                        type: array
                        items:
                          $ref: "#/components/schemas/Member"

    post:
      tags: [workspaces]
      summary: –î–æ–±–∞–≤–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞
      operationId: addWorkspaceMember
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AddMemberRequest"
      responses:
        "201":
          description: –£—á–∞—Å—Ç–Ω–∏–∫ –¥–æ–±–∞–≤–ª–µ–Ω
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Member"

  /workspaces/{id}/members/{memberId}:
    delete:
      tags: [workspaces]
      summary: –£–¥–∞–ª–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞
      operationId: removeWorkspaceMember
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: memberId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –£—á–∞—Å—Ç–Ω–∏–∫ —É–¥–∞–ª–µ–Ω
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"

  /workspaces/{workspace_id}/scenes:
    get:
      tags: [workspaces, scenes]
      summary: –°–ø–∏—Å–æ–∫ —Å—Ü–µ–Ω –≤–æ—Ä–∫—Å–ø–µ–π—Å–∞
      operationId: listWorkspaceScenes
      security:
        - BearerAuth: []
      parameters:
        - name: workspace_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: page_size
          in: query
          schema:
            type: integer
            default: 20
      responses:
        "200":
          description: –°–ø–∏—Å–æ–∫ —Å—Ü–µ–Ω
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      scenes:
                        type: array
                        items:
                          $ref: "#/components/schemas/Scene"
                      pagination:
                        $ref: "#/components/schemas/Pagination"

    post:
      tags: [workspaces, scenes]
      summary: –°–æ–∑–¥–∞—Ç—å —Å—Ü–µ–Ω—É –≤ –≤–æ—Ä–∫—Å–ø–µ–π—Å–µ
      operationId: createWorkspaceScene
      security:
        - BearerAuth: []
      parameters:
        - name: workspace_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateSceneRequest"
      responses:
        "201":
          description: –°—Ü–µ–Ω–∞ —Å–æ–∑–¥–∞–Ω–∞
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Scene"

  # ---------------------------------------------------------------------------
  # Scene Endpoints
  # ---------------------------------------------------------------------------
  /scenes/{id}:
    get:
      tags: [scenes]
      summary: –ü–æ–ª—É—á–∏—Ç—å —Å—Ü–µ–Ω—É
      description: |
        –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ 3D —Å—Ü–µ–Ω—ã –¥–ª—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞.
        
        –°—Ü–µ–Ω–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è –∏–∑ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ —á–µ—Ä–µ–∑ POST /workspaces/{workspace_id}/scenes
      operationId: getScene
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: ID —Å—Ü–µ–Ω—ã (scene_id). –ü–æ–ª—É—á–∞–µ—Ç–µ –∏–∑ POST /workspaces/{workspace_id}/scenes
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –î–∞–Ω–Ω—ã–µ —Å—Ü–µ–Ω—ã
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Scene"

    patch:
      tags: [scenes]
      summary: –û–±–Ω–æ–≤–∏—Ç—å —Å—Ü–µ–Ω—É
      operationId: updateScene
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateSceneRequest"
      responses:
        "200":
          description: –°—Ü–µ–Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Scene"

    delete:
      tags: [scenes]
      summary: –£–¥–∞–ª–∏—Ç—å —Å—Ü–µ–Ω—É
      operationId: deleteScene
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –°—Ü–µ–Ω–∞ —É–¥–∞–ª–µ–Ω–∞
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"

  /scenes/{id}/compliance:
    get:
      tags: [scenes, compliance]
      summary: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ü–µ–Ω—É –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –Ω–æ—Ä–º–∞–º
      operationId: checkSceneCompliance
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SceneComplianceResult"

  # ---------------------------------------------------------------------------
  # Floor Plan Endpoints
  # ---------------------------------------------------------------------------
  /floor-plans:
    get:
      tags: [floor-plans]
      summary: –°–ø–∏—Å–æ–∫ –ø–ª–∞–Ω–∏—Ä–æ–≤–æ–∫
      operationId: listFloorPlans
      security:
        - BearerAuth: []
      parameters:
        - name: workspace_id
          in: query
          schema:
            type: string
            format: uuid
        - name: status
          in: query
          schema:
            type: string
            enum: [uploaded, processing, recognized, failed]
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: page_size
          in: query
          schema:
            type: integer
            default: 20
      responses:
        "200":
          description: –°–ø–∏—Å–æ–∫ –ø–ª–∞–Ω–∏—Ä–æ–≤–æ–∫
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      floor_plans:
                        type: array
                        items:
                          $ref: "#/components/schemas/FloorPlan"
                      pagination:
                        $ref: "#/components/schemas/Pagination"

    post:
      tags: [floor-plans]
      summary: –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤–∫—É
      description: |
        –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏.
        
        **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:** JPEG, PNG, WebP
        **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä:** 10 MB
        
        **–ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏:**
        1. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ `id` –∏–∑ –æ—Ç–≤–µ—Ç–∞ (—ç—Ç–æ floor_plan_id)
        2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ: POST /ai/recognize —Å —ç—Ç–∏–º floor_plan_id
      operationId: uploadFloorPlan
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [workspace_id, name, file]
              properties:
                workspace_id:
                  type: string
                  format: uuid
                  description: ID –≤–æ—Ä–∫—Å–ø–µ–π—Å–∞, –∫—É–¥–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∞
                name:
                  type: string
                  description: –ù–∞–∑–≤–∞–Ω–∏–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏
                description:
                  type: string
                address:
                  type: string
                  description: –ê–¥—Ä–µ—Å –∫–≤–∞—Ä—Ç–∏—Ä—ã
                file:
                  type: string
                  format: binary
                  description: –§–∞–π–ª –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (JPEG, PNG, WebP)
      responses:
        "201":
          description: |
            –ü–ª–∞–Ω–∏—Ä–æ–≤–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞.
            
            ‚ö†Ô∏è **–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ `data.id`** - —ç—Ç–æ floor_plan_id –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π!
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/FloorPlan"

  /floor-plans/{id}:
    get:
      tags: [floor-plans]
      summary: –ü–æ–ª—É—á–∏—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤–∫—É —Å –º–æ–¥–µ–ª—å—é
      description: |
        –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–µ.
        
        **–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è** –≤ –æ—Ç–≤–µ—Ç–µ –±—É–¥–µ—Ç –ø–æ–ª–µ `model` —Å –ø–æ–ª–Ω–æ–π 3D –º–æ–¥–µ–ª—å—é –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏,
        –≤–∫–ª—é—á–∞—é—â–µ–π —Å—Ç–µ–Ω—ã, –∫–æ–º–Ω–∞—Ç—ã, –ø—Ä–æ—ë–º—ã, –º–µ–±–µ–ª—å –∏ –∏–Ω–∂–µ–Ω–µ—Ä–Ω—ã–µ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏.
        
        –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è 3D —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –≤ –æ–¥–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ.
        
        ‚ö†Ô∏è –ï—Å–ª–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –µ—â—ë –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ, –ø–æ–ª–µ `model` –±—É–¥–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å.
      operationId: getFloorPlan
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: ID –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ (floor_plan_id). –ü–æ–ª—É—á–∞–µ—Ç–µ –∏–∑ POST /floor-plans
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –î–∞–Ω–Ω—ã–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ —Å –º–æ–¥–µ–ª—å—é (–µ—Å–ª–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–∞)
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/FloorPlan"

    patch:
      tags: [floor-plans]
      summary: –û–±–Ω–æ–≤–∏—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤–∫—É
      operationId: updateFloorPlan
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateFloorPlanRequest"
      responses:
        "200":
          description: –ü–ª–∞–Ω–∏—Ä–æ–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/FloorPlan"

    delete:
      tags: [floor-plans]
      summary: –£–¥–∞–ª–∏—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤–∫—É
      operationId: deleteFloorPlan
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –ü–ª–∞–Ω–∏—Ä–æ–≤–∫–∞ —É–¥–∞–ª–µ–Ω–∞
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"

  /floor-plans/{id}/recognize:
    post:
      tags: [floor-plans, ai]
      summary: –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏
      description: |
        –ó–∞–ø—É—Å–∫–∞–µ—Ç AI —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–π –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏.
        
        **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞:** POST /ai/recognize - –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞–ø—Ä—è–º—É—é.
        
        –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ polling:
        - GET /ai/recognize/{job_id}/status - –ø–æ job_id –∏–∑ –æ—Ç–≤–µ—Ç–∞
        - GET /floor-plans/{id}/recognition-status - –ø–æ floor_plan_id
      operationId: startFloorPlanRecognition
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: ID –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ (floor_plan_id)
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                create_scene:
                  type: boolean
                  default: true
                detect_furniture:
                  type: boolean
                  default: false
      responses:
        "202":
          description: –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      job_id:
                        type: string
                        format: uuid
                      status:
                        type: string
                        example: processing

  /floor-plans/{id}/recognition-status:
    get:
      tags: [floor-plans, ai]
      summary: –°—Ç–∞—Ç—É—Å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Å –º–æ–¥–µ–ª—å—é
      description: |
        –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏ AI —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏.
        
        ‚ö†Ô∏è **–í–ê–ñ–ù–û:** –í URL –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è ID –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ (floor_plan_id), –ù–ï job_id!
        
        **–ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è** (status=completed) –≤ –æ—Ç–≤–µ—Ç–µ –±—É–¥–µ—Ç –ø–æ–ª–µ `model` 
        —Å –ø–æ–ª–Ω–æ–π 3D –º–æ–¥–µ–ª—å—é –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏.
        
        –ú–æ–¥–µ–ª—å –≤–∫–ª—é—á–∞–µ—Ç:
        - **bounds** - –≥–∞–±–∞—Ä–∏—Ç—ã –∫–≤–∞—Ä—Ç–∏—Ä—ã
        - **elements.walls** - —Å—Ç–µ–Ω—ã —Å –ø—Ä–æ—ë–º–∞–º–∏
        - **elements.rooms** - –∫–æ–º–Ω–∞—Ç—ã —Å –ø–æ–ª–∏–≥–æ–Ω–∞–º–∏
        - **elements.furniture** - –º–µ–±–µ–ª—å –∏ —Å–∞–Ω—Ç–µ—Ö–Ω–∏–∫–∞
        - **elements.utilities** - —Å—Ç–æ—è–∫–∏ –∏ –≤–µ–Ω—Ç–∏–ª—è—Ü–∏—è
        
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç 404 –µ—Å–ª–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –Ω–µ –±—ã–ª–æ –∑–∞–ø—É—â–µ–Ω–æ –¥–ª—è –¥–∞–Ω–Ω–æ–π –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏.
      operationId: getFloorPlanRecognitionStatus
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: ID –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ (floor_plan_id), –ù–ï job_id –∑–∞–¥–∞—á–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –°—Ç–∞—Ç—É—Å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Å –º–æ–¥–µ–ª—å—é
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RecognitionStatus"

  /floor-plans/{id}/download-url:
    get:
      tags: [floor-plans]
      summary: –ü–æ–ª—É—á–∏—Ç—å URL –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
      operationId: getFloorPlanDownloadURL
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: URL –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      url:
                        type: string
                        format: uri
                      expires_at:
                        type: string
                        format: date-time

  # ---------------------------------------------------------------------------
  # Branch Endpoints
  # ---------------------------------------------------------------------------
  /scenes/{scene_id}/branches:
    get:
      tags: [branches]
      summary: –°–ø–∏—Å–æ–∫ –≤–µ—Ç–æ–∫ —Å—Ü–µ–Ω—ã
      description: |
        –í–µ—Ç–∫–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–π —Å—Ü–µ–Ω—ã.
        
        **–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
        1. –°–æ–∑–¥–∞—ë—Ç–µ —Å—Ü–µ–Ω—É –∏–∑ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏
        2. –°–æ–∑–¥–∞—ë—Ç–µ –≤–µ—Ç–∫—É "–í–∞—Ä–∏–∞–Ω—Ç 1"
        3. –°–æ–∑–¥–∞—ë—Ç–µ –≤–µ—Ç–∫—É "–í–∞—Ä–∏–∞–Ω—Ç 2"
        4. –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç–µ –≤–µ—Ç–∫–∏ —á–µ—Ä–µ–∑ /compare
        5. –ú–µ—Ä–¥–∂–∏—Ç–µ –ª—É—á—à–∏–π –≤–∞—Ä–∏–∞–Ω—Ç –≤ main
      operationId: listBranches
      security:
        - BearerAuth: []
      parameters:
        - name: scene_id
          in: path
          required: true
          description: ID —Å—Ü–µ–Ω—ã
          schema:
            type: string
            format: uuid
        - name: status
          in: query
          schema:
            type: string
            enum: [active, archived, merged]
      responses:
        "200":
          description: –°–ø–∏—Å–æ–∫ –≤–µ—Ç–æ–∫
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      branches:
                        type: array
                        items:
                          $ref: "#/components/schemas/Branch"

    post:
      tags: [branches]
      summary: –°–æ–∑–¥–∞—Ç—å –≤–µ—Ç–∫—É
      operationId: createBranch
      security:
        - BearerAuth: []
      parameters:
        - name: scene_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateBranchRequest"
      responses:
        "201":
          description: –í–µ—Ç–∫–∞ —Å–æ–∑–¥–∞–Ω–∞
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Branch"

  /scenes/{scene_id}/branches/{id}:
    get:
      tags: [branches]
      summary: –ü–æ–ª—É—á–∏—Ç—å –≤–µ—Ç–∫—É
      operationId: getBranch
      security:
        - BearerAuth: []
      parameters:
        - name: scene_id
          in: path
          required: true
          description: ID —Å—Ü–µ–Ω—ã
          schema:
            type: string
            format: uuid
        - name: id
          in: path
          required: true
          description: ID –≤–µ—Ç–∫–∏ (branch_id)
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –î–∞–Ω–Ω—ã–µ –≤–µ—Ç–∫–∏
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Branch"

    patch:
      tags: [branches]
      summary: –û–±–Ω–æ–≤–∏—Ç—å –≤–µ—Ç–∫—É
      operationId: updateBranch
      security:
        - BearerAuth: []
      parameters:
        - name: scene_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateBranchRequest"
      responses:
        "200":
          description: –í–µ—Ç–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Branch"

    delete:
      tags: [branches]
      summary: –£–¥–∞–ª–∏—Ç—å –≤–µ—Ç–∫—É
      operationId: deleteBranch
      security:
        - BearerAuth: []
      parameters:
        - name: scene_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –í–µ—Ç–∫–∞ —É–¥–∞–ª–µ–Ω–∞
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"

  /scenes/{scene_id}/branches/{id}/activate:
    post:
      tags: [branches]
      summary: –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Ç–∫—É
      description: –î–µ–ª–∞–µ—Ç –≤–µ—Ç–∫—É –∞–∫—Ç–∏–≤–Ω–æ–π (—Ç–µ–∫—É—â–µ–π –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
      operationId: activateBranch
      security:
        - BearerAuth: []
      parameters:
        - name: scene_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –í–µ—Ç–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Branch"

  /scenes/{scene_id}/branches/{id}/duplicate:
    post:
      tags: [branches]
      summary: –î—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Ç–∫—É
      operationId: duplicateBranch
      security:
        - BearerAuth: []
      parameters:
        - name: scene_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  description: –ù–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–π –≤–µ—Ç–∫–∏
      responses:
        "201":
          description: –í–µ—Ç–∫–∞ –ø—Ä–æ–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∞
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Branch"

  /scenes/{scene_id}/branches/{id}/compare/{target_id}:
    get:
      tags: [branches]
      summary: –°—Ä–∞–≤–Ω–∏—Ç—å –¥–≤–µ –≤–µ—Ç–∫–∏
      operationId: compareBranches
      security:
        - BearerAuth: []
      parameters:
        - name: scene_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: id
          in: path
          required: true
          description: ID –∏—Å—Ö–æ–¥–Ω–æ–π –≤–µ—Ç–∫–∏
          schema:
            type: string
            format: uuid
        - name: target_id
          in: path
          required: true
          description: ID —Ü–µ–ª–µ–≤–æ–π –≤–µ—Ç–∫–∏ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –†–µ–∑—É–ª—å—Ç–∞—Ç —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BranchComparison"

  /scenes/{scene_id}/branches/{id}/merge:
    post:
      tags: [branches]
      summary: –°–ª–∏—Ç—å –≤–µ—Ç–∫–∏
      operationId: mergeBranches
      security:
        - BearerAuth: []
      parameters:
        - name: scene_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: id
          in: path
          required: true
          description: ID –∏—Å—Ö–æ–¥–Ω–æ–π –≤–µ—Ç–∫–∏ (–∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç —Å–ª–∏—Ç–∞)
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/MergeBranchRequest"
      responses:
        "200":
          description: –í–µ—Ç–∫–∏ —Å–ª–∏—Ç—ã
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Branch"

  # ---------------------------------------------------------------------------
  # AI Endpoints
  # ---------------------------------------------------------------------------
  /ai/recognize:
    post:
      tags: [ai]
      summary: –†–∞—Å–ø–æ–∑–Ω–∞—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤–∫—É
      description: |
        –ó–∞–ø—É—Å–∫–∞–µ—Ç AI —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏.
        
        **–ú–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å:**
        - `floor_plan_id` - ID —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–π –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏
        - `image_base64` - –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ base64 (data:image/jpeg;base64,...)
        
        **–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞:**
        1. –ü–æ–ª—É—á–∞–µ—Ç–µ `job_id` –≤ –æ—Ç–≤–µ—Ç–µ
        2. –î–µ–ª–∞–µ—Ç–µ polling: GET /ai/recognize/{job_id}/status
        3. –ö–æ–≥–¥–∞ status="completed" - –º–æ–¥–µ–ª—å –≥–æ—Ç–æ–≤–∞
        
        **–ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
        - GET /floor-plans/{floor_plan_id} ‚Üí –ø–æ–ª–µ `model`
        - GET /floor-plans/{floor_plan_id}/recognition-status ‚Üí –ø–æ–ª–µ `model`
      operationId: recognizeFloorPlan
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RecognizeRequest"
      responses:
        "202":
          description: |
            –ó–∞–¥–∞—á–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Å–æ–∑–¥–∞–Ω–∞.
            
            ‚ö†Ô∏è **–í–∞–∂–Ω–æ:** –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ `job_id` –∏–∑ –æ—Ç–≤–µ—Ç–∞ –¥–ª—è polling —Å—Ç–∞—Ç—É—Å–∞!
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RecognizeResponse"

  /ai/recognize/{job_id}/status:
    get:
      tags: [ai]
      summary: –°—Ç–∞—Ç—É—Å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –ø–æ job_id
      description: |
        –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –ø–æ –µ—ë ID (job_id).
        
        ‚ö†Ô∏è **job_id –ø–æ–ª—É—á–∞–µ—Ç–µ –∏–∑ –æ—Ç–≤–µ—Ç–∞ POST /ai/recognize**
        
        –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç endpoint –¥–ª—è polling —Å—Ç–∞—Ç—É—Å–∞ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è.
        
        –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: `/floor-plans/{floor_plan_id}/recognition-status` - 
        –µ—Å–ª–∏ –∑–Ω–∞–µ—Ç–µ —Ç–æ–ª—å–∫–æ ID –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏.
      operationId: getRecognitionStatus
      security:
        - BearerAuth: []
      parameters:
        - name: job_id
          in: path
          required: true
          description: |
            ID –∑–∞–¥–∞—á–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è (–ù–ï floor_plan_id!).
            –ü–æ–ª—É—á–∞–µ—Ç–µ –∏–∑ –æ—Ç–≤–µ—Ç–∞ POST /ai/recognize ‚Üí data.job_id
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –°—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RecognitionStatus"

  /ai/generate:
    post:
      tags: [ai]
      summary: –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç—ã –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏
      description: |
        AI –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–∞—à–µ–π —Å—Ü–µ–Ω—ã.
        
        **–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
        1. –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ —Å—Ü–µ–Ω—É —Å —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω–æ–π –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–æ–π
        2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Å scene_id
        3. –î–µ–ª–∞–π—Ç–µ polling: GET /ai/generate/{job_id}/status
        4. –ü–æ–ª—É—á–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –≤–µ—Ç–∫–∏
      operationId: generateVariants
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/GenerateVariantsRequest"
      responses:
        "202":
          description: |
            –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–ø—É—â–µ–Ω–∞.
            
            –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ job_id –¥–ª—è polling: GET /ai/generate/{job_id}/status
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GenerateResponse"

  /ai/generate/{job_id}/status:
    get:
      tags: [ai]
      summary: –°—Ç–∞—Ç—É—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
      operationId: getGenerationStatus
      security:
        - BearerAuth: []
      parameters:
        - name: job_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –°—Ç–∞—Ç—É—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GenerationStatus"

  /ai/chat:
    post:
      tags: [ai]
      summary: –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç—É
      description: |
        –ß–∞—Ç —Å AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º –ø–æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–µ.
        
        **–ü—Ä–∏–º–µ—Ä—ã –≤–æ–ø—Ä–æ—Å–æ–≤:**
        - "–ú–æ–∂–Ω–æ –ª–∏ —Å–Ω–µ—Å—Ç–∏ —Å—Ç–µ–Ω—É –º–µ–∂–¥—É –∫—É—Ö–Ω–µ–π –∏ –≥–æ—Å—Ç–∏–Ω–æ–π?"
        - "–ö–∞–∫ —É–≤–µ–ª–∏—á–∏—Ç—å –ø–ª–æ—â–∞–¥—å –≤–∞–Ω–Ω–æ–π?"
        - "–ü—Ä–µ–¥–ª–æ–∂–∏ –≤–∞—Ä–∏–∞–Ω—Ç—ã –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏"
        
        **–î–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞** –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ `scene_id` - AI –±—É–¥–µ—Ç —É—á–∏—Ç—ã–≤–∞—Ç—å –≤–∞—à—É –ø–ª–∞–Ω–∏—Ä–æ–≤–∫—É.
      operationId: sendChatMessage
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ChatMessageRequest"
      responses:
        "200":
          description: –û—Ç–≤–µ—Ç AI
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ChatMessageResponse"
        "429":
          description: –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤

  /ai/chat/history:
    get:
      tags: [ai]
      summary: –ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞
      operationId: getChatHistory
      security:
        - BearerAuth: []
      parameters:
        - name: session_id
          in: query
          schema:
            type: string
            format: uuid
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
      responses:
        "200":
          description: –ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ChatHistory"

    delete:
      tags: [ai]
      summary: –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–∞
      operationId: clearChatHistory
      security:
        - BearerAuth: []
      parameters:
        - name: session_id
          in: query
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –ò—Å—Ç–æ—Ä–∏—è –æ—á–∏—â–µ–Ω–∞
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"

  /ai/context:
    get:
      tags: [ai]
      summary: –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç AI
      description: –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç AI –¥–ª—è —Å—Ü–µ–Ω—ã (–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–µ)
      operationId: getAIContext
      security:
        - BearerAuth: []
      parameters:
        - name: scene_id
          in: query
          required: true
          schema:
            type: string
            format: uuid
        - name: branch_id
          in: query
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –ö–æ–Ω—Ç–µ–∫—Å—Ç AI
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      context_id:
                        type: string
                      scene_summary:
                        type: string
                        description: –û–ø–∏—Å–∞–Ω–∏–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ –¥–ª—è AI
                      context_size:
                        type: integer
                        description: –†–∞–∑–º–µ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤ —Ç–æ–∫–µ–Ω–∞—Ö
                      updated_at:
                        type: string
                        format: date-time
    post:
      tags: [ai]
      summary: –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç AI
      description: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç AI –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Å—Ü–µ–Ω–µ
      operationId: updateAIContext
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - scene_id
              properties:
                scene_id:
                  type: string
                  format: uuid
                branch_id:
                  type: string
                  format: uuid
                force:
                  type: boolean
                  default: false
                  description: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
      responses:
        "200":
          description: –ö–æ–Ω—Ç–µ–∫—Å—Ç –æ–±–Ω–æ–≤–ª—ë–Ω
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      context_id:
                        type: string
                      updated:
                        type: boolean
                      context_size:
                        type: integer

  /scenes/{scene_id}/chat/messages/{message_id}/select:
    post:
      tags: [ai, scenes]
      summary: –í—ã–±—Ä–∞—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç –∏–∑ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã—Ö AI
      description: –í—ã–±–æ—Ä –≤–∞—Ä–∏–∞–Ω—Ç–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ –∏–∑ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã—Ö AI. –ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –≤–µ—Ç–∫—É.
      operationId: selectSuggestion
      security:
        - BearerAuth: []
      parameters:
        - name: scene_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: message_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: ID —Å–æ–æ–±—â–µ–Ω–∏—è —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - suggestion_index
              properties:
                suggestion_index:
                  type: integer
                  minimum: 0
                  maximum: 4
                  description: –ò–Ω–¥–µ–∫—Å –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞ (0-4)
      responses:
        "200":
          description: –í–∞—Ä–∏–∞–Ω—Ç –≤—ã–±—Ä–∞–Ω –∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      selected_branch_id:
                        type: string
                        format: uuid
                        description: ID –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≤–µ—Ç–∫–∏
                      branch_activated:
                        type: boolean
                        description: –ë—ã–ª–∞ –ª–∏ –≤–µ—Ç–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞
                      confirmation_message:
                        type: string
                        description: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç AI
        "400":
          description: –ù–µ–≤–µ—Ä–Ω—ã–π –∏–Ω–¥–µ–∫—Å –≤–∞—Ä–∏–∞–Ω—Ç–∞
        "404":
          description: –°–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ

  # ---------------------------------------------------------------------------
  # Compliance Endpoints
  # ---------------------------------------------------------------------------
  /compliance/check:
    post:
      tags: [compliance]
      summary: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –Ω–æ—Ä–º–∞–º
      description: |
        –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–ª–∞–Ω–∏—Ä–æ–≤–∫—É –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –°–ù–∏–ü, –ñ–ö –†–§ –∏ –¥—Ä—É–≥–∏–º –Ω–æ—Ä–º–∞–º.
        
        **–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:**
        - –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø–ª–æ—â–∞–¥–∏ –∫–æ–º–Ω–∞—Ç
        - –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –º–æ–∫—Ä—ã—Ö –∑–æ–Ω
        - –ù–µ—Å—É—â–∏–µ —Å—Ç–µ–Ω—ã
        - –í–µ–Ω—Ç–∏–ª—è—Ü–∏—è –∏ –∏–Ω–∂–µ–Ω–µ—Ä–Ω—ã–µ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏
        
        **–†–µ–∑—É–ª—å—Ç–∞—Ç:** —Å–ø–∏—Å–æ–∫ –Ω–∞—Ä—É—à–µ–Ω–∏–π —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏
      operationId: checkCompliance
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ComplianceCheckRequest"
      responses:
        "200":
          description: –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ComplianceCheckResponse"

  /compliance/check-operation:
    post:
      tags: [compliance]
      summary: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ
      description: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –æ–ø–µ—Ä–∞—Ü–∏—é (—Å–Ω–æ—Å —Å—Ç–µ–Ω—ã, –ø–µ—Ä–µ–Ω–æ—Å –∏ —Ç.–¥.) –¥–æ –µ—ë –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
      operationId: checkOperation
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CheckOperationRequest"
      responses:
        "200":
          description: –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ComplianceCheckResponse"

  /compliance/rules:
    get:
      tags: [compliance]
      summary: –°–ø–∏—Å–æ–∫ –ø—Ä–∞–≤–∏–ª
      operationId: listComplianceRules
      security:
        - BearerAuth: []
      parameters:
        - name: category
          in: query
          schema:
            type: string
        - name: is_active
          in: query
          schema:
            type: boolean
      responses:
        "200":
          description: –°–ø–∏—Å–æ–∫ –ø—Ä–∞–≤–∏–ª
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      rules:
                        type: array
                        items:
                          $ref: "#/components/schemas/ComplianceRule"

  /compliance/rules/{id}:
    get:
      tags: [compliance]
      summary: –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–∞–≤–∏–ª–æ
      operationId: getComplianceRule
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: –î–∞–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/ComplianceRule"

  /compliance/report:
    post:
      tags: [compliance]
      summary: –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á–µ—Ç
      description: –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç PDF/HTML –æ—Ç—á–µ—Ç –æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ –Ω–æ—Ä–º–∞–º
      operationId: generateComplianceReport
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/GenerateReportRequest"
      responses:
        "200":
          description: –û—Ç—á–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      report_id:
                        type: string
                        format: uuid
                      download_url:
                        type: string
                        format: uri
                      expires_at:
                        type: string
                        format: date-time

  # ---------------------------------------------------------------------------
  # Request (Expert) Endpoints
  # ---------------------------------------------------------------------------
  /requests:
    get:
      tags: [requests]
      summary: –°–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫
      operationId: listRequests
      security:
        - BearerAuth: []
      parameters:
        - name: workspace_id
          in: query
          schema:
            type: string
            format: uuid
        - name: status
          in: query
          schema:
            type: string
            enum:
              [
                draft,
                pending,
                in_review,
                approved,
                rejected,
                assigned,
                in_progress,
                completed,
                cancelled,
              ]
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: page_size
          in: query
          schema:
            type: integer
            default: 20
      responses:
        "200":
          description: –°–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      requests:
                        type: array
                        items:
                          $ref: "#/components/schemas/ExpertRequest"
                      pagination:
                        $ref: "#/components/schemas/Pagination"

    post:
      tags: [requests]
      summary: –°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É
      operationId: createRequest
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateExpertRequestRequest"
      responses:
        "201":
          description: –ó–∞—è–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/ExpertRequest"

  /requests/{id}:
    get:
      tags: [requests]
      summary: –ü–æ–ª—É—á–∏—Ç—å –∑–∞—è–≤–∫—É
      operationId: getRequest
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: ID –∑–∞—è–≤–∫–∏ (request_id). –ü–æ–ª—É—á–∞–µ—Ç–µ –∏–∑ POST /requests –∏–ª–∏ GET /requests
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –î–∞–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/ExpertRequest"

    patch:
      tags: [requests]
      summary: –û–±–Ω–æ–≤–∏—Ç—å –∑–∞—è–≤–∫—É
      operationId: updateRequest
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateExpertRequestRequest"
      responses:
        "200":
          description: –ó–∞—è–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/ExpertRequest"

    delete:
      tags: [requests]
      summary: –£–¥–∞–ª–∏—Ç—å –∑–∞—è–≤–∫—É
      description: –£–¥–∞–ª—è–µ—Ç –∑–∞—è–≤–∫—É (—Ç–æ–ª—å–∫–æ –≤ —Å—Ç–∞—Ç—É—Å–µ draft)
      operationId: deleteRequest
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –ó–∞—è–≤–∫–∞ —É–¥–∞–ª–µ–Ω–∞
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"

  /requests/{id}/submit:
    post:
      tags: [requests]
      summary: –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É
      description: –ü–µ—Ä–µ–≤–æ–¥–∏—Ç –∑–∞—è–≤–∫—É –∏–∑ draft –≤ pending
      operationId: submitRequest
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/ExpertRequest"

  /requests/{id}/cancel:
    post:
      tags: [requests]
      summary: –û—Ç–º–µ–Ω–∏—Ç—å –∑–∞—è–≤–∫—É
      operationId: cancelRequest
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                reason:
                  type: string
                  description: –ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–º–µ–Ω—ã
      responses:
        "200":
          description: –ó–∞—è–≤–∫–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/ExpertRequest"

  /requests/{id}/documents:
    get:
      tags: [requests]
      summary: –°–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∑–∞—è–≤–∫–∏
      operationId: getRequestDocuments
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –°–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      documents:
                        type: array
                        items:
                          $ref: "#/components/schemas/RequestDocument"

    post:
      tags: [requests]
      summary: –î–æ–±–∞–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç –∫ –∑–∞—è–≤–∫–µ
      operationId: addRequestDocument
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [file]
              properties:
                file:
                  type: string
                  format: binary
                name:
                  type: string
                type:
                  type: string
                  enum: [floor_plan, passport, contract, other]
      responses:
        "201":
          description: –î–æ–∫—É–º–µ–Ω—Ç –¥–æ–±–∞–≤–ª–µ–Ω
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/RequestDocument"
