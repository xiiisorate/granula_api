# =============================================================================
# Granula API - OpenAPI 3.0 Specification
# =============================================================================
# –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è REST API –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–º–æ–Ω—Ç–∞ –∏ –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏.
#
# –í–µ—Ä—Å–∏—è: 1.1.0
# –î–∞—Ç–∞: 2025-11-30
# =============================================================================

openapi: 3.0.3

info:
  title: Granula API
  version: 1.1.0
  description: |
    # Granula API

    API –¥–ª—è –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–º–æ–Ω—Ç–∞ –∏ –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ –∫–≤–∞—Ä—Ç–∏—Ä.

    ## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

    - üè† **–ó–∞–≥—Ä—É–∑–∫–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–æ–∫** - –ó–∞–≥—Ä—É–∂–∞–π—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–ª–∞–Ω–∏—Ä–æ–≤–æ–∫ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
    - ü§ñ **AI —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ** - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç, —Å—Ç–µ–Ω –∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
    - üé® **3D —Ä–µ–¥–∞–∫—Ç–æ—Ä** - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ –≤ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–º 3D —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ
    - ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ—Ä–º** - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –°–ù–∏–ü –∏ –ñ–ö –†–§
    - üí° **AI –≥–µ–Ω–µ—Ä–∞—Ü–∏—è** - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ —Å –ø–æ–º–æ—â—å—é AI
    - üìã **–ó–∞—è–≤–∫–∏ —ç–∫—Å–ø–µ—Ä—Ç–∞–º** - –ü–æ–¥–∞—á–∞ –∑–∞—è–≤–æ–∫ –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤ –ë–¢–ò

    ## –¢–∏–ø–∏—á–Ω—ã–π Flow —Ä–∞–±–æ—Ç—ã

    ### 1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
    ```
    POST /auth/register ‚Üí –ø–æ–ª—É—á–∞–µ–º access_token
    ```

    ### 2. –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
    ```
    POST /workspaces ‚Üí —Å–æ–∑–¥–∞—ë–º –≤–æ—Ä–∫—Å–ø–µ–π—Å (–ø—Ä–æ–µ–∫—Ç –∫–≤–∞—Ä—Ç–∏—Ä—ã)
    ```

    ### 3. –ó–∞–≥—Ä—É–∑–∫–∞ –∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏
    ```
    POST /floor-plans (—Å —Ñ–∞–π–ª–æ–º) ‚Üí –ø–æ–ª—É—á–∞–µ–º floor_plan_id
    POST /ai/recognize (—Å floor_plan_id) ‚Üí –ø–æ–ª—É—á–∞–µ–º job_id
    GET /ai/recognize/{job_id}/status ‚Üí polling –ø–æ–∫–∞ status != "completed"
    ```

    ### 4. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
    ```
    GET /floor-plans/{floor_plan_id} ‚Üí –ø–æ–ª—É—á–∞–µ–º –ø–ª–∞–Ω–∏—Ä–æ–≤–∫—É —Å –ø–æ–ª–µ–º "model"
    ```
    –∏–ª–∏
    ```
    GET /floor-plans/{floor_plan_id}/recognition-status ‚Üí —Å—Ç–∞—Ç—É—Å + model
    ```

    ### 5. –†–∞–±–æ—Ç–∞ —Å 3D —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–º
    ```
    POST /workspaces/{workspace_id}/scenes ‚Üí —Å–æ–∑–¥–∞—ë–º —Å—Ü–µ–Ω—É –∏–∑ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏
    GET /scenes/{scene_id} ‚Üí –¥–∞–Ω–Ω—ã–µ —Å—Ü–µ–Ω—ã –¥–ª—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
    ```

    ## –í–∞–∂–Ω–æ: –†–∞–∑–ª–∏—á–∏–µ ID

    | –°—É—â–Ω–æ—Å—Ç—å | –ü–æ–ª–µ | –ì–¥–µ –ø–æ–ª—É—á–∏—Ç—å |
    |----------|------|--------------|
    | –ü–ª–∞–Ω–∏—Ä–æ–≤–∫–∞ | `floor_plan_id` | POST /floor-plans ‚Üí response.data.id |
    | –ó–∞–¥–∞—á–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è | `job_id` | POST /ai/recognize ‚Üí response.data.job_id |
    | –í–æ—Ä–∫—Å–ø–µ–π—Å | `workspace_id` | POST /workspaces ‚Üí response.data.id |
    | –°—Ü–µ–Ω–∞ | `scene_id` | POST /workspaces/{id}/scenes ‚Üí response.data.id |
    | –ó–∞—è–≤–∫–∞ | `request_id` | POST /requests ‚Üí response.data.id |

    ‚ö†Ô∏è **–ù–ï –ü–£–¢–ê–¢–¨:** `floor_plan_id` –∏ `job_id` - —ç—Ç–æ –†–ê–ó–ù–´–ï –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã!

    ## –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

    API –∏—Å–ø–æ–ª—å–∑—É–µ—Ç JWT (JSON Web Tokens) –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.

    ### –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤

    1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å —á–µ—Ä–µ–∑ `POST /api/v1/auth/register`
    2. –ò–ª–∏ –≤–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ `POST /api/v1/auth/login`
    3. –ü–æ–ª—É—á–∏—Ç–µ `access_token` –∏ `refresh_token`

    ### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤

    –ü–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ Access Token –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ Authorization:
    ```
    Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
    ```

    ### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤

    Access Token –¥–µ–π—Å—Ç–≤—É–µ—Ç 15 –º–∏–Ω—É—Ç. –î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `POST /api/v1/auth/refresh`

    ## Rate Limiting

    | –¢–∏–ø –∑–∞–ø—Ä–æ—Å–∞ | –õ–∏–º–∏—Ç |
    |-------------|-------|
    | –ê–Ω–æ–Ω–∏–º–Ω—ã–µ | 60 req/min |
    | –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ | 300 req/min |
    | AI endpoints | 30 req/min |

    –ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è HTTP 429.

    ## –ö–æ–¥—ã –æ—à–∏–±–æ–∫

    | –ö–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
    |-----|----------|
    | VALIDATION_ERROR | –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö |
    | UNAUTHORIZED | –¢—Ä–µ–±—É–µ—Ç—Å—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è |
    | FORBIDDEN | –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ |
    | NOT_FOUND | –†–µ—Å—É—Ä—Å –Ω–µ –Ω–∞–π–¥–µ–Ω |
    | CONFLICT | –ö–æ–Ω—Ñ–ª–∏–∫—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ) |
    | RATE_LIMITED | –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ |
    | INTERNAL_ERROR | –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ |

  termsOfService: https://granula.ru/terms
  contact:
    name: Granula API Support
    url: https://granula.ru/support
    email: api@granula.ru
  license:
    name: Proprietary
    url: https://granula.ru/license

servers:
  - url: https://api.granula.raitokyokai.tech/api/v1
    description: Production —Å–µ—Ä–≤–µ—Ä
  - url: http://localhost:3001/api/v1
    description: –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

tags:
  - name: auth
    description: –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏
  - name: users
    description: –ü—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  - name: workspaces
    description: –†–∞–±–æ—á–∏–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–æ–≤
  - name: floor-plans
    description: –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–æ–∫
  - name: scenes
    description: 3D —Å—Ü–µ–Ω—ã –∏ —ç–ª–µ–º–µ–Ω—Ç—ã
  - name: branches
    description: –í–µ—Ç–∫–∏ –¥–∏–∑–∞–π–Ω–∞ (–≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ)
  - name: ai
    description: AI —Å–µ—Ä–≤–∏—Å—ã (—Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è, —á–∞—Ç)
  - name: compliance
    description: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –°–ù–∏–ü –∏ –ñ–ö –†–§
  - name: requests
    description: –ó–∞—è–≤–∫–∏ –Ω–∞ —É—Å–ª—É–≥–∏ —ç–∫—Å–ø–µ—Ä—Ç–æ–≤ –ë–¢–ò
  - name: notifications
    description: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

# =============================================================================
# Security Schemes
# =============================================================================
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT —Ç–æ–∫–µ–Ω. –ü–æ–ª—É—á–∏—Ç–µ —á–µ—Ä–µ–∑ `/auth/login` –∏–ª–∏ `/auth/register`. –§–æ—Ä–º–∞—Ç - `Bearer <token>`

  # ===========================================================================
  # Schemas
  # ===========================================================================
  schemas:
    # -------------------------------------------------------------------------
    # Error Responses
    # -------------------------------------------------------------------------
    Error:
      type: object
      properties:
        error:
          type: string
          description: –û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏
          example: unauthorized
        message:
          type: string
          description: –î–µ—Ç–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
          example: Invalid token
        request_id:
          type: string
          description: ID –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
          example: req-abc123

    ValidationError:
      type: object
      properties:
        error:
          type: string
          example: validation_error
        details:
          type: object
          additionalProperties:
            type: string
          example:
            email: "invalid email format"
            password: "minimum 8 characters"

    # -------------------------------------------------------------------------
    # Success Response
    # -------------------------------------------------------------------------
    SuccessResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: Operation completed successfully
        request_id:
          type: string

    # -------------------------------------------------------------------------
    # Pagination
    # -------------------------------------------------------------------------
    Pagination:
      type: object
      properties:
        total:
          type: integer
          example: 150
        page:
          type: integer
          example: 1
        page_size:
          type: integer
          example: 20
        total_pages:
          type: integer
          example: 8

    # -------------------------------------------------------------------------
    # Auth Schemas
    # -------------------------------------------------------------------------
    RegisterRequest:
      type: object
      required: [email, password, name]
      properties:
        email:
          type: string
          format: email
          example: user@example.com
        password:
          type: string
          format: password
          minLength: 8
          example: SecurePass123!
        name:
          type: string
          minLength: 2
          example: –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤

    LoginRequest:
      type: object
      required: [email, password]
      properties:
        email:
          type: string
          format: email
          example: user@example.com
        password:
          type: string
          format: password
          example: SecurePass123!

    AuthResponse:
      type: object
      properties:
        data:
          type: object
          properties:
            user_id:
              type: string
              format: uuid
            access_token:
              type: string
            refresh_token:
              type: string
            expires_in:
              type: integer
              description: –°–µ–∫—É–Ω–¥—ã –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è access_token
        message:
          type: string
        request_id:
          type: string

    RefreshRequest:
      type: object
      required: [refresh_token]
      properties:
        refresh_token:
          type: string

    LogoutRequest:
      type: object
      required: [refresh_token]
      properties:
        refresh_token:
          type: string

    # -------------------------------------------------------------------------
    # User Schemas
    # -------------------------------------------------------------------------
    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
          format: email
        name:
          type: string
        avatar_url:
          type: string
          format: uri
        phone:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    UpdateUserRequest:
      type: object
      properties:
        name:
          type: string
          minLength: 2
          maxLength: 255
        phone:
          type: string

    ChangePasswordRequest:
      type: object
      required: [current_password, new_password]
      properties:
        current_password:
          type: string
        new_password:
          type: string
          minLength: 8

    # -------------------------------------------------------------------------
    # Notification Schemas
    # -------------------------------------------------------------------------
    Notification:
      type: object
      properties:
        id:
          type: string
          format: uuid
        user_id:
          type: string
          format: uuid
        type:
          type: string
          enum: [info, warning, error, success, system]
        title:
          type: string
        message:
          type: string
        is_read:
          type: boolean
        metadata:
          type: object
        created_at:
          type: string
          format: date-time

    NotificationList:
      type: object
      properties:
        data:
          type: object
          properties:
            notifications:
              type: array
              items:
                $ref: "#/components/schemas/Notification"
            pagination:
              $ref: "#/components/schemas/Pagination"

    UnreadCount:
      type: object
      properties:
        data:
          type: object
          properties:
            count:
              type: integer

    # -------------------------------------------------------------------------
    # Workspace Schemas
    # -------------------------------------------------------------------------
    Workspace:
      type: object
      properties:
        id:
          type: string
          format: uuid
        owner_id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        member_count:
          type: integer
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateWorkspaceRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
          minLength: 2
          maxLength: 100
        description:
          type: string
          maxLength: 1000

    UpdateWorkspaceRequest:
      type: object
      properties:
        name:
          type: string
        description:
          type: string

    Member:
      type: object
      properties:
        id:
          type: string
          format: uuid
        user_id:
          type: string
          format: uuid
        workspace_id:
          type: string
          format: uuid
        role:
          type: string
          enum: [owner, admin, editor, viewer]
        joined_at:
          type: string
          format: date-time

    AddMemberRequest:
      type: object
      required: [user_id, role]
      properties:
        user_id:
          type: string
          format: uuid
        role:
          type: string
          enum: [admin, editor, viewer]

    # -------------------------------------------------------------------------
    # Floor Plan Schemas
    # -------------------------------------------------------------------------
    FloorPlan:
      type: object
      description: |
        –ü–ª–∞–Ω–∏—Ä–æ–≤–∫–∞ –∫–≤–∞—Ä—Ç–∏—Ä—ã.
        
        **–°—Ç–∞—Ç—É—Å—ã:**
        - `uploaded` - —Ñ–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω, —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –Ω–µ –∑–∞–ø—É—â–µ–Ω–æ
        - `processing` - –∏–¥—ë—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ
        - `recognized` - —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ, –ø–æ–ª–µ `model` –∑–∞–ø–æ–ª–Ω–µ–Ω–æ
        - `failed` - –æ—à–∏–±–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
      properties:
        id:
          type: string
          format: uuid
          description: |
            ID –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ (floor_plan_id).
            –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–æ–π.
        workspace_id:
          type: string
          format: uuid
          description: ID –≤–æ—Ä–∫—Å–ø–µ–π—Å–∞, –∫ –∫–æ—Ç–æ—Ä–æ–º—É –ø—Ä–∏–≤—è–∑–∞–Ω–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∞
        user_id:
          type: string
          format: uuid
          description: ID –≤–ª–∞–¥–µ–ª—å—Ü–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏
        name:
          type: string
        description:
          type: string
        address:
          type: string
        status:
          type: string
          enum: [uploaded, processing, recognized, failed]
          description: –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏
        image_url:
          type: string
          format: uri
          description: URL –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        thumbnail_url:
          type: string
          format: uri
          description: URL –ø—Ä–µ–≤—å—é
        scene_id:
          type: string
          format: uuid
          description: ID —Å–æ–∑–¥–∞–Ω–Ω–æ–π 3D —Å—Ü–µ–Ω—ã (–µ—Å–ª–∏ —Å–æ–∑–¥–∞–Ω–∞)
        recognition_result:
          $ref: "#/components/schemas/RecognitionResult"
          description: –ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
        model:
          $ref: "#/components/schemas/RecognitionModel"
          description: |
            –ü–æ–ª–Ω–∞—è 3D –º–æ–¥–µ–ª—å –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏.
            ‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –¢–û–õ–¨–ö–û –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è (status="recognized")
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    RecognitionResult:
      type: object
      properties:
        rooms_count:
          type: integer
        total_area:
          type: number
          format: float
        living_area:
          type: number
          format: float
        confidence:
          type: number
          format: float
        rooms:
          type: array
          items:
            $ref: "#/components/schemas/RecognizedRoom"

    RecognizedRoom:
      type: object
      properties:
        type:
          type: string
          enum:
            [
              living_room,
              bedroom,
              kitchen,
              bathroom,
              toilet,
              hallway,
              balcony,
              storage,
              other,
            ]
        name:
          type: string
        area:
          type: number
          format: float

    UpdateFloorPlanRequest:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        address:
          type: string

    RecognitionStatus:
      type: object
      description: |
        –°—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è.
        
        **–°—Ç–∞—Ç—É—Å—ã:**
        - `pending` - –≤ –æ—á–µ—Ä–µ–¥–∏
        - `processing` - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è (—Å–º–æ—Ç—Ä–∏—Ç–µ progress)
        - `completed` - –≥–æ—Ç–æ–≤–æ, –ø–æ–ª–µ `model` —Å–æ–¥–µ—Ä–∂–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        - `failed` - –æ—à–∏–±–∫–∞, —Å–º–æ—Ç—Ä–∏—Ç–µ –ø–æ–ª–µ `error`
      properties:
        data:
          type: object
          properties:
            job_id:
              type: string
              format: uuid
              description: ID –∑–∞–¥–∞—á–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
            status:
              type: string
              enum: [pending, processing, completed, failed]
              description: |
                –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å.
                –î–µ–ª–∞–π—Ç–µ polling –ø–æ–∫–∞ status != "completed" –∏ status != "failed"
            progress:
              type: integer
              description: –ü—Ä–æ–≥—Ä–µ—Å—Å 0-100%. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç % –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–∏ status="processing"
            model:
              $ref: "#/components/schemas/RecognitionModel"
              description: |
                –ü–æ–ª–Ω–∞—è 3D –º–æ–¥–µ–ª—å –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏.
                ‚ö†Ô∏è –î–æ—Å—Ç—É–ø–Ω–∞ –¢–û–õ–¨–ö–û –ø—Ä–∏ status="completed"
            error:
              type: string
              description: –û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏ (–ø—Ä–∏ status="failed")
    
    RecognitionModel:
      type: object
      description: –ü–æ–ª–Ω–∞—è 3D –º–æ–¥–µ–ª—å –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ –ø–æ—Å–ª–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
      properties:
        bounds:
          type: object
          description: –ì–∞–±–∞—Ä–∏—Ç—ã –∫–≤–∞—Ä—Ç–∏—Ä—ã –≤ –º–µ—Ç—Ä–∞—Ö
          properties:
            width:
              type: number
              description: –®–∏—Ä–∏–Ω–∞ –ø–æ X
            height:
              type: number
              description: –í—ã—Å–æ—Ç–∞ –ø–æ—Ç–æ–ª–∫–æ–≤
            depth:
              type: number
              description: –ì–ª—É–±–∏–Ω–∞ –ø–æ Z
        total_area:
          type: number
          description: –û–±—â–∞—è –ø–ª–æ—â–∞–¥—å –≤ –º¬≤
        confidence:
          type: number
          minimum: 0
          maximum: 1
          description: –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è (0-1)
        processing_time_ms:
          type: integer
          description: –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ –º—Å
        warnings:
          type: array
          items:
            type: string
          description: –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –ø—Ä–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–∏
        recognition:
          type: object
          description: –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
          properties:
            source_type:
              type: string
              enum: [BTI, technical_passport, architect_plan, sketch, photo]
            quality:
              type: string
              enum: [high, medium, low]
            scale:
              type: string
            orientation:
              type: integer
            has_dimensions:
              type: boolean
            has_annotations:
              type: boolean
            building_type:
              type: string
              enum: [panel, brick, monolith, block, frame, unknown]
        elements:
          $ref: "#/components/schemas/SceneElements"
    
    SceneElements:
      type: object
      description: –≠–ª–µ–º–µ–Ω—Ç—ã 3D —Å—Ü–µ–Ω—ã –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏
      properties:
        walls:
          type: array
          items:
            $ref: "#/components/schemas/Wall3D"
        rooms:
          type: array
          items:
            $ref: "#/components/schemas/Room3DModel"
        furniture:
          type: array
          items:
            $ref: "#/components/schemas/FurnitureModel"
        utilities:
          type: array
          items:
            $ref: "#/components/schemas/UtilityModel"
    
    Wall3D:
      type: object
      description: 3D —Å—Ç–µ–Ω–∞
      properties:
        id:
          type: string
        type:
          type: string
          example: wall
        name:
          type: string
        start:
          $ref: "#/components/schemas/Point3D"
        end:
          $ref: "#/components/schemas/Point3D"
        height:
          type: number
          description: –í—ã—Å–æ—Ç–∞ —Å—Ç–µ–Ω—ã –≤ –º–µ—Ç—Ä–∞—Ö
        thickness:
          type: number
          description: –¢–æ–ª—â–∏–Ω–∞ —Å—Ç–µ–Ω—ã –≤ –º–µ—Ç—Ä–∞—Ö (0.08-0.50)
        properties:
          type: object
          properties:
            is_load_bearing:
              type: boolean
              description: –Ø–≤–ª—è–µ—Ç—Å—è –ª–∏ –Ω–µ—Å—É—â–µ–π
            material:
              type: string
              enum: [brick, concrete, drywall, block, panel, foam_block, gas_block]
            can_demolish:
              type: boolean
            structural_type:
              type: string
              enum: [external, internal_bearing, partition]
        openings:
          type: array
          items:
            $ref: "#/components/schemas/Opening3D"
        metadata:
          $ref: "#/components/schemas/ElementMetadata"
    
    Point3D:
      type: object
      properties:
        x:
          type: number
        y:
          type: number
        z:
          type: number
    
    Point2DModel:
      type: object
      properties:
        x:
          type: number
        y:
          type: number
    
    Opening3D:
      type: object
      description: –ü—Ä–æ—ë–º (–¥–≤–µ—Ä—å/–æ–∫–Ω–æ) –≤ —Å—Ç–µ–Ω–µ
      properties:
        id:
          type: string
        type:
          type: string
          enum: [door, window, passage, arch]
        subtype:
          type: string
          enum: [single_swing, double_swing, sliding, entrance, balcony, panoramic]
        position:
          type: number
          description: –ü–æ–∑–∏—Ü–∏—è –æ—Ç –Ω–∞—á–∞–ª–∞ —Å—Ç–µ–Ω—ã –≤ –º–µ—Ç—Ä–∞—Ö
        width:
          type: number
        height:
          type: number
        elevation:
          type: number
          description: –í—ã—Å–æ—Ç–∞ –æ—Ç –ø–æ–ª–∞ (0 –¥–ª—è –¥–≤–µ—Ä–µ–π, 0.85 –¥–ª—è –æ–∫–æ–Ω)
        opens_to:
          type: string
          enum: [left, right, inward, outward]
        has_door:
          type: boolean
        connects_rooms:
          type: array
          items:
            type: string
          description: ID –∫–æ–º–Ω–∞—Ç, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–µ–¥–∏–Ω—è–µ—Ç –ø—Ä–æ—ë–º
    
    Room3DModel:
      type: object
      description: 3D –∫–æ–º–Ω–∞—Ç–∞
      properties:
        id:
          type: string
        type:
          type: string
          example: room
        name:
          type: string
          example: –ö—É—Ö–Ω—è
        room_type:
          type: string
          enum: [living, bedroom, kitchen, bathroom, toilet, combined_bathroom, hallway, corridor, storage, balcony, loggia, children, office, dining]
        polygon:
          type: array
          description: –ö–æ–Ω—Ç—É—Ä –∫–æ–º–Ω–∞—Ç—ã (–∑–∞–º–∫–Ω—É—Ç—ã–π –ø–æ–ª–∏–≥–æ–Ω)
          items:
            $ref: "#/components/schemas/Point2DModel"
        area:
          type: number
          description: –ü–ª–æ—â–∞–¥—å –≤ –º¬≤
        perimeter:
          type: number
          description: –ü–µ—Ä–∏–º–µ—Ç—Ä –≤ –º–µ—Ç—Ä–∞—Ö
        properties:
          type: object
          properties:
            has_wet_zone:
              type: boolean
            has_ventilation:
              type: boolean
            has_window:
              type: boolean
            min_allowed_area:
              type: number
              description: –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ø–ª–æ—â–∞–¥—å –ø–æ –°–ù–∏–ü
            ceiling_height:
              type: number
        wall_ids:
          type: array
          items:
            type: string
          description: ID —Å—Ç–µ–Ω, –æ–±—Ä–∞–∑—É—é—â–∏—Ö –∫–æ–º–Ω–∞—Ç—É
        metadata:
          type: object
          properties:
            confidence:
              type: number
            label_on_plan:
              type: string
              description: –ù–∞–¥–ø–∏—Å—å –Ω–∞ –ø–ª–∞–Ω–µ
            area_on_plan:
              type: number
              description: –ü–ª–æ—â–∞–¥—å —É–∫–∞–∑–∞–Ω–Ω–∞—è –Ω–∞ –ø–ª–∞–Ω–µ
    
    FurnitureModel:
      type: object
      description: –ú–µ–±–µ–ª—å –∏–ª–∏ —Å–∞–Ω—Ç–µ—Ö–Ω–∏–∫–∞
      properties:
        id:
          type: string
        type:
          type: string
          example: furniture
        name:
          type: string
        furniture_type:
          type: string
          enum: [sink, toilet, bathtub, shower, gas_stove, electric_stove, refrigerator, washing_machine, dishwasher, bed, sofa, table, wardrobe, desk]
        position:
          $ref: "#/components/schemas/Point3D"
        rotation:
          $ref: "#/components/schemas/Point3D"
        dimensions:
          type: object
          properties:
            width:
              type: number
            height:
              type: number
            depth:
              type: number
        room_id:
          type: string
        properties:
          type: object
          properties:
            can_relocate:
              type: boolean
            category:
              type: string
              enum: [bathroom, kitchen, living, bedroom]
            requires_water:
              type: boolean
            requires_gas:
              type: boolean
            requires_drain:
              type: boolean
    
    UtilityModel:
      type: object
      description: –ò–Ω–∂–µ–Ω–µ—Ä–Ω—ã–µ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ (—Å—Ç–æ—è–∫–∏, –≤–µ–Ω—Ç–∏–ª—è—Ü–∏—è)
      properties:
        id:
          type: string
        type:
          type: string
          example: utility
        name:
          type: string
        utility_type:
          type: string
          enum: [water_riser, sewer_riser, gas_riser, ventilation, electrical_panel]
        position:
          $ref: "#/components/schemas/Point3D"
        dimensions:
          type: object
          properties:
            diameter:
              type: number
              description: –î–∏–∞–º–µ—Ç—Ä (–¥–ª—è –∫—Ä—É–≥–ª—ã—Ö)
            width:
              type: number
            depth:
              type: number
        room_id:
          type: string
        properties:
          type: object
          properties:
            can_relocate:
              type: boolean
            protection_zone:
              type: number
              description: –ó–∞—â–∏—Ç–Ω–∞—è –∑–æ–Ω–∞ –≤ –º–µ—Ç—Ä–∞—Ö
            shared_with_neighbors:
              type: boolean
    
    ElementMetadata:
      type: object
      properties:
        confidence:
          type: number
          minimum: 0
          maximum: 1
        source:
          type: string
          enum: [recognition, manual, generated]
        locked:
          type: boolean
        visible:
          type: boolean

    # -------------------------------------------------------------------------
    # Scene Schemas
    # -------------------------------------------------------------------------
    Scene:
      type: object
      properties:
        id:
          type: string
          format: uuid
        workspace_id:
          type: string
          format: uuid
        floor_plan_id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        status:
          type: string
          enum: [draft, active, archived]
        element_count:
          type: integer
        branch_count:
          type: integer
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateSceneRequest:
      type: object
      description: |
        –°–æ–∑–¥–∞–Ω–∏–µ 3D —Å—Ü–µ–Ω—ã.
        
        **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è** –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å `floor_plan_id` —Å —É–∂–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω–æ–π –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–æ–π - 
        —Ç–æ–≥–¥–∞ —Å—Ü–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—Å—è –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ model.
      required: [name]
      properties:
        name:
          type: string
          description: –ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ü–µ–Ω—ã
        description:
          type: string
        floor_plan_id:
          type: string
          format: uuid
          description: |
            ID —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω–æ–π –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏.
            –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω - —Å—Ü–µ–Ω–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è —Å –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏.

    UpdateSceneRequest:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        status:
          type: string
          enum: [draft, active, archived]

    SceneComplianceResult:
      type: object
      properties:
        data:
          type: object
          properties:
            scene_id:
              type: string
              format: uuid
            status:
              type: string
              enum: [passed, warning, failed]
            violations:
              type: array
              items:
                $ref: "#/components/schemas/Violation"
            checked_at:
              type: string
              format: date-time

    # -------------------------------------------------------------------------
    # Branch Schemas
    # -------------------------------------------------------------------------
    Branch:
      type: object
      properties:
        id:
          type: string
          format: uuid
        scene_id:
          type: string
          format: uuid
        parent_branch_id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        status:
          type: string
          enum: [active, archived, merged]
        is_main:
          type: boolean
        created_by:
          type: string
          format: uuid
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateBranchRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
          minLength: 2
        description:
          type: string
        parent_branch_id:
          type: string
          format: uuid

    UpdateBranchRequest:
      type: object
      properties:
        name:
          type: string
        description:
          type: string

    BranchComparison:
      type: object
      properties:
        data:
          type: object
          properties:
            source_branch:
              $ref: "#/components/schemas/Branch"
            target_branch:
              $ref: "#/components/schemas/Branch"
            differences:
              type: array
              items:
                type: object
                properties:
                  element_id:
                    type: string
                  change_type:
                    type: string
                    enum: [added, removed, modified]
                  description:
                    type: string

    MergeBranchRequest:
      type: object
      required: [target_branch_id]
      properties:
        target_branch_id:
          type: string
          format: uuid
        strategy:
          type: string
          enum: [overwrite, merge]
          default: merge

    # -------------------------------------------------------------------------
    # Compliance Schemas
    # -------------------------------------------------------------------------
    ComplianceCheckRequest:
      type: object
      required: [scene_id]
      properties:
        scene_id:
          type: string
          format: uuid
        branch_id:
          type: string
          format: uuid
        categories:
          type: array
          items:
            type: string

    ComplianceCheckResponse:
      type: object
      properties:
        data:
          type: object
          properties:
            check_id:
              type: string
              format: uuid
            scene_id:
              type: string
              format: uuid
            status:
              type: string
              enum: [passed, warning, failed]
            score:
              type: integer
              description: 0-100
            violation_count:
              type: integer
            warning_count:
              type: integer
            violations:
              type: array
              items:
                $ref: "#/components/schemas/Violation"
            checked_at:
              type: string
              format: date-time

    CheckOperationRequest:
      type: object
      required: [scene_id, operation]
      properties:
        scene_id:
          type: string
          format: uuid
        branch_id:
          type: string
          format: uuid
        operation:
          type: object
          properties:
            type:
              type: string
              enum:
                [
                  add_wall,
                  remove_wall,
                  move_wall,
                  add_room,
                  remove_room,
                  merge_rooms,
                ]
            element_id:
              type: string
              format: uuid
            parameters:
              type: object

    Violation:
      type: object
      properties:
        id:
          type: string
          format: uuid
        rule_id:
          type: string
        rule_name:
          type: string
        category:
          type: string
        severity:
          type: string
          enum: [error, warning, info]
        description:
          type: string
        recommendations:
          type: array
          items:
            type: string
        legal_reference:
          type: string

    ComplianceRule:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        category:
          type: string
        description:
          type: string
        severity:
          type: string
          enum: [error, warning, info]
        legal_reference:
          type: string
        is_active:
          type: boolean

    GenerateReportRequest:
      type: object
      required: [scene_id]
      properties:
        scene_id:
          type: string
          format: uuid
        branch_id:
          type: string
          format: uuid
        format:
          type: string
          enum: [pdf, html, json]
          default: pdf
        include_recommendations:
          type: boolean
          default: true

    # -------------------------------------------------------------------------
    # Request (Expert) Schemas
    # -------------------------------------------------------------------------
    ExpertRequest:
      type: object
      properties:
        id:
          type: string
          format: uuid
        workspace_id:
          type: string
          format: uuid
        user_id:
          type: string
          format: uuid
        title:
          type: string
        description:
          type: string
        category:
          type: string
          enum: [consultation, documentation, expert_visit, full_package]
        priority:
          type: string
          enum: [low, normal, high, urgent]
        status:
          type: string
          enum:
            [
              draft,
              pending,
              in_review,
              approved,
              rejected,
              assigned,
              in_progress,
              completed,
              cancelled,
            ]
        expert_id:
          type: string
          format: uuid
        estimated_cost:
          type: integer
        final_cost:
          type: integer
        contact_phone:
          type: string
        contact_email:
          type: string
          format: email
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateExpertRequestRequest:
      type: object
      required: [workspace_id, title, description, category]
      properties:
        workspace_id:
          type: string
          format: uuid
        title:
          type: string
          minLength: 5
          maxLength: 200
        description:
          type: string
          minLength: 10
        category:
          type: string
          enum: [consultation, documentation, expert_visit, full_package]
        priority:
          type: string
          enum: [low, normal, high, urgent]
          default: normal
        contact_phone:
          type: string
        contact_email:
          type: string
          format: email

    UpdateExpertRequestRequest:
      type: object
      properties:
        title:
          type: string
        description:
          type: string
        priority:
          type: string
          enum: [low, normal, high, urgent]
        contact_phone:
          type: string
        contact_email:
          type: string
          format: email

    RequestDocument:
      type: object
      properties:
        id:
          type: string
          format: uuid
        request_id:
          type: string
          format: uuid
        name:
          type: string
        type:
          type: string
        url:
          type: string
          format: uri
        uploaded_at:
          type: string
          format: date-time

    # -------------------------------------------------------------------------
    # AI Schemas
    # -------------------------------------------------------------------------
    RecognizeRequest:
      type: object
      required: [floor_plan_id]
      properties:
        floor_plan_id:
          type: string
          format: uuid
          description: |
            ID –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è.
            –ü–æ–ª—É—á–∞–µ—Ç–µ –∏–∑ POST /floor-plans ‚Üí response.data.id
        image_base64:
          type: string
          description: |
            Base64-encoded –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ floor_plan_id).
            –§–æ—Ä–º–∞—Ç: data:image/jpeg;base64,/9j/4AAQ...
        image_type:
          type: string
          description: MIME-—Ç–∏–ø –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (image/jpeg, image/png)
          example: image/jpeg
        options:
          type: object
          properties:
            detect_load_bearing:
              type: boolean
              default: true
              description: –û–ø—Ä–µ–¥–µ–ª—è—Ç—å –Ω–µ—Å—É—â–∏–µ —Å—Ç–µ–Ω—ã
            detect_wet_zones:
              type: boolean
              default: true
              description: –û–ø—Ä–µ–¥–µ–ª—è—Ç—å –º–æ–∫—Ä—ã–µ –∑–æ–Ω—ã
            detect_furniture:
              type: boolean
              default: true
              description: –û–ø—Ä–µ–¥–µ–ª—è—Ç—å –º–µ–±–µ–ª—å –∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ
            detail_level:
              type: integer
              minimum: 1
              maximum: 3
              default: 2
              description: –£—Ä–æ–≤–µ–Ω—å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ (1-3)

    RecognizeResponse:
      type: object
      description: |
        –û—Ç–≤–µ—Ç –Ω–∞ –∑–∞–ø—É—Å–∫ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è.
        
        ‚ö†Ô∏è **–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ job_id** - –æ–Ω –Ω—É–∂–µ–Ω –¥–ª—è polling —Å—Ç–∞—Ç—É—Å–∞!
      properties:
        data:
          type: object
          properties:
            job_id:
              type: string
              format: uuid
              description: |
                ID –∑–∞–¥–∞—á–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è.
                –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è GET /ai/recognize/{job_id}/status
            status:
              type: string
              enum: [pending, processing, completed, failed]
              description: –ù–∞—á–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å (–æ–±—ã—á–Ω–æ "pending" –∏–ª–∏ "processing")
            success:
              type: boolean

    AIRecognitionResult:
      type: object
      description: –ü–æ–ª–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –¥–ª—è 3D –º–æ–¥–µ–ª–∏
      properties:
        bounds:
          type: object
          description: –ì–∞–±–∞—Ä–∏—Ç—ã –∫–≤–∞—Ä—Ç–∏—Ä—ã –≤ –º–µ—Ç—Ä–∞—Ö
          properties:
            width:
              type: number
              description: –®–∏—Ä–∏–Ω–∞ –ø–æ X
            height:
              type: number
              description: –í—ã—Å–æ—Ç–∞ –ø–æ—Ç–æ–ª–∫–æ–≤
            depth:
              type: number
              description: –ì–ª—É–±–∏–Ω–∞ –ø–æ Z
        total_area:
          type: number
          description: –û–±—â–∞—è –ø–ª–æ—â–∞–¥—å –≤ –º¬≤
        stats:
          type: object
          properties:
            totalArea:
              type: number
            roomsCount:
              type: integer
            wallsCount:
              type: integer
            furnitureCount:
              type: integer
        walls:
          type: array
          items:
            $ref: "#/components/schemas/RecognizedWall3D"
        rooms:
          type: array
          items:
            $ref: "#/components/schemas/RecognizedRoom3D"
        openings:
          type: array
          items:
            $ref: "#/components/schemas/RecognizedOpening"
        recognition:
          type: object
          properties:
            sourceType:
              type: string
              enum: [BTI, technical_passport, architect_plan, sketch, photo]
            quality:
              type: string
              enum: [high, medium, low]
            scale:
              type: string
            buildingType:
              type: string
              enum: [panel, brick, monolith, block, frame, unknown]

    RecognizedWall3D:
      type: object
      properties:
        temp_id:
          type: string
        start:
          type: object
          properties:
            x:
              type: number
            y:
              type: number
        end:
          type: object
          properties:
            x:
              type: number
            y:
              type: number
        thickness:
          type: number
          description: –¢–æ–ª—â–∏–Ω–∞ –≤ –º–µ—Ç—Ä–∞—Ö (0.08-0.50)
        is_load_bearing:
          type: boolean
          description: –ù–µ—Å—É—â–∞—è —Å—Ç–µ–Ω–∞
        material:
          type: string
          enum: [brick, concrete, drywall, block, panel, foam_block, gas_block]
        can_demolish:
          type: boolean
        confidence:
          type: number
          minimum: 0
          maximum: 1

    RecognizedRoom3D:
      type: object
      properties:
        temp_id:
          type: string
        type:
          type: string
          enum: [living, bedroom, kitchen, bathroom, toilet, combined_bathroom, hallway, corridor, storage, balcony, loggia, children, office, dining]
        name:
          type: string
        polygon:
          type: array
          items:
            type: object
            properties:
              x:
                type: number
              y:
                type: number
        area:
          type: number
        perimeter:
          type: number
        is_wet_zone:
          type: boolean
        has_window:
          type: boolean
        wall_ids:
          type: array
          items:
            type: string
        confidence:
          type: number

    RecognizedOpening:
      type: object
      properties:
        temp_id:
          type: string
        type:
          type: string
          enum: [door, window, passage, arch]
        subtype:
          type: string
          enum: [single_swing, double_swing, sliding, entrance, balcony, panoramic]
        wall_id:
          type: string
        position:
          type: number
          description: –ü–æ–∑–∏—Ü–∏—è –æ—Ç –Ω–∞—á–∞–ª–∞ —Å—Ç–µ–Ω—ã –≤ –º–µ—Ç—Ä–∞—Ö
        width:
          type: number
        height:
          type: number
        elevation:
          type: number
          description: –í—ã—Å–æ—Ç–∞ –æ—Ç –ø–æ–ª–∞ (0 –¥–ª—è –¥–≤–µ—Ä–µ–π, 0.85 –¥–ª—è –æ–∫–æ–Ω)
        confidence:
          type: number

    GenerateVariantsRequest:
      type: object
      required: [scene_id, count]
      properties:
        scene_id:
          type: string
          format: uuid
        branch_id:
          type: string
          format: uuid
        count:
          type: integer
          minimum: 1
          maximum: 5
        style:
          type: string
          enum: [modern, classic, minimalist, scandinavian, loft]
        priorities:
          type: array
          items:
            type: string
        constraints:
          type: object

    GenerateResponse:
      type: object
      properties:
        data:
          type: object
          properties:
            job_id:
              type: string
              format: uuid
            status:
              type: string
              enum: [queued, processing]

    GenerationStatus:
      type: object
      properties:
        data:
          type: object
          properties:
            job_id:
              type: string
              format: uuid
            status:
              type: string
              enum: [queued, processing, completed, failed]
            progress:
              type: integer
            variants:
              type: array
              items:
                $ref: "#/components/schemas/GeneratedVariant"
            error:
              type: string

    GeneratedVariant:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        branch_id:
          type: string
          format: uuid
        quality_score:
          type: integer
        preview_url:
          type: string
          format: uri

    ChatMessageRequest:
      type: object
      required: [message]
      properties:
        session_id:
          type: string
          format: uuid
        message:
          type: string
          minLength: 1
          maxLength: 4000
        scene_id:
          type: string
          format: uuid

    ChatMessageResponse:
      type: object
      properties:
        data:
          type: object
          properties:
            session_id:
              type: string
              format: uuid
            message_id:
              type: string
              format: uuid
            response:
              type: string
            suggestions:
              type: array
              items:
                type: object
                properties:
                  type:
                    type: string
                  title:
                    type: string
                  description:
                    type: string

    ChatHistory:
      type: object
      properties:
        data:
          type: object
          properties:
            session_id:
              type: string
              format: uuid
            messages:
              type: array
              items:
                type: object
                properties:
                  id:
                    type: string
                    format: uuid
                  role:
                    type: string
                    enum: [user, assistant]
                  content:
                    type: string
                  created_at:
                    type: string
                    format: date-time

# =============================================================================
# Paths
# =============================================================================
paths:
  # ---------------------------------------------------------------------------
  # Auth Endpoints
  # ---------------------------------------------------------------------------
  /auth/register:
    post:
      tags: [auth]
      summary: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      description: –°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é —É—á–µ—Ç–Ω—É—é –∑–∞–ø–∏—Å—å –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–∫–µ–Ω—ã
      operationId: register
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RegisterRequest"
      responses:
        "201":
          description: –£—Å–ø–µ—à–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthResponse"
        "400":
          description: –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ValidationError"
        "409":
          description: Email —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω

  /auth/login:
    post:
      tags: [auth]
      summary: –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
      operationId: login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginRequest"
      responses:
        "200":
          description: –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthResponse"
        "401":
          description: –ù–µ–≤–µ—Ä–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

  /auth/refresh:
    post:
      tags: [auth]
      summary: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
      operationId: refreshTokens
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RefreshRequest"
      responses:
        "200":
          description: –¢–æ–∫–µ–Ω—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthResponse"
        "401":
          description: –ù–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π refresh token

  /auth/logout:
    post:
      tags: [auth]
      summary: –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
      operationId: logout
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LogoutRequest"
      responses:
        "200":
          description: –£—Å–ø–µ—à–Ω—ã–π –≤—ã—Ö–æ–¥
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"

  /auth/logout-all:
    post:
      tags: [auth]
      summary: –í—ã—Ö–æ–¥ —Å–æ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
      description: –ò–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –≤—Å–µ refresh —Ç–æ–∫–µ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      operationId: logoutAll
      security:
        - BearerAuth: []
      responses:
        "200":
          description: –í—ã—Ö–æ–¥ —Å–æ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"

  # ---------------------------------------------------------------------------
  # User Endpoints
  # ---------------------------------------------------------------------------
  /users/me:
    get:
      tags: [users]
      summary: –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
      operationId: getProfile
      security:
        - BearerAuth: []
      responses:
        "200":
          description: –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/User"
        "401":
          description: –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω

    patch:
      tags: [users]
      summary: –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
      operationId: updateProfile
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateUserRequest"
      responses:
        "200":
          description: –ü—Ä–æ—Ñ–∏–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/User"

    delete:
      tags: [users]
      summary: –£–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç
      description: –ü–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª—è–µ—Ç —É—á–µ—Ç–Ω—É—é –∑–∞–ø–∏—Å—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      operationId: deleteAccount
      security:
        - BearerAuth: []
      responses:
        "200":
          description: –ê–∫–∫–∞—É–Ω—Ç —É–¥–∞–ª–µ–Ω
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"

  /users/me/password:
    put:
      tags: [users]
      summary: –°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å
      operationId: changePassword
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ChangePasswordRequest"
      responses:
        "200":
          description: –ü–∞—Ä–æ–ª—å –∏–∑–º–µ–Ω–µ–Ω
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
        "400":
          description: –ù–µ–≤–µ—Ä–Ω—ã–π —Ç–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å

  # ---------------------------------------------------------------------------
  # Notification Endpoints
  # ---------------------------------------------------------------------------
  /notifications:
    get:
      tags: [notifications]
      summary: –°–ø–∏—Å–æ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
      operationId: getNotifications
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: page_size
          in: query
          schema:
            type: integer
            default: 20
        - name: is_read
          in: query
          description: –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É –ø—Ä–æ—á—Ç–µ–Ω–∏—è
          schema:
            type: boolean
      responses:
        "200":
          description: –°–ø–∏—Å–æ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NotificationList"

    delete:
      tags: [notifications]
      summary: –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
      operationId: deleteAllReadNotifications
      security:
        - BearerAuth: []
      responses:
        "200":
          description: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω—ã
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"

  /notifications/count:
    get:
      tags: [notifications]
      summary: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö
      operationId: getUnreadCount
      security:
        - BearerAuth: []
      responses:
        "200":
          description: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UnreadCount"

  /notifications/{id}/read:
    post:
      tags: [notifications]
      summary: –û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ
      operationId: markAsRead
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: ID —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (notification_id)
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –û—Ç–º–µ—á–µ–Ω–æ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"

  /notifications/read-all:
    post:
      tags: [notifications]
      summary: –û—Ç–º–µ—Ç–∏—Ç—å –≤—Å–µ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ
      operationId: markAllAsRead
      security:
        - BearerAuth: []
      responses:
        "200":
          description: –í—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–º–µ—á–µ–Ω—ã –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"

  /notifications/{id}:
    delete:
      tags: [notifications]
      summary: –£–¥–∞–ª–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
      operationId: deleteNotification
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"

  # ---------------------------------------------------------------------------
  # Workspace Endpoints
  # ---------------------------------------------------------------------------
  /workspaces:
    get:
      tags: [workspaces]
      summary: –°–ø–∏—Å–æ–∫ –≤–æ—Ä–∫—Å–ø–µ–π—Å–æ–≤
      operationId: listWorkspaces
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: page_size
          in: query
          schema:
            type: integer
            default: 20
        - name: name
          in: query
          description: –§–∏–ª—å—Ç—Ä –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
          schema:
            type: string
      responses:
        "200":
          description: –°–ø–∏—Å–æ–∫ –≤–æ—Ä–∫—Å–ø–µ–π—Å–æ–≤
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      workspaces:
                        type: array
                        items:
                          $ref: "#/components/schemas/Workspace"
                      pagination:
                        $ref: "#/components/schemas/Pagination"

    post:
      tags: [workspaces]
      summary: –°–æ–∑–¥–∞—Ç—å –≤–æ—Ä–∫—Å–ø–µ–π—Å
      operationId: createWorkspace
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateWorkspaceRequest"
      responses:
        "201":
          description: –í–æ—Ä–∫—Å–ø–µ–π—Å —Å–æ–∑–¥–∞–Ω
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Workspace"

  /workspaces/{id}:
    get:
      tags: [workspaces]
      summary: –ü–æ–ª—É—á–∏—Ç—å –≤–æ—Ä–∫—Å–ø–µ–π—Å
      operationId: getWorkspace
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: ID –≤–æ—Ä–∫—Å–ø–µ–π—Å–∞ (workspace_id). –ü–æ–ª—É—á–∞–µ—Ç–µ –∏–∑ POST /workspaces –∏–ª–∏ GET /workspaces
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –î–∞–Ω–Ω—ã–µ –≤–æ—Ä–∫—Å–ø–µ–π—Å–∞
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Workspace"
        "404":
          description: –ù–µ –Ω–∞–π–¥–µ–Ω

    patch:
      tags: [workspaces]
      summary: –û–±–Ω–æ–≤–∏—Ç—å –≤–æ—Ä–∫—Å–ø–µ–π—Å
      operationId: updateWorkspace
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateWorkspaceRequest"
      responses:
        "200":
          description: –í–æ—Ä–∫—Å–ø–µ–π—Å –æ–±–Ω–æ–≤–ª–µ–Ω
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Workspace"

    delete:
      tags: [workspaces]
      summary: –£–¥–∞–ª–∏—Ç—å –≤–æ—Ä–∫—Å–ø–µ–π—Å
      operationId: deleteWorkspace
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –í–æ—Ä–∫—Å–ø–µ–π—Å —É–¥–∞–ª–µ–Ω
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"

  /workspaces/{id}/members:
    get:
      tags: [workspaces]
      summary: –°–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≤–æ—Ä–∫—Å–ø–µ–π—Å–∞
      operationId: getWorkspaceMembers
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –°–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      members:
                        type: array
                        items:
                          $ref: "#/components/schemas/Member"

    post:
      tags: [workspaces]
      summary: –î–æ–±–∞–≤–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞
      operationId: addWorkspaceMember
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AddMemberRequest"
      responses:
        "201":
          description: –£—á–∞—Å—Ç–Ω–∏–∫ –¥–æ–±–∞–≤–ª–µ–Ω
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Member"

  /workspaces/{id}/members/{memberId}:
    delete:
      tags: [workspaces]
      summary: –£–¥–∞–ª–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞
      operationId: removeWorkspaceMember
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: memberId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –£—á–∞—Å—Ç–Ω–∏–∫ —É–¥–∞–ª–µ–Ω
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"

  /workspaces/{workspace_id}/scenes:
    get:
      tags: [workspaces, scenes]
      summary: –°–ø–∏—Å–æ–∫ —Å—Ü–µ–Ω –≤–æ—Ä–∫—Å–ø–µ–π—Å–∞
      operationId: listWorkspaceScenes
      security:
        - BearerAuth: []
      parameters:
        - name: workspace_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: page_size
          in: query
          schema:
            type: integer
            default: 20
      responses:
        "200":
          description: –°–ø–∏—Å–æ–∫ —Å—Ü–µ–Ω
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      scenes:
                        type: array
                        items:
                          $ref: "#/components/schemas/Scene"
                      pagination:
                        $ref: "#/components/schemas/Pagination"

    post:
      tags: [workspaces, scenes]
      summary: –°–æ–∑–¥–∞—Ç—å —Å—Ü–µ–Ω—É –≤ –≤–æ—Ä–∫—Å–ø–µ–π—Å–µ
      operationId: createWorkspaceScene
      security:
        - BearerAuth: []
      parameters:
        - name: workspace_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateSceneRequest"
      responses:
        "201":
          description: –°—Ü–µ–Ω–∞ —Å–æ–∑–¥–∞–Ω–∞
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Scene"

  # ---------------------------------------------------------------------------
  # Scene Endpoints
  # ---------------------------------------------------------------------------
  /scenes/{id}:
    get:
      tags: [scenes]
      summary: –ü–æ–ª—É—á–∏—Ç—å —Å—Ü–µ–Ω—É
      description: |
        –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ 3D —Å—Ü–µ–Ω—ã –¥–ª—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞.
        
        –°—Ü–µ–Ω–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è –∏–∑ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ —á–µ—Ä–µ–∑ POST /workspaces/{workspace_id}/scenes
      operationId: getScene
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: ID —Å—Ü–µ–Ω—ã (scene_id). –ü–æ–ª—É—á–∞–µ—Ç–µ –∏–∑ POST /workspaces/{workspace_id}/scenes
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –î–∞–Ω–Ω—ã–µ —Å—Ü–µ–Ω—ã
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Scene"

    patch:
      tags: [scenes]
      summary: –û–±–Ω–æ–≤–∏—Ç—å —Å—Ü–µ–Ω—É
      operationId: updateScene
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateSceneRequest"
      responses:
        "200":
          description: –°—Ü–µ–Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Scene"

    delete:
      tags: [scenes]
      summary: –£–¥–∞–ª–∏—Ç—å —Å—Ü–µ–Ω—É
      operationId: deleteScene
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –°—Ü–µ–Ω–∞ —É–¥–∞–ª–µ–Ω–∞
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"

  /scenes/{id}/compliance:
    get:
      tags: [scenes, compliance]
      summary: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ü–µ–Ω—É –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –Ω–æ—Ä–º–∞–º
      operationId: checkSceneCompliance
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SceneComplianceResult"

  # ---------------------------------------------------------------------------
  # Floor Plan Endpoints
  # ---------------------------------------------------------------------------
  /floor-plans:
    get:
      tags: [floor-plans]
      summary: –°–ø–∏—Å–æ–∫ –ø–ª–∞–Ω–∏—Ä–æ–≤–æ–∫
      operationId: listFloorPlans
      security:
        - BearerAuth: []
      parameters:
        - name: workspace_id
          in: query
          schema:
            type: string
            format: uuid
        - name: status
          in: query
          schema:
            type: string
            enum: [uploaded, processing, recognized, failed]
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: page_size
          in: query
          schema:
            type: integer
            default: 20
      responses:
        "200":
          description: –°–ø–∏—Å–æ–∫ –ø–ª–∞–Ω–∏—Ä–æ–≤–æ–∫
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      floor_plans:
                        type: array
                        items:
                          $ref: "#/components/schemas/FloorPlan"
                      pagination:
                        $ref: "#/components/schemas/Pagination"

    post:
      tags: [floor-plans]
      summary: –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤–∫—É
      description: |
        –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏.
        
        **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:** JPEG, PNG, WebP
        **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä:** 10 MB
        
        **–ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏:**
        1. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ `id` –∏–∑ –æ—Ç–≤–µ—Ç–∞ (—ç—Ç–æ floor_plan_id)
        2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ: POST /ai/recognize —Å —ç—Ç–∏–º floor_plan_id
      operationId: uploadFloorPlan
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [workspace_id, name, file]
              properties:
                workspace_id:
                  type: string
                  format: uuid
                  description: ID –≤–æ—Ä–∫—Å–ø–µ–π—Å–∞, –∫—É–¥–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∞
                name:
                  type: string
                  description: –ù–∞–∑–≤–∞–Ω–∏–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏
                description:
                  type: string
                address:
                  type: string
                  description: –ê–¥—Ä–µ—Å –∫–≤–∞—Ä—Ç–∏—Ä—ã
                file:
                  type: string
                  format: binary
                  description: –§–∞–π–ª –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (JPEG, PNG, WebP)
      responses:
        "201":
          description: |
            –ü–ª–∞–Ω–∏—Ä–æ–≤–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞.
            
            ‚ö†Ô∏è **–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ `data.id`** - —ç—Ç–æ floor_plan_id –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π!
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/FloorPlan"

  /floor-plans/{id}:
    get:
      tags: [floor-plans]
      summary: –ü–æ–ª—É—á–∏—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤–∫—É —Å –º–æ–¥–µ–ª—å—é
      description: |
        –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–µ.
        
        **–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è** –≤ –æ—Ç–≤–µ—Ç–µ –±—É–¥–µ—Ç –ø–æ–ª–µ `model` —Å –ø–æ–ª–Ω–æ–π 3D –º–æ–¥–µ–ª—å—é –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏,
        –≤–∫–ª—é—á–∞—é—â–µ–π —Å—Ç–µ–Ω—ã, –∫–æ–º–Ω–∞—Ç—ã, –ø—Ä–æ—ë–º—ã, –º–µ–±–µ–ª—å –∏ –∏–Ω–∂–µ–Ω–µ—Ä–Ω—ã–µ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏.
        
        –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è 3D —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –≤ –æ–¥–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ.
        
        ‚ö†Ô∏è –ï—Å–ª–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –µ—â—ë –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ, –ø–æ–ª–µ `model` –±—É–¥–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å.
      operationId: getFloorPlan
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: ID –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ (floor_plan_id). –ü–æ–ª—É—á–∞–µ—Ç–µ –∏–∑ POST /floor-plans
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –î–∞–Ω–Ω—ã–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ —Å –º–æ–¥–µ–ª—å—é (–µ—Å–ª–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–∞)
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/FloorPlan"

    patch:
      tags: [floor-plans]
      summary: –û–±–Ω–æ–≤–∏—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤–∫—É
      operationId: updateFloorPlan
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateFloorPlanRequest"
      responses:
        "200":
          description: –ü–ª–∞–Ω–∏—Ä–æ–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/FloorPlan"

    delete:
      tags: [floor-plans]
      summary: –£–¥–∞–ª–∏—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤–∫—É
      operationId: deleteFloorPlan
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –ü–ª–∞–Ω–∏—Ä–æ–≤–∫–∞ —É–¥–∞–ª–µ–Ω–∞
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"

  /floor-plans/{id}/recognize:
    post:
      tags: [floor-plans, ai]
      summary: –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏
      description: |
        –ó–∞–ø—É—Å–∫–∞–µ—Ç AI —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–π –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏.
        
        **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞:** POST /ai/recognize - –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞–ø—Ä—è–º—É—é.
        
        –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ polling:
        - GET /ai/recognize/{job_id}/status - –ø–æ job_id –∏–∑ –æ—Ç–≤–µ—Ç–∞
        - GET /floor-plans/{id}/recognition-status - –ø–æ floor_plan_id
      operationId: startFloorPlanRecognition
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: ID –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ (floor_plan_id)
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                create_scene:
                  type: boolean
                  default: true
                detect_furniture:
                  type: boolean
                  default: false
      responses:
        "202":
          description: –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      job_id:
                        type: string
                        format: uuid
                      status:
                        type: string
                        example: processing

  /floor-plans/{id}/recognition-status:
    get:
      tags: [floor-plans, ai]
      summary: –°—Ç–∞—Ç—É—Å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Å –º–æ–¥–µ–ª—å—é
      description: |
        –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏ AI —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏.
        
        ‚ö†Ô∏è **–í–ê–ñ–ù–û:** –í URL –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è ID –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ (floor_plan_id), –ù–ï job_id!
        
        **–ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è** (status=completed) –≤ –æ—Ç–≤–µ—Ç–µ –±—É–¥–µ—Ç –ø–æ–ª–µ `model` 
        —Å –ø–æ–ª–Ω–æ–π 3D –º–æ–¥–µ–ª—å—é –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏.
        
        –ú–æ–¥–µ–ª—å –≤–∫–ª—é—á–∞–µ—Ç:
        - **bounds** - –≥–∞–±–∞—Ä–∏—Ç—ã –∫–≤–∞—Ä—Ç–∏—Ä—ã
        - **elements.walls** - —Å—Ç–µ–Ω—ã —Å –ø—Ä–æ—ë–º–∞–º–∏
        - **elements.rooms** - –∫–æ–º–Ω–∞—Ç—ã —Å –ø–æ–ª–∏–≥–æ–Ω–∞–º–∏
        - **elements.furniture** - –º–µ–±–µ–ª—å –∏ —Å–∞–Ω—Ç–µ—Ö–Ω–∏–∫–∞
        - **elements.utilities** - —Å—Ç–æ—è–∫–∏ –∏ –≤–µ–Ω—Ç–∏–ª—è—Ü–∏—è
        
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç 404 –µ—Å–ª–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –Ω–µ –±—ã–ª–æ –∑–∞–ø—É—â–µ–Ω–æ –¥–ª—è –¥–∞–Ω–Ω–æ–π –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏.
      operationId: getFloorPlanRecognitionStatus
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: ID –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ (floor_plan_id), –ù–ï job_id –∑–∞–¥–∞—á–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –°—Ç–∞—Ç—É—Å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Å –º–æ–¥–µ–ª—å—é
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RecognitionStatus"

  /floor-plans/{id}/download-url:
    get:
      tags: [floor-plans]
      summary: –ü–æ–ª—É—á–∏—Ç—å URL –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
      operationId: getFloorPlanDownloadURL
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: URL –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      url:
                        type: string
                        format: uri
                      expires_at:
                        type: string
                        format: date-time

  # ---------------------------------------------------------------------------
  # Branch Endpoints
  # ---------------------------------------------------------------------------
  /scenes/{scene_id}/branches:
    get:
      tags: [branches]
      summary: –°–ø–∏—Å–æ–∫ –≤–µ—Ç–æ–∫ —Å—Ü–µ–Ω—ã
      description: |
        –í–µ—Ç–∫–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–π —Å—Ü–µ–Ω—ã.
        
        **–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
        1. –°–æ–∑–¥–∞—ë—Ç–µ —Å—Ü–µ–Ω—É –∏–∑ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏
        2. –°–æ–∑–¥–∞—ë—Ç–µ –≤–µ—Ç–∫—É "–í–∞—Ä–∏–∞–Ω—Ç 1"
        3. –°–æ–∑–¥–∞—ë—Ç–µ –≤–µ—Ç–∫—É "–í–∞—Ä–∏–∞–Ω—Ç 2"
        4. –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç–µ –≤–µ—Ç–∫–∏ —á–µ—Ä–µ–∑ /compare
        5. –ú–µ—Ä–¥–∂–∏—Ç–µ –ª—É—á—à–∏–π –≤–∞—Ä–∏–∞–Ω—Ç –≤ main
      operationId: listBranches
      security:
        - BearerAuth: []
      parameters:
        - name: scene_id
          in: path
          required: true
          description: ID —Å—Ü–µ–Ω—ã
          schema:
            type: string
            format: uuid
        - name: status
          in: query
          schema:
            type: string
            enum: [active, archived, merged]
      responses:
        "200":
          description: –°–ø–∏—Å–æ–∫ –≤–µ—Ç–æ–∫
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      branches:
                        type: array
                        items:
                          $ref: "#/components/schemas/Branch"

    post:
      tags: [branches]
      summary: –°–æ–∑–¥–∞—Ç—å –≤–µ—Ç–∫—É
      operationId: createBranch
      security:
        - BearerAuth: []
      parameters:
        - name: scene_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateBranchRequest"
      responses:
        "201":
          description: –í–µ—Ç–∫–∞ —Å–æ–∑–¥–∞–Ω–∞
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Branch"

  /scenes/{scene_id}/branches/{id}:
    get:
      tags: [branches]
      summary: –ü–æ–ª—É—á–∏—Ç—å –≤–µ—Ç–∫—É
      operationId: getBranch
      security:
        - BearerAuth: []
      parameters:
        - name: scene_id
          in: path
          required: true
          description: ID —Å—Ü–µ–Ω—ã
          schema:
            type: string
            format: uuid
        - name: id
          in: path
          required: true
          description: ID –≤–µ—Ç–∫–∏ (branch_id)
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –î–∞–Ω–Ω—ã–µ –≤–µ—Ç–∫–∏
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Branch"

    patch:
      tags: [branches]
      summary: –û–±–Ω–æ–≤–∏—Ç—å –≤–µ—Ç–∫—É
      operationId: updateBranch
      security:
        - BearerAuth: []
      parameters:
        - name: scene_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateBranchRequest"
      responses:
        "200":
          description: –í–µ—Ç–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Branch"

    delete:
      tags: [branches]
      summary: –£–¥–∞–ª–∏—Ç—å –≤–µ—Ç–∫—É
      operationId: deleteBranch
      security:
        - BearerAuth: []
      parameters:
        - name: scene_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –í–µ—Ç–∫–∞ —É–¥–∞–ª–µ–Ω–∞
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"

  /scenes/{scene_id}/branches/{id}/activate:
    post:
      tags: [branches]
      summary: –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Ç–∫—É
      description: –î–µ–ª–∞–µ—Ç –≤–µ—Ç–∫—É –∞–∫—Ç–∏–≤–Ω–æ–π (—Ç–µ–∫—É—â–µ–π –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
      operationId: activateBranch
      security:
        - BearerAuth: []
      parameters:
        - name: scene_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –í–µ—Ç–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Branch"

  /scenes/{scene_id}/branches/{id}/duplicate:
    post:
      tags: [branches]
      summary: –î—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Ç–∫—É
      operationId: duplicateBranch
      security:
        - BearerAuth: []
      parameters:
        - name: scene_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  description: –ù–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–π –≤–µ—Ç–∫–∏
      responses:
        "201":
          description: –í–µ—Ç–∫–∞ –ø—Ä–æ–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∞
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Branch"

  /scenes/{scene_id}/branches/{id}/compare/{target_id}:
    get:
      tags: [branches]
      summary: –°—Ä–∞–≤–Ω–∏—Ç—å –¥–≤–µ –≤–µ—Ç–∫–∏
      operationId: compareBranches
      security:
        - BearerAuth: []
      parameters:
        - name: scene_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: id
          in: path
          required: true
          description: ID –∏—Å—Ö–æ–¥–Ω–æ–π –≤–µ—Ç–∫–∏
          schema:
            type: string
            format: uuid
        - name: target_id
          in: path
          required: true
          description: ID —Ü–µ–ª–µ–≤–æ–π –≤–µ—Ç–∫–∏ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –†–µ–∑—É–ª—å—Ç–∞—Ç —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BranchComparison"

  /scenes/{scene_id}/branches/{id}/merge:
    post:
      tags: [branches]
      summary: –°–ª–∏—Ç—å –≤–µ—Ç–∫–∏
      operationId: mergeBranches
      security:
        - BearerAuth: []
      parameters:
        - name: scene_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: id
          in: path
          required: true
          description: ID –∏—Å—Ö–æ–¥–Ω–æ–π –≤–µ—Ç–∫–∏ (–∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç —Å–ª–∏—Ç–∞)
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/MergeBranchRequest"
      responses:
        "200":
          description: –í–µ—Ç–∫–∏ —Å–ª–∏—Ç—ã
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Branch"

  # ---------------------------------------------------------------------------
  # AI Endpoints
  # ---------------------------------------------------------------------------
  /ai/recognize:
    post:
      tags: [ai]
      summary: –†–∞—Å–ø–æ–∑–Ω–∞—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤–∫—É
      description: |
        –ó–∞–ø—É—Å–∫–∞–µ—Ç AI —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏.
        
        **–ú–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å:**
        - `floor_plan_id` - ID —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–π –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏
        - `image_base64` - –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ base64 (data:image/jpeg;base64,...)
        
        **–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞:**
        1. –ü–æ–ª—É—á–∞–µ—Ç–µ `job_id` –≤ –æ—Ç–≤–µ—Ç–µ
        2. –î–µ–ª–∞–µ—Ç–µ polling: GET /ai/recognize/{job_id}/status
        3. –ö–æ–≥–¥–∞ status="completed" - –º–æ–¥–µ–ª—å –≥–æ—Ç–æ–≤–∞
        
        **–ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
        - GET /floor-plans/{floor_plan_id} ‚Üí –ø–æ–ª–µ `model`
        - GET /floor-plans/{floor_plan_id}/recognition-status ‚Üí –ø–æ–ª–µ `model`
      operationId: recognizeFloorPlan
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RecognizeRequest"
      responses:
        "202":
          description: |
            –ó–∞–¥–∞—á–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Å–æ–∑–¥–∞–Ω–∞.
            
            ‚ö†Ô∏è **–í–∞–∂–Ω–æ:** –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ `job_id` –∏–∑ –æ—Ç–≤–µ—Ç–∞ –¥–ª—è polling —Å—Ç–∞—Ç—É—Å–∞!
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RecognizeResponse"

  /ai/recognize/{job_id}/status:
    get:
      tags: [ai]
      summary: –°—Ç–∞—Ç—É—Å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –ø–æ job_id
      description: |
        –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –ø–æ –µ—ë ID (job_id).
        
        ‚ö†Ô∏è **job_id –ø–æ–ª—É—á–∞–µ—Ç–µ –∏–∑ –æ—Ç–≤–µ—Ç–∞ POST /ai/recognize**
        
        –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç endpoint –¥–ª—è polling —Å—Ç–∞—Ç—É—Å–∞ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è.
        
        –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: `/floor-plans/{floor_plan_id}/recognition-status` - 
        –µ—Å–ª–∏ –∑–Ω–∞–µ—Ç–µ —Ç–æ–ª—å–∫–æ ID –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏.
      operationId: getRecognitionStatus
      security:
        - BearerAuth: []
      parameters:
        - name: job_id
          in: path
          required: true
          description: |
            ID –∑–∞–¥–∞—á–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è (–ù–ï floor_plan_id!).
            –ü–æ–ª—É—á–∞–µ—Ç–µ –∏–∑ –æ—Ç–≤–µ—Ç–∞ POST /ai/recognize ‚Üí data.job_id
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –°—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RecognitionStatus"

  /ai/generate:
    post:
      tags: [ai]
      summary: –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç—ã –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏
      description: |
        AI –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–∞—à–µ–π —Å—Ü–µ–Ω—ã.
        
        **–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
        1. –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ —Å—Ü–µ–Ω—É —Å —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω–æ–π –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–æ–π
        2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Å scene_id
        3. –î–µ–ª–∞–π—Ç–µ polling: GET /ai/generate/{job_id}/status
        4. –ü–æ–ª—É—á–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –≤–µ—Ç–∫–∏
      operationId: generateVariants
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/GenerateVariantsRequest"
      responses:
        "202":
          description: |
            –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–ø—É—â–µ–Ω–∞.
            
            –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ job_id –¥–ª—è polling: GET /ai/generate/{job_id}/status
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GenerateResponse"

  /ai/generate/{job_id}/status:
    get:
      tags: [ai]
      summary: –°—Ç–∞—Ç—É—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
      operationId: getGenerationStatus
      security:
        - BearerAuth: []
      parameters:
        - name: job_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –°—Ç–∞—Ç—É—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GenerationStatus"

  /ai/chat:
    post:
      tags: [ai]
      summary: –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç—É
      description: |
        –ß–∞—Ç —Å AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º –ø–æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–µ.
        
        **–ü—Ä–∏–º–µ—Ä—ã –≤–æ–ø—Ä–æ—Å–æ–≤:**
        - "–ú–æ–∂–Ω–æ –ª–∏ —Å–Ω–µ—Å—Ç–∏ —Å—Ç–µ–Ω—É –º–µ–∂–¥—É –∫—É—Ö–Ω–µ–π –∏ –≥–æ—Å—Ç–∏–Ω–æ–π?"
        - "–ö–∞–∫ —É–≤–µ–ª–∏—á–∏—Ç—å –ø–ª–æ—â–∞–¥—å –≤–∞–Ω–Ω–æ–π?"
        - "–ü—Ä–µ–¥–ª–æ–∂–∏ –≤–∞—Ä–∏–∞–Ω—Ç—ã –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏"
        
        **–î–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞** –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ `scene_id` - AI –±—É–¥–µ—Ç —É—á–∏—Ç—ã–≤–∞—Ç—å –≤–∞—à—É –ø–ª–∞–Ω–∏—Ä–æ–≤–∫—É.
      operationId: sendChatMessage
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ChatMessageRequest"
      responses:
        "200":
          description: –û—Ç–≤–µ—Ç AI
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ChatMessageResponse"
        "429":
          description: –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤

  /ai/chat/history:
    get:
      tags: [ai]
      summary: –ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞
      operationId: getChatHistory
      security:
        - BearerAuth: []
      parameters:
        - name: session_id
          in: query
          schema:
            type: string
            format: uuid
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
      responses:
        "200":
          description: –ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ChatHistory"

    delete:
      tags: [ai]
      summary: –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–∞
      operationId: clearChatHistory
      security:
        - BearerAuth: []
      parameters:
        - name: session_id
          in: query
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –ò—Å—Ç–æ—Ä–∏—è –æ—á–∏—â–µ–Ω–∞
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"

  /ai/context:
    get:
      tags: [ai]
      summary: –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç AI
      description: –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç AI –¥–ª—è —Å—Ü–µ–Ω—ã (–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–µ)
      operationId: getAIContext
      security:
        - BearerAuth: []
      parameters:
        - name: scene_id
          in: query
          required: true
          schema:
            type: string
            format: uuid
        - name: branch_id
          in: query
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –ö–æ–Ω—Ç–µ–∫—Å—Ç AI
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      context_id:
                        type: string
                      scene_summary:
                        type: string
                        description: –û–ø–∏—Å–∞–Ω–∏–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ –¥–ª—è AI
                      context_size:
                        type: integer
                        description: –†–∞–∑–º–µ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤ —Ç–æ–∫–µ–Ω–∞—Ö
                      updated_at:
                        type: string
                        format: date-time
    post:
      tags: [ai]
      summary: –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç AI
      description: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç AI –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Å—Ü–µ–Ω–µ
      operationId: updateAIContext
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - scene_id
              properties:
                scene_id:
                  type: string
                  format: uuid
                branch_id:
                  type: string
                  format: uuid
                force:
                  type: boolean
                  default: false
                  description: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
      responses:
        "200":
          description: –ö–æ–Ω—Ç–µ–∫—Å—Ç –æ–±–Ω–æ–≤–ª—ë–Ω
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      context_id:
                        type: string
                      updated:
                        type: boolean
                      context_size:
                        type: integer

  /scenes/{scene_id}/chat/messages/{message_id}/select:
    post:
      tags: [ai, scenes]
      summary: –í—ã–±—Ä–∞—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç –∏–∑ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã—Ö AI
      description: –í—ã–±–æ—Ä –≤–∞—Ä–∏–∞–Ω—Ç–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ –∏–∑ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã—Ö AI. –ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –≤–µ—Ç–∫—É.
      operationId: selectSuggestion
      security:
        - BearerAuth: []
      parameters:
        - name: scene_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: message_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: ID —Å–æ–æ–±—â–µ–Ω–∏—è —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - suggestion_index
              properties:
                suggestion_index:
                  type: integer
                  minimum: 0
                  maximum: 4
                  description: –ò–Ω–¥–µ–∫—Å –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞ (0-4)
      responses:
        "200":
          description: –í–∞—Ä–∏–∞–Ω—Ç –≤—ã–±—Ä–∞–Ω –∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      selected_branch_id:
                        type: string
                        format: uuid
                        description: ID –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≤–µ—Ç–∫–∏
                      branch_activated:
                        type: boolean
                        description: –ë—ã–ª–∞ –ª–∏ –≤–µ—Ç–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞
                      confirmation_message:
                        type: string
                        description: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç AI
        "400":
          description: –ù–µ–≤–µ—Ä–Ω—ã–π –∏–Ω–¥–µ–∫—Å –≤–∞—Ä–∏–∞–Ω—Ç–∞
        "404":
          description: –°–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ

  # ---------------------------------------------------------------------------
  # Compliance Endpoints
  # ---------------------------------------------------------------------------
  /compliance/check:
    post:
      tags: [compliance]
      summary: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –Ω–æ—Ä–º–∞–º
      description: |
        –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–ª–∞–Ω–∏—Ä–æ–≤–∫—É –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –°–ù–∏–ü, –ñ–ö –†–§ –∏ –¥—Ä—É–≥–∏–º –Ω–æ—Ä–º–∞–º.
        
        **–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:**
        - –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø–ª–æ—â–∞–¥–∏ –∫–æ–º–Ω–∞—Ç
        - –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –º–æ–∫—Ä—ã—Ö –∑–æ–Ω
        - –ù–µ—Å—É—â–∏–µ —Å—Ç–µ–Ω—ã
        - –í–µ–Ω—Ç–∏–ª—è—Ü–∏—è –∏ –∏–Ω–∂–µ–Ω–µ—Ä–Ω—ã–µ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏
        
        **–†–µ–∑—É–ª—å—Ç–∞—Ç:** —Å–ø–∏—Å–æ–∫ –Ω–∞—Ä—É—à–µ–Ω–∏–π —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏
      operationId: checkCompliance
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ComplianceCheckRequest"
      responses:
        "200":
          description: –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ComplianceCheckResponse"

  /compliance/check-operation:
    post:
      tags: [compliance]
      summary: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ
      description: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –æ–ø–µ—Ä–∞—Ü–∏—é (—Å–Ω–æ—Å —Å—Ç–µ–Ω—ã, –ø–µ—Ä–µ–Ω–æ—Å –∏ —Ç.–¥.) –¥–æ –µ—ë –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
      operationId: checkOperation
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CheckOperationRequest"
      responses:
        "200":
          description: –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ComplianceCheckResponse"

  /compliance/rules:
    get:
      tags: [compliance]
      summary: –°–ø–∏—Å–æ–∫ –ø—Ä–∞–≤–∏–ª
      operationId: listComplianceRules
      security:
        - BearerAuth: []
      parameters:
        - name: category
          in: query
          schema:
            type: string
        - name: is_active
          in: query
          schema:
            type: boolean
      responses:
        "200":
          description: –°–ø–∏—Å–æ–∫ –ø—Ä–∞–≤–∏–ª
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      rules:
                        type: array
                        items:
                          $ref: "#/components/schemas/ComplianceRule"

  /compliance/rules/{id}:
    get:
      tags: [compliance]
      summary: –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–∞–≤–∏–ª–æ
      operationId: getComplianceRule
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: –î–∞–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/ComplianceRule"

  /compliance/report:
    post:
      tags: [compliance]
      summary: –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á–µ—Ç
      description: –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç PDF/HTML –æ—Ç—á–µ—Ç –æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ –Ω–æ—Ä–º–∞–º
      operationId: generateComplianceReport
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/GenerateReportRequest"
      responses:
        "200":
          description: –û—Ç—á–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      report_id:
                        type: string
                        format: uuid
                      download_url:
                        type: string
                        format: uri
                      expires_at:
                        type: string
                        format: date-time

  # ---------------------------------------------------------------------------
  # Request (Expert) Endpoints
  # ---------------------------------------------------------------------------
  /requests:
    get:
      tags: [requests]
      summary: –°–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫
      operationId: listRequests
      security:
        - BearerAuth: []
      parameters:
        - name: workspace_id
          in: query
          schema:
            type: string
            format: uuid
        - name: status
          in: query
          schema:
            type: string
            enum:
              [
                draft,
                pending,
                in_review,
                approved,
                rejected,
                assigned,
                in_progress,
                completed,
                cancelled,
              ]
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: page_size
          in: query
          schema:
            type: integer
            default: 20
      responses:
        "200":
          description: –°–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      requests:
                        type: array
                        items:
                          $ref: "#/components/schemas/ExpertRequest"
                      pagination:
                        $ref: "#/components/schemas/Pagination"

    post:
      tags: [requests]
      summary: –°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É
      operationId: createRequest
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateExpertRequestRequest"
      responses:
        "201":
          description: –ó–∞—è–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/ExpertRequest"

  /requests/{id}:
    get:
      tags: [requests]
      summary: –ü–æ–ª—É—á–∏—Ç—å –∑–∞—è–≤–∫—É
      operationId: getRequest
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: ID –∑–∞—è–≤–∫–∏ (request_id). –ü–æ–ª—É—á–∞–µ—Ç–µ –∏–∑ POST /requests –∏–ª–∏ GET /requests
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –î–∞–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/ExpertRequest"

    patch:
      tags: [requests]
      summary: –û–±–Ω–æ–≤–∏—Ç—å –∑–∞—è–≤–∫—É
      operationId: updateRequest
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateExpertRequestRequest"
      responses:
        "200":
          description: –ó–∞—è–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/ExpertRequest"

    delete:
      tags: [requests]
      summary: –£–¥–∞–ª–∏—Ç—å –∑–∞—è–≤–∫—É
      description: –£–¥–∞–ª—è–µ—Ç –∑–∞—è–≤–∫—É (—Ç–æ–ª—å–∫–æ –≤ —Å—Ç–∞—Ç—É—Å–µ draft)
      operationId: deleteRequest
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –ó–∞—è–≤–∫–∞ —É–¥–∞–ª–µ–Ω–∞
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"

  /requests/{id}/submit:
    post:
      tags: [requests]
      summary: –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É
      description: –ü–µ—Ä–µ–≤–æ–¥–∏—Ç –∑–∞—è–≤–∫—É –∏–∑ draft –≤ pending
      operationId: submitRequest
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/ExpertRequest"

  /requests/{id}/cancel:
    post:
      tags: [requests]
      summary: –û—Ç–º–µ–Ω–∏—Ç—å –∑–∞—è–≤–∫—É
      operationId: cancelRequest
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                reason:
                  type: string
                  description: –ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–º–µ–Ω—ã
      responses:
        "200":
          description: –ó–∞—è–≤–∫–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/ExpertRequest"

  /requests/{id}/documents:
    get:
      tags: [requests]
      summary: –°–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∑–∞—è–≤–∫–∏
      operationId: getRequestDocuments
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –°–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      documents:
                        type: array
                        items:
                          $ref: "#/components/schemas/RequestDocument"

    post:
      tags: [requests]
      summary: –î–æ–±–∞–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç –∫ –∑–∞—è–≤–∫–µ
      operationId: addRequestDocument
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [file]
              properties:
                file:
                  type: string
                  format: binary
                name:
                  type: string
                type:
                  type: string
                  enum: [floor_plan, passport, contract, other]
      responses:
        "201":
          description: –î–æ–∫—É–º–µ–Ω—Ç –¥–æ–±–∞–≤–ª–µ–Ω
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/RequestDocument"
