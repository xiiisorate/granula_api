// =============================================================================
// Notification Service Proto
// =============================================================================
// Сервис уведомлений: push, email, in-app уведомления.
//
// Version: 1.0.0
// =============================================================================

syntax = "proto3";

package notification.v1;

option go_package = "github.com/xiiisorate/granula_api/shared/gen/notification/v1;notificationv1";

import "common/v1/common.proto";
import "google/protobuf/timestamp.proto";

// =============================================================================
// Notification Service
// =============================================================================

// NotificationService - сервис уведомлений
service NotificationService {
  // Отправить уведомление
  rpc SendNotification(SendNotificationRequest) returns (SendNotificationResponse);
  
  // Получить уведомления
  rpc GetNotifications(GetNotificationsRequest) returns (GetNotificationsResponse);
  
  // Отметить прочитанным
  rpc MarkAsRead(MarkAsReadRequest) returns (MarkAsReadResponse);
  
  // Отметить все прочитанными
  rpc MarkAllAsRead(MarkAllAsReadRequest) returns (MarkAllAsReadResponse);
  
  // Количество непрочитанных
  rpc GetUnreadCount(GetUnreadCountRequest) returns (GetUnreadCountResponse);
  
  // Отправить email
  rpc SendEmail(SendEmailRequest) returns (SendEmailResponse);
  
  // Удалить уведомление
  rpc DeleteNotification(DeleteNotificationRequest) returns (DeleteNotificationResponse);
  
  // Получить настройки уведомлений
  rpc GetSettings(GetSettingsRequest) returns (GetSettingsResponse);
  
  // Обновить настройки уведомлений
  rpc UpdateSettings(UpdateSettingsRequest) returns (UpdateSettingsResponse);
}

// =============================================================================
// Notification Entity
// =============================================================================

// NotificationType - тип уведомления
enum NotificationType {
  NOTIFICATION_TYPE_UNSPECIFIED = 0;
  NOTIFICATION_TYPE_SYSTEM = 1;           // Системное
  NOTIFICATION_TYPE_WORKSPACE = 2;        // Связано с воркспейсом
  NOTIFICATION_TYPE_REQUEST = 3;          // Связано с заявкой
  NOTIFICATION_TYPE_COMPLIANCE = 4;       // Результаты проверки
  NOTIFICATION_TYPE_AI = 5;               // Результаты AI
  NOTIFICATION_TYPE_COLLABORATION = 6;    // Совместная работа
}

// NotificationPriority - приоритет уведомления
enum NotificationPriority {
  NOTIFICATION_PRIORITY_UNSPECIFIED = 0;
  NOTIFICATION_PRIORITY_LOW = 1;
  NOTIFICATION_PRIORITY_NORMAL = 2;
  NOTIFICATION_PRIORITY_HIGH = 3;
}

// Notification - модель уведомления
message Notification {
  // ID уведомления
  string id = 1;
  
  // ID получателя
  string user_id = 2;
  
  // Тип уведомления
  NotificationType type = 3;
  
  // Приоритет
  NotificationPriority priority = 4;
  
  // Заголовок
  string title = 5;
  
  // Текст сообщения
  string message = 6;
  
  // Прочитано ли
  bool read = 7;
  
  // Дополнительные данные (JSON-like)
  map<string, string> data = 8;
  
  // Ссылка для перехода
  string action_url = 9;
  
  // ID связанной сущности
  string entity_id = 10;
  
  // Тип связанной сущности
  string entity_type = 11;
  
  // Время создания
  google.protobuf.Timestamp created_at = 12;
  
  // Время прочтения
  google.protobuf.Timestamp read_at = 13;
}

// NotificationSettings - настройки уведомлений пользователя
message NotificationSettings {
  // ID пользователя
  string user_id = 1;
  
  // Включены ли email уведомления
  bool email_enabled = 2;
  
  // Включены ли push уведомления
  bool push_enabled = 3;
  
  // Включены ли in-app уведомления
  bool in_app_enabled = 4;
  
  // Типы уведомлений для email
  repeated NotificationType email_types = 5;
  
  // Типы уведомлений для push
  repeated NotificationType push_types = 6;
  
  // Тихие часы - начало (UTC, например "22:00")
  string quiet_hours_start = 7;
  
  // Тихие часы - конец (UTC, например "08:00")
  string quiet_hours_end = 8;
  
  // Часовой пояс пользователя
  string timezone = 9;
}

// =============================================================================
// Send Notification
// =============================================================================

// SendNotificationRequest - запрос отправки уведомления
message SendNotificationRequest {
  // ID получателя
  string user_id = 1;
  
  // Тип уведомления
  NotificationType type = 2;
  
  // Приоритет
  NotificationPriority priority = 3;
  
  // Заголовок
  string title = 4;
  
  // Сообщение
  string message = 5;
  
  // Дополнительные данные
  map<string, string> data = 6;
  
  // Ссылка для перехода
  string action_url = 7;
  
  // ID связанной сущности
  string entity_id = 8;
  
  // Тип связанной сущности
  string entity_type = 9;
}

// SendNotificationResponse - ответ отправки уведомления
message SendNotificationResponse {
  // ID созданного уведомления
  string notification_id = 1;
  
  // Отправлено ли на email
  bool email_sent = 2;
  
  // Отправлено ли push
  bool push_sent = 3;
}

// =============================================================================
// Get Notifications
// =============================================================================

// GetNotificationsRequest - запрос получения уведомлений
message GetNotificationsRequest {
  // ID пользователя
  string user_id = 1;
  
  // Только непрочитанные
  bool unread_only = 2;
  
  // Фильтр по типу
  NotificationType type = 3;
  
  // Пагинация
  common.v1.PaginationRequest pagination = 4;
}

// GetNotificationsResponse - ответ получения уведомлений
message GetNotificationsResponse {
  // Список уведомлений
  repeated Notification notifications = 1;
  
  // Метаданные пагинации
  common.v1.PaginationResponse pagination = 2;
}

// =============================================================================
// Mark As Read
// =============================================================================

// MarkAsReadRequest - запрос отметки прочитанным
message MarkAsReadRequest {
  // ID уведомления
  string notification_id = 1;
}

// MarkAsReadResponse - ответ отметки прочитанным
message MarkAsReadResponse {
  // Успешно ли
  bool success = 1;
}

// MarkAllAsReadRequest - запрос отметки всех прочитанными
message MarkAllAsReadRequest {
  // ID пользователя
  string user_id = 1;
  
  // Тип уведомлений (опционально)
  NotificationType type = 2;
}

// MarkAllAsReadResponse - ответ отметки всех прочитанными
message MarkAllAsReadResponse {
  // Количество отмеченных
  int32 marked_count = 1;
}

// =============================================================================
// Unread Count
// =============================================================================

// GetUnreadCountRequest - запрос количества непрочитанных
message GetUnreadCountRequest {
  // ID пользователя
  string user_id = 1;
}

// GetUnreadCountResponse - ответ количества непрочитанных
message GetUnreadCountResponse {
  // Общее количество непрочитанных
  int32 count = 1;
  
  // Количество по типам
  map<string, int32> by_type = 2;
}

// =============================================================================
// Send Email
// =============================================================================

// SendEmailRequest - запрос отправки email
message SendEmailRequest {
  // Email получателя
  string to = 1;
  
  // Тема письма
  string subject = 2;
  
  // Тело письма (HTML)
  string body = 3;
  
  // Название шаблона
  string template = 4;
  
  // Данные для шаблона
  map<string, string> template_data = 5;
}

// SendEmailResponse - ответ отправки email
message SendEmailResponse {
  // Успешно ли
  bool success = 1;
  
  // ID сообщения (от провайдера)
  string message_id = 2;
}

// =============================================================================
// Delete Notification
// =============================================================================

// DeleteNotificationRequest - запрос удаления уведомления
message DeleteNotificationRequest {
  // ID уведомления
  string notification_id = 1;
}

// DeleteNotificationResponse - ответ удаления уведомления
message DeleteNotificationResponse {
  // Успешно ли
  bool success = 1;
}

// =============================================================================
// Settings
// =============================================================================

// GetSettingsRequest - запрос настроек
message GetSettingsRequest {
  // ID пользователя
  string user_id = 1;
}

// GetSettingsResponse - ответ с настройками
message GetSettingsResponse {
  // Настройки
  NotificationSettings settings = 1;
}

// UpdateSettingsRequest - запрос обновления настроек
message UpdateSettingsRequest {
  // Настройки
  NotificationSettings settings = 1;
}

// UpdateSettingsResponse - ответ обновления настроек
message UpdateSettingsResponse {
  // Обновлённые настройки
  NotificationSettings settings = 1;
}
